
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/koriym/laravel11-ja/cashier-paddle.html">
      
      
        <link rel="prev" href="billing.html">
      
      
        <link rel="next" href="dusk.html">
      
      
      <link rel="icon" href="assets/images/favicon_io/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.35">
    
    
      
        <title>Cashier (Paddle) - L11JA</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.35f28582.min.css">
      
      


    
    

    

    
      <link rel="stylesheet" href="assets/css/php.css">
    
      <link rel="stylesheet" href="assets/css/mkdocs_material_extra.css">
    
      <link rel="stylesheet" href="assets/css/extra.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-G60CEHXLQ1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-G60CEHXLQ1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-G60CEHXLQ1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    

  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#laravel-cashier-paddle" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!-- Determine classes -->



<!-- Header -->
<header class="md-header" data-md-component="header">
  <nav
          class="md-header__inner md-grid"
          aria-label="Header"
  >

    <!-- Link to home -->
    <a
            href="."
            title="L11JA"
            class="md-header__button md-logo"
            aria-label="L11JA"
            data-md-component="logo"
    >
      
  <img src="assets/images/logo.png" alt="logo">

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            <span style="font-family: 'Noto Sans'; font-size: 20px" >
            L11JA
            </span>
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            <span style="font-family: 'Noto Sans Batak'; font-size: 20px" >
            
              Cashier (Paddle)
            
            </span>
          </span>
        </div>
      </div>
    </div>

    <!-- Color palette toggle -->
    

    <!-- User preference: color palette -->
    
    <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
    <label class="md-header__button md-icon" for="__search">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
    </label>

    <!-- Search interface -->
    <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository information -->
    
    <div class="md-header__source">
      

<!--
  Check whether the repository is hosted on one of the supported code hosting
  platforms (GitHub, GitLab or Bitbucket) to show icon.
-->


  


<!-- Repository containing source -->
<a href="https://github.com/koriym/l11ja" title="source.link.title"
    class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg width="24" height="24" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" fill="#000"/></svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="releases.html" class="md-tabs__link">
          
  
  プロローグ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="installation.html" class="md-tabs__link">
          
  
  はじめに

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="lifecycle.html" class="md-tabs__link">
          
  
  アーキテクチャ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="routing.html" class="md-tabs__link">
          
  
  基本

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="artisan.html" class="md-tabs__link">
          
  
  掘り下げる

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="authentication.html" class="md-tabs__link">
          
  
  セキュリティ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="database.html" class="md-tabs__link">
          
  
  データベース

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="eloquent.html" class="md-tabs__link">
          
  
  Eloquent ORM

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="testing.html" class="md-tabs__link">
          
  
  テスト

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="starter-kits.html" class="md-tabs__link">
          
  
  パッケージ

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="L11JA" class="md-nav__button md-logo" aria-label="L11JA" data-md-component="logo">
      
  <img src="assets/images/logo.png" alt="logo">

    </a>
    L11JA
  </label>
  
    <div class="md-nav__source">
      

<!--
  Check whether the repository is hosted on one of the supported code hosting
  platforms (GitHub, GitLab or Bitbucket) to show icon.
-->


  


<!-- Repository containing source -->
<a href="https://github.com/koriym/l11ja" title="source.link.title"
    class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg width="24" height="24" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" fill="#000"/></svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    プロローグ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            プロローグ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="releases.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リリースノート
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="upgrade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    アップグレードガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contributions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    貢献ガイド
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            はじめに
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="installation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    インストール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="configuration.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    設定
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="structure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ディレクトリ構造
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="frontend.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    フロントエンド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="starter-kits.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    スターターキット
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deployment.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    デプロイ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    アーキテクチャ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            アーキテクチャ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lifecycle.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リクエストライフサイクル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="container.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    サービスコンテナ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="providers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    サービスプロバイダ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="facades.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファサード
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    基本
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            基本
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="routing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ルーティング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="middleware.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ミドルウェア
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="csrf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSRF保護
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="controllers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コントローラ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="requests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リクエスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="responses.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    レスポンス
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="views.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ビュー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="blade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bladeテンプレート
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vite.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    アセットバンドル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="urls.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    URL生成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="session.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    セッション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="validation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    バリデーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="errors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    エラー処理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="logging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ログ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    掘り下げる
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            掘り下げる
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="artisan.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artisanコンソール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="broadcasting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブロードキャスティング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cache.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    キャッシュ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="collections.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コレクション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concurrency.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    並行処理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="context.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コンテキスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contracts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コントラクト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="events.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    イベント
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="filesystem.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファイルストレージ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="helpers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ヘルパー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http-client.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTPクライアント
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="localization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ローカライゼーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mail.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    メール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="notifications.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    通知
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="packages.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    パッケージ開発
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="processes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    プロセス
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="queues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    キュー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rate-limiting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    レート制限
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="strings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文字列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="scheduling.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    タスクスケジューリング
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    セキュリティ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            セキュリティ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="authentication.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認証
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="authorization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認可
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="verification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    メール確認
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="encryption.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    暗号化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hashing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ハッシュ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="passwords.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    パスワードリセット
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    データベース
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            データベース
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="database.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="queries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    クエリビルダ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pagination.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ページネーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="migrations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    マイグレーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="seeding.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    シーディング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="redis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Eloquent ORM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Eloquent ORM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-relationships.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リレーションシップ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-collections.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コレクション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-mutators.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ミューテータ / キャスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-resources.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APIリソース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-serialization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    シリアライゼーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-factories.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファクトリ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    テスト
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            テスト
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http-tests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTPテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="console-tests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コンソールテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dusk.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブラウザテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="database-testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    データベース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mocking.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    モック
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  <span class="md-ellipsis">
    パッケージ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            パッケージ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="starter-kits.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    スターターキット
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="billing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cashier (Stripe)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Cashier (Paddle)
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="cashier-paddle.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Cashier (Paddle)
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cashier" class="md-nav__link">
    <span class="md-ellipsis">
      Cashierのアップグレード
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      インストール
    </span>
  </a>
  
    <nav class="md-nav" aria-label="インストール">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#paddle-sandbox" class="md-nav__link">
    <span class="md-ellipsis">
      Paddle Sandbox
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      設定
    </span>
  </a>
  
    <nav class="md-nav" aria-label="設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      課金可能なモデル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      APIキー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paddle-js" class="md-nav__link">
    <span class="md-ellipsis">
      Paddle JS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      通貨設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      デフォルトモデルのオーバーライド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      クイックスタート
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クイックスタート">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      商品の販売
    </span>
  </a>
  
    <nav class="md-nav" aria-label="商品の販売">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#paddle" class="md-nav__link">
    <span class="md-ellipsis">
      Paddleチェックアウトにメタデータを提供する
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの販売
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプションの販売">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクライブミドルウェアの構築
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      顧客が請求プランを管理できるようにする
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      チェックアウトセッション
    </span>
  </a>
  
    <nav class="md-nav" aria-label="チェックアウトセッション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      オーバーレイチェックアウト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="オーバーレイチェックアウト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      オーバーレイチェックアウトを手動でレンダリングする
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      インラインチェックアウト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="インラインチェックアウト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      インラインチェックアウトを手動でレンダリングする
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      ゲストチェックアウト
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      価格プレビュー
    </span>
  </a>
  
    <nav class="md-nav" aria-label="価格プレビュー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      顧客の価格プレビュー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      割引
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      顧客
    </span>
  </a>
  
    <nav class="md-nav" aria-label="顧客">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      顧客のデフォルト設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      顧客の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      顧客の作成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプション
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションステータスの確認
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプションステータスの確認">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      キャンセルされたサブスクリプションステータス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      過去の期限切れステータス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションスコープ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの一括請求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      支払い情報の更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      プランの変更
    </span>
  </a>
  
    <nav class="md-nav" aria-label="プランの変更">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      日割り計算
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの数量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプションの数量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      複数の製品を持つサブスクリプションの数量
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      複数の製品を持つサブスクリプション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      複数のサブスクリプション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの一時停止
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションのキャンセル
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションのトライアル
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプションのトライアル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      事前に支払い方法を収集するトライアル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      事前に支払い方法を収集しないトライアル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      トライアルの延長またはアクティベーション
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#paddle-webhooks" class="md-nav__link">
    <span class="md-ellipsis">
      Paddle Webhooksの処理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Paddle Webhooksの処理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webhookscsrf" class="md-nav__link">
    <span class="md-ellipsis">
      WebhooksとCSRF保護
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webhooks" class="md-nav__link">
    <span class="md-ellipsis">
      Webhooksとローカル開発
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webhook" class="md-nav__link">
    <span class="md-ellipsis">
      Webhookイベントハンドラの定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webhook_1" class="md-nav__link">
    <span class="md-ellipsis">
      Webhook署名の検証
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      一括請求
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一括請求">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      商品の請求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      トランザクションの返金
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      トランザクションのクレジット
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      トランザクション
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トランザクション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      過去および今後の支払い
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      テスト
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dusk.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブラウザテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="envoy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Envoy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fortify.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fortify
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="folio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="homestead.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homestead
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="horizon.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Horizon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mix.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="octane.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octane
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="passport.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Passport
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pennant.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pennant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pint.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="precognition.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Precognition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="prompts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prompts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pulse.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pulse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reverb.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sail.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sail
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sanctum.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sanctum
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="scout.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="socialite.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Socialite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="telescope.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Telescope
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="valet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Valet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cashier" class="md-nav__link">
    <span class="md-ellipsis">
      Cashierのアップグレード
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      インストール
    </span>
  </a>
  
    <nav class="md-nav" aria-label="インストール">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#paddle-sandbox" class="md-nav__link">
    <span class="md-ellipsis">
      Paddle Sandbox
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      設定
    </span>
  </a>
  
    <nav class="md-nav" aria-label="設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      課金可能なモデル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#api" class="md-nav__link">
    <span class="md-ellipsis">
      APIキー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#paddle-js" class="md-nav__link">
    <span class="md-ellipsis">
      Paddle JS
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      通貨設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      デフォルトモデルのオーバーライド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      クイックスタート
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クイックスタート">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      商品の販売
    </span>
  </a>
  
    <nav class="md-nav" aria-label="商品の販売">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#paddle" class="md-nav__link">
    <span class="md-ellipsis">
      Paddleチェックアウトにメタデータを提供する
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの販売
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプションの販売">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクライブミドルウェアの構築
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      顧客が請求プランを管理できるようにする
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      チェックアウトセッション
    </span>
  </a>
  
    <nav class="md-nav" aria-label="チェックアウトセッション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      オーバーレイチェックアウト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="オーバーレイチェックアウト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      オーバーレイチェックアウトを手動でレンダリングする
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      インラインチェックアウト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="インラインチェックアウト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      インラインチェックアウトを手動でレンダリングする
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      ゲストチェックアウト
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      価格プレビュー
    </span>
  </a>
  
    <nav class="md-nav" aria-label="価格プレビュー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      顧客の価格プレビュー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      割引
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      顧客
    </span>
  </a>
  
    <nav class="md-nav" aria-label="顧客">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      顧客のデフォルト設定
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      顧客の取得
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      顧客の作成
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプション
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションステータスの確認
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプションステータスの確認">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      キャンセルされたサブスクリプションステータス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      過去の期限切れステータス
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションスコープ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの一括請求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      支払い情報の更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      プランの変更
    </span>
  </a>
  
    <nav class="md-nav" aria-label="プランの変更">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      日割り計算
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの数量
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプションの数量">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      複数の製品を持つサブスクリプションの数量
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      複数の製品を持つサブスクリプション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      複数のサブスクリプション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションの一時停止
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションのキャンセル
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      サブスクリプションのトライアル
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サブスクリプションのトライアル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      事前に支払い方法を収集するトライアル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      事前に支払い方法を収集しないトライアル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      トライアルの延長またはアクティベーション
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#paddle-webhooks" class="md-nav__link">
    <span class="md-ellipsis">
      Paddle Webhooksの処理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Paddle Webhooksの処理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#webhookscsrf" class="md-nav__link">
    <span class="md-ellipsis">
      WebhooksとCSRF保護
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webhooks" class="md-nav__link">
    <span class="md-ellipsis">
      Webhooksとローカル開発
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webhook" class="md-nav__link">
    <span class="md-ellipsis">
      Webhookイベントハンドラの定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#webhook_1" class="md-nav__link">
    <span class="md-ellipsis">
      Webhook署名の検証
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      一括請求
    </span>
  </a>
  
    <nav class="md-nav" aria-label="一括請求">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      商品の請求
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      トランザクションの返金
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      トランザクションのクレジット
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      トランザクション
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トランザクション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      過去および今後の支払い
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      テスト
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/koriym/l11ja/edit/11.x-ja/cashier-paddle.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="laravel-cashier-paddle">Laravel Cashier (Paddle)<a class="headerlink" href="#laravel-cashier-paddle" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="#introduction">はじめに</a></li>
<li><a href="#upgrading-cashier">Cashierのアップグレード</a></li>
<li><a href="#installation">インストール</a><ul>
<li><a href="#paddle-sandbox">Paddle Sandbox</a></li>
</ul>
</li>
<li><a href="#configuration">設定</a><ul>
<li><a href="#billable-model">課金可能なモデル</a></li>
<li><a href="#api-keys">APIキー</a></li>
<li><a href="#paddle-js">Paddle JS</a></li>
<li><a href="#currency-configuration">通貨設定</a></li>
<li><a href="#overriding-default-models">デフォルトモデルのオーバーライド</a></li>
</ul>
</li>
<li><a href="#quickstart">クイックスタート</a><ul>
<li><a href="#quickstart-selling-products">商品の販売</a></li>
<li><a href="#quickstart-selling-subscriptions">サブスクリプションの販売</a></li>
</ul>
</li>
<li><a href="#checkout-sessions">チェックアウトセッション</a><ul>
<li><a href="#overlay-checkout">オーバーレイチェックアウト</a></li>
<li><a href="#inline-checkout">インラインチェックアウト</a></li>
<li><a href="#guest-checkouts">ゲストチェックアウト</a></li>
</ul>
</li>
<li><a href="#price-previews">価格プレビュー</a><ul>
<li><a href="#customer-price-previews">顧客価格プレビュー</a></li>
<li><a href="#price-discounts">割引</a></li>
</ul>
</li>
<li><a href="#customers">顧客</a><ul>
<li><a href="#customer-defaults">顧客のデフォルト設定</a></li>
<li><a href="#retrieving-customers">顧客の取得</a></li>
<li><a href="#creating-customers">顧客の作成</a></li>
</ul>
</li>
<li><a href="#subscriptions">サブスクリプション</a><ul>
<li><a href="#creating-subscriptions">サブスクリプションの作成</a></li>
<li><a href="#checking-subscription-status">サブスクリプションステータスの確認</a></li>
<li><a href="#subscription-single-charges">サブスクリプションの単発課金</a></li>
<li><a href="#updating-payment-information">支払い情報の更新</a></li>
<li><a href="#changing-plans">プランの変更</a></li>
<li><a href="#subscription-quantity">サブスクリプションの数量</a></li>
<li><a href="#subscriptions-with-multiple-products">複数商品のサブスクリプション</a></li>
<li><a href="#multiple-subscriptions">複数サブスクリプション</a></li>
<li><a href="#pausing-subscriptions">サブスクリプションの一時停止</a></li>
<li><a href="#canceling-subscriptions">サブスクリプションのキャンセル</a></li>
</ul>
</li>
<li><a href="#subscription-trials">サブスクリプショントライアル</a><ul>
<li><a href="#with-payment-method-up-front">事前に支払い方法を設定</a></li>
<li><a href="#without-payment-method-up-front">事前に支払い方法を設定しない</a></li>
<li><a href="#extend-or-activate-a-trial">トライアルの延長またはアクティブ化</a></li>
</ul>
</li>
<li><a href="#handling-paddle-webhooks">Paddle Webhookの処理</a><ul>
<li><a href="#defining-webhook-event-handlers">Webhookイベントハンドラの定義</a></li>
<li><a href="#verifying-webhook-signatures">Webhook署名の検証</a></li>
</ul>
</li>
<li><a href="#single-charges">単発課金</a><ul>
<li><a href="#charging-for-products">商品の課金</a></li>
<li><a href="#refunding-transactions">取引の返金</a></li>
<li><a href="#crediting-transactions">取引のクレジット</a></li>
</ul>
</li>
<li><a href="#transactions">取引</a><ul>
<li><a href="#past-and-upcoming-payments">過去と今後の支払い</a></li>
</ul>
</li>
<li><a href="#testing">テスト</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="_1">はじめに<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>このドキュメントは、Cashier Paddle 2.xのPaddle Billingとの統合についてです。Paddle Classicをまだ使用している場合は、<a href="https://github.com/laravel/cashier-paddle/tree/1.x">Cashier Paddle 1.x</a>を使用する必要があります。</p>
</div>
<p><a href="https://github.com/laravel/cashier-paddle">Laravel Cashier Paddle</a>は、<a href="https://paddle.com">Paddle</a>のサブスクリプション課金サービスに対して、表現力豊かで流暢なインターフェースを提供します。ほとんどすべての定型サブスクリプション課金コードを処理します。基本的なサブスクリプション管理に加えて、Cashierは以下を処理できます：サブスクリプションの入れ替え、サブスクリプションの「数量」、サブスクリプションの一時停止、キャンセル猶予期間など。</p>
<p>Cashier Paddleを深く掘り下げる前に、Paddleの<a href="https://developer.paddle.com/concepts/overview">コンセプトガイド</a>と<a href="https://developer.paddle.com/api-reference/overview">APIドキュメント</a>も確認することをお勧めします。</p>
<p><a name="upgrading-cashier"></a></p>
<h2 id="cashier">Cashierのアップグレード<a class="headerlink" href="#cashier" title="Permanent link">&para;</a></h2>
<p>Cashierの新しいバージョンにアップグレードする際は、<a href="https://github.com/laravel/cashier-paddle/blob/master/UPGRADE.md">アップグレードガイド</a>を慎重に確認することが重要です。</p>
<p><a name="installation"></a></p>
<h2 id="_2">インストール<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>まず、Composerパッケージマネージャを使用してPaddle用のCashierパッケージをインストールします：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>composer<span class="w"> </span>require<span class="w"> </span>laravel/cashier-paddle
</code></pre></div>
<p>次に、<code>vendor:publish</code> Artisanコマンドを使用してCashierのマイグレーションファイルを公開します：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>vendor:publish<span class="w"> </span>--tag<span class="o">=</span><span class="s2">&quot;cashier-migrations&quot;</span>
</code></pre></div>
<p>その後、アプリケーションのデータベースマイグレーションを実行します。Cashierのマイグレーションにより、新しい<code>customers</code>テーブルが作成されます。さらに、顧客のすべてのサブスクリプションを保存するための新しい<code>subscriptions</code>と<code>subscription_items</code>テーブルが作成されます。最後に、顧客に関連するすべてのPaddleトランザクションを保存するための新しい<code>transactions</code>テーブルが作成されます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>migrate
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>CashierがすべてのPaddleイベントを適切に処理できるように、<a href="#handling-paddle-webhooks">CashierのWebhook処理を設定</a>することを忘れないでください。</p>
</div>
<p><a name="paddle-sandbox"></a></p>
<h3 id="paddle-sandbox">Paddle Sandbox<a class="headerlink" href="#paddle-sandbox" title="Permanent link">&para;</a></h3>
<p>ローカルおよびステージング開発中に、<a href="https://sandbox-login.paddle.com/signup">Paddle Sandboxアカウントを登録</a>する必要があります。このアカウントは、実際の支払いを行わずにアプリケーションをテストおよび開発するためのサンドボックス環境を提供します。Paddleの<a href="https://developer.paddle.com/concepts/payment-methods/credit-debit-card">テストカード番号</a>を使用して、さまざまな支払いシナリオをシミュレートできます。</p>
<p>Paddle Sandbox環境を使用する場合、アプリケーションの<code>.env</code>ファイル内で<code>PADDLE_SANDBOX</code>環境変数を<code>true</code>に設定する必要があります：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="na">PADDLE_SANDBOX</span><span class="o">=</span><span class="s">true</span>
</code></pre></div>
<p>アプリケーションの開発が完了したら、<a href="https://paddle.com">Paddleベンダーアカウントを申請</a>できます。アプリケーションを本番環境に移行する前に、Paddleはアプリケーションのドメインを承認する必要があります。</p>
<p><a name="configuration"></a></p>
<h2 id="_3">設定<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h2>
<p><a name="billable-model"></a></p>
<h3 id="_4">課金可能なモデル<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>Cashierを使用する前に、<code>Billable</code>トレイトをユーザーモデル定義に追加する必要があります。このトレイトは、サブスクリプションの作成や支払い方法情報の更新など、一般的な課金タスクを実行するためのさまざまなメソッドを提供します：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Paddle\Billable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Billable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>ユーザー以外の課金可能なエンティティがある場合は、それらのクラスにもトレイトを追加できます：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Paddle\Billable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Team</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Billable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="api-keys"></a></p>
<h3 id="api">APIキー<a class="headerlink" href="#api" title="Permanent link">&para;</a></h3>
<p>次に、アプリケーションの<code>.env</code>ファイルでPaddleキーを設定する必要があります。PaddleコントロールパネルからPaddle APIキーを取得できます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="na">PADDLE_CLIENT_SIDE_TOKEN</span><span class="o">=</span><span class="s">your-paddle-client-side-token</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="na">PADDLE_API_KEY</span><span class="o">=</span><span class="s">your-paddle-api-key</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="na">PADDLE_RETAIN_KEY</span><span class="o">=</span><span class="s">your-paddle-retain-key</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="na">PADDLE_WEBHOOK_SECRET</span><span class="o">=</span><span class="s">&quot;your-paddle-webhook-secret&quot;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="na">PADDLE_SANDBOX</span><span class="o">=</span><span class="s">true</span>
</code></pre></div>
<p><a href="#paddle-sandbox">PaddleのSandbox環境</a>を使用する場合、<code>PADDLE_SANDBOX</code>環境変数を<code>true</code>に設定する必要があります。アプリケーションを本番環境にデプロイし、Paddleのライブベンダー環境を使用する場合、<code>PADDLE_SANDBOX</code>変数を<code>false</code>に設定する必要があります。</p>
<p><code>PADDLE_RETAIN_KEY</code>はオプションであり、<a href="https://developer.paddle.com/paddlejs/retain">Retain</a>でPaddleを使用している場合にのみ設定する必要があります。</p>
<p><a name="paddle-js"></a></p>
<h3 id="paddle-js">Paddle JS<a class="headerlink" href="#paddle-js" title="Permanent link">&para;</a></h3>
<p>Paddleは、Paddleチェックアウトウィジェットを初期化するために独自のJavaScriptライブラリに依存しています。アプリケーションレイアウトの閉じ<code>&lt;/head&gt;</code>タグの直前に<code>@paddleJS</code> Bladeディレクティブを配置することで、JavaScriptライブラリを読み込むことができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="x">&lt;head&gt;</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="x">    ...</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="x">    @paddleJS</span>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="x">&lt;/head&gt;</span>
</code></pre></div>
<p><a name="currency-configuration"></a></p>
<h3 id="_5">通貨設定<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>請求書に表示する金額のフォーマットに使用するロケールを指定できます。内部的には、Cashierは<a href="https://www.php.net/manual/en/class.numberformatter.php">PHPの<code>NumberFormatter</code>クラス</a>を使用して通貨ロケールを設定します：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="na">CASHIER_CURRENCY_LOCALE</span><span class="o">=</span><span class="s">nl_BE</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>en</code>以外のロケールを使用するには、サーバーに<code>ext-intl</code> PHP拡張機能がインストールおよび設定されていることを確認してください。</p>
</div>
<p><a name="overriding-default-models"></a></p>
<h3 id="_6">デフォルトモデルのオーバーライド<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>Cashierが内部で使用するモデルを独自のモデルで拡張することができます。独自のモデルを定義し、対応するCashierモデルを拡張します：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Paddle\Subscription</span> <span class="k">as</span> <span class="nx">CashierSubscription</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Subscription</span> <span class="k">extends</span> <span class="nx">CashierSubscription</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>モデルを定義した後、<code>Laravel\Paddle\Cashier</code>クラスを介してCashierにカスタムモデルを使用するよう指示できます。通常、アプリケーションの<code>App\Providers\AppServiceProvider</code>クラスの<code>boot</code>メソッドでCashierにカスタムモデルについて通知します：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\Cashier\Subscription</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Cashier\Transaction</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * 任意のアプリケーションサービスのブートストラップ</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">Cashier</span><span class="o">::</span><span class="na">useSubscriptionModel</span><span class="p">(</span><span class="nx">Subscription</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="nx">Cashier</span><span class="o">::</span><span class="na">useTransactionModel</span><span class="p">(</span><span class="nx">Transaction</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="quickstart"></a></p>
<h2 id="_7">クイックスタート<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h2>
<p><a name="quickstart-selling-products"></a></p>
<h3 id="_8">商品の販売<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Paddle Checkoutを利用する前に、Paddleダッシュボードで固定価格の商品を定義する必要があります。さらに、<a href="#handling-paddle-webhooks">PaddleのWebhook処理を設定</a>する必要があります。</p>
</div>
<p>アプリケーションを介して商品やサブスクリプションの課金を提供することは、難しい場合があります。しかし、Cashierと<a href="https://www.paddle.com/billing/checkout">PaddleのCheckout Overlay</a>のおかげで、現代で堅牢な支払い統合を簡単に構築できます。</p>
<p>顧客に非繰り返しの単発商品を課金するために、Cashierを使用してPaddleのCheckout Overlayで顧客に課金します。顧客は支払い詳細を提供し、購入を確認します。支払いがCheckout Overlayを介して行われると、顧客はアプリケーション内で選択した成功URLにリダイレクトされます：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/buy&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">(</span><span class="s1">&#39;pri_deluxe_album&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;buy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;checkout&#39;</span><span class="p">);</span>
</code></pre></div>
<p>上記の例でわかるように、Cashierが提供する<code>checkout</code>メソッドを利用して、指定された「価格識別子」に対して顧客にPaddleのチェックアウトオーバーレイを提示するためのチェックアウトオブジェクトを作成します。Paddleを使用する場合、「価格」とは、特定の製品に対して定義された価格を指します。</p>
<p>必要に応じて、<code>checkout</code>メソッドはPaddleに顧客を自動的に作成し、そのPaddleの顧客レコードをアプリケーションのデータベース内の対応するユーザーに接続します。チェックアウトセッションが完了すると、顧客は専用の成功ページにリダイレクトされ、そこで顧客に情報メッセージを表示できます。</p>
<p><code>buy</code>ビューでは、チェックアウトオーバーレイを表示するためのボタンを含めます。<code>paddle-button</code> BladeコンポーネントはCashier Paddleに含まれていますが、<a href="#manually-rendering-an-overlay-checkout">手動でオーバーレイチェックアウトをレンダリング</a>することもできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="p">&lt;</span><span class="nt">x-paddle-button</span> <span class="na">:checkout</span><span class="o">=</span><span class="s">&quot;$checkout&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;px-8 py-4&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>    製品を購入
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="p">&lt;/</span><span class="nt">x-paddle-button</span><span class="p">&gt;</span>
</code></pre></div>
<p><a name="providing-meta-data-to-paddle-checkout"></a></p>
<h4 id="paddle">Paddleチェックアウトにメタデータを提供する<a class="headerlink" href="#paddle" title="Permanent link">&para;</a></h4>
<p>製品を販売する際、完了した注文や購入した製品を、アプリケーションで定義された<code>Cart</code>や<code>Order</code>モデルを通じて追跡するのが一般的です。顧客をPaddleのチェックアウトオーバーレイにリダイレクトして購入を完了させる際、既存の注文識別子を提供して、顧客がアプリケーションに戻った際に完了した購入を対応する注文に関連付ける必要があるかもしれません。</p>
<p>これを実現するために、<code>checkout</code>メソッドにカスタムデータの配列を提供できます。ユーザーがチェックアウトプロセスを開始すると、アプリケーション内で保留中の<code>Order</code>が作成されると想像してください。この例での<code>Cart</code>と<code>Order</code>モデルは説明のためのものであり、Cashierによって提供されるものではありません。これらの概念は、自分のアプリケーションのニーズに基づいて自由に実装できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="k">use</span> <span class="nx">App\Models\Cart</span><span class="p">;</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/cart/{cart}/checkout&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Cart</span> <span class="nv">$cart</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a>    <span class="nv">$order</span> <span class="o">=</span> <span class="nx">Order</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a>        <span class="s1">&#39;cart_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$cart</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a>        <span class="s1">&#39;price_ids&#39;</span> <span class="o">=&gt;</span> <span class="nv">$cart</span><span class="o">-&gt;</span><span class="na">price_ids</span><span class="p">,</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a>        <span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;incomplete&#39;</span><span class="p">,</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a>    <span class="p">]);</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a>    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">(</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">price_ids</span><span class="p">)</span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a>        <span class="o">-&gt;</span><span class="na">customData</span><span class="p">([</span><span class="s1">&#39;order_id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">]);</span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a>    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;checkout&#39;</span><span class="p">);</span>
</code></pre></div>
<p>上記の例でわかるように、ユーザーがチェックアウトプロセスを開始すると、カート/注文に関連するすべてのPaddle価格識別子を<code>checkout</code>メソッドに提供します。もちろん、これらのアイテムを顧客が追加する際に「ショッピングカート」または注文に関連付けるのは、アプリケーションの責任です。また、注文のIDを<code>customData</code>メソッドを通じてPaddleチェックアウトオーバーレイに提供します。</p>
<p>もちろん、顧客がチェックアウトプロセスを完了したら、注文を「完了」とマークしたいでしょう。これを実現するには、Paddleによってディスパッチされ、Cashierによってイベントとして発生するWebhookをリッスンして、注文情報をデータベースに保存することができます。</p>
<p>まず、Cashierによってディスパッチされる<code>TransactionCompleted</code>イベントをリッスンします。通常、イベントリスナーをアプリケーションの<code>AppServiceProvider</code>の<code>boot</code>メソッドに登録する必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">use</span> <span class="nx">App\Listeners\CompleteOrder</span><span class="p">;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Event</span><span class="p">;</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">use</span> <span class="nx">Laravel\Paddle\Events\TransactionCompleted</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="sd">/**</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="sd"> * アプリケーションサービスをブートストラップする。</span>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="sd"> */</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="p">{</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a>    <span class="nx">Event</span><span class="o">::</span><span class="na">listen</span><span class="p">(</span><span class="nx">TransactionCompleted</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">CompleteOrder</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="p">}</span>
</code></pre></div>
<p>この例では、<code>CompleteOrder</code>リスナーは次のようになります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="k">use</span> <span class="nx">Laravel\Paddle\Cashier</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="k">use</span> <span class="nx">Laravel\Paddle\Events\TransactionCompleted</span><span class="p">;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">class</span> <span class="nc">CompleteOrder</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="p">{</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    <span class="sd">/**</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="sd">     * 着信Cashier Webhookイベントを処理する。</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="sd">     */</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">TransactionCompleted</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>    <span class="p">{</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>        <span class="nv">$orderId</span> <span class="o">=</span> <span class="nv">$event</span><span class="o">-&gt;</span><span class="na">payload</span><span class="p">[</span><span class="s1">&#39;data&#39;</span><span class="p">][</span><span class="s1">&#39;custom_data&#39;</span><span class="p">][</span><span class="s1">&#39;order_id&#39;</span><span class="p">]</span> <span class="o">??</span> <span class="k">null</span><span class="p">;</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="nv">$order</span> <span class="o">=</span> <span class="nx">Order</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$orderId</span><span class="p">);</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a>        <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;completed&#39;</span><span class="p">]);</span>
<a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a>    <span class="p">}</span>
<a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="p">}</span>
</code></pre></div>
<p><code>transaction.completed</code>イベントに含まれるデータの詳細については、Paddleのドキュメントを参照してください。</p>
<p><a name="quickstart-selling-subscriptions"></a></p>
<h3 id="_9">サブスクリプションの販売<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Paddleチェックアウトを利用する前に、Paddleダッシュボードで固定価格の製品を定義する必要があります。また、<a href="#handling-paddle-webhooks">PaddleのWebhook処理を設定</a>する必要があります。</p>
</div>
<p>アプリケーションを通じて製品やサブスクリプションの請求を提供することは、難しい場合があります。しかし、Cashierと<a href="https://www.paddle.com/billing/checkout">Paddleのチェックアウトオーバーレイ</a>のおかげで、現代で堅牢な支払い統合を簡単に構築できます。</p>
<p>CashierとPaddleのチェックアウトオーバーレイを使用してサブスクリプションを販売する方法を学ぶために、基本的な月額（<code>price_basic_monthly</code>）と年額（<code>price_basic_yearly</code>）のプランを持つサブスクリプションサービスのシンプルなシナリオを考えてみましょう。これらの2つの価格は、Paddleダッシュボードで「Basic」製品（<code>pro_basic</code>）の下にグループ化されるかもしれません。さらに、サブスクリプションサービスは、<code>pro_expert</code>としてExpertプランを提供するかもしれません。</p>
<p>まず、顧客がサービスにサブスクライブする方法を見てみましょう。もちろん、顧客はアプリケーションの価格ページでBasicプランの「サブスクライブ」ボタンをクリックするかもしれません。このボタンは、選択したプランのPaddleチェックアウトオーバーレイを呼び出します。まず、<code>checkout</code>メソッドを介してチェックアウトセッションを開始しましょう。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/subscribe&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a>    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">(</span><span class="s1">&#39;price_basic_monthly&#39;</span><span class="p">)</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>        <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">));</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a>    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;subscribe&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;subscribe&#39;</span><span class="p">);</span>
</code></pre></div>
<p><code>subscribe</code>ビューでは、チェックアウトオーバーレイを表示するためのボタンを含めます。<code>paddle-button</code> BladeコンポーネントはCashier Paddleに含まれていますが、<a href="#manually-rendering-an-overlay-checkout">手動でオーバーレイチェックアウトをレンダリング</a>することもできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="p">&lt;</span><span class="nt">x-paddle-button</span> <span class="na">:checkout</span><span class="o">=</span><span class="s">&quot;$checkout&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;px-8 py-4&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>    サブスクライブ
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="p">&lt;/</span><span class="nt">x-paddle-button</span><span class="p">&gt;</span>
</code></pre></div>
<p>これで、サブスクライブボタンがクリックされると、顧客は支払い詳細を入力し、サブスクリプションを開始できるようになります。サブスクリプションが実際に開始されたことを知るために（一部の支払い方法は処理に数秒かかるため）、<a href="#handling-paddle-webhooks">CashierのWebhook処理を設定</a>する必要もあります。</p>
<p>これで顧客はサブスクリプションを開始できるようになりましたが、アプリケーションの一部をサブスクライブしたユーザーのみがアクセスできるように制限する必要があります。もちろん、Cashierの<code>Billable</code>トレイトによって提供される<code>subscribed</code>メソッドを介して、ユーザーの現在のサブスクリプションステータスを常に確認できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="x">@if ($user-&gt;subscribed())</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="x">    &lt;p&gt;サブスクライブしています。&lt;/p&gt;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="x">@endif</span>
</code></pre></div>
<p>特定の製品や価格にサブスクライブしているかどうかを簡単に確認することもできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="x">@if ($user-&gt;subscribedToProduct(&#39;pro_basic&#39;))</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="x">    &lt;p&gt;Basic製品にサブスクライブしています。&lt;/p&gt;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="x">@endif</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="x">@if ($user-&gt;subscribedToPrice(&#39;price_basic_monthly&#39;))</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="x">    &lt;p&gt;月額Basicプランにサブスクライブしています。&lt;/p&gt;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="x">@endif</span>
</code></pre></div>
<p><a name="quickstart-building-a-subscribed-middleware"></a></p>
<h4 id="_10">サブスクライブミドルウェアの構築<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h4>
<p>便宜上、着信リクエストがサブスクライブしたユーザーからのものであるかどうかを判断する<a href="middleware.html">ミドルウェア</a>を作成したい場合があります。このミドルウェアを定義したら、サブスクライブしていないユーザーがルートにアクセスできないように、簡単にルートに割り当てることができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="k">class</span> <span class="nc">Subscribed</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="p">{</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>    <span class="sd">/**</span>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="sd">     * 着信リクエストを処理する。</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="sd">     */</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>    <span class="p">{</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">?-&gt;</span><span class="na">subscribed</span><span class="p">())</span> <span class="p">{</span>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a>            <span class="c1">// ユーザーを請求ページにリダイレクトしてサブスクライブを促す...</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a>            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/subscribe&#39;</span><span class="p">);</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a>        <span class="p">}</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a>        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a>    <span class="p">}</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="p">}</span>
</code></pre></div>
<p>ミドルウェアを定義したら、ルートに割り当てることができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">use</span> <span class="nx">App\Http\Middleware\Subscribed</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/dashboard&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>    <span class="c1">// ...</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">([</span><span class="nx">Subscribed</span><span class="o">::</span><span class="na">class</span><span class="p">]);</span>
</code></pre></div>
<p><a name="quickstart-allowing-customers-to-manage-their-billing-plan"></a></p>
<h4 id="_11">顧客が請求プランを管理できるようにする<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>もちろん、顧客は別の製品や「階層」にサブスクリプションプランを変更したい場合があります。上記の例では、顧客が月額サブスクリプションから年額サブスクリプションにプランを変更できるようにしたいと考えています。これには、以下のルートにつながるボタンを実装する必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nx">Route</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;/subscription/{price}/swap&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$price</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">swap</span><span class="p">(</span><span class="nv">$price</span><span class="p">);</span> <span class="c1">// この例では&quot;$price&quot;は&quot;price_basic_yearly&quot;です。</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">);</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;subscription.swap&#39;</span><span class="p">);</span>
</code></pre></div>
<p>プランを交換するだけでなく、顧客がサブスクリプションをキャンセルできるようにする必要もあります。プランを交換するのと同様に、以下のルートにつながるボタンを提供します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="nx">Route</span><span class="o">::</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;/subscription/cancel&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nv">$price</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a>    <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cancel</span><span class="p">();</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">route</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">);</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;subscription.cancel&#39;</span><span class="p">);</span>
</code></pre></div>
<p>これで、サブスクリプションは請求期間の終了時にキャンセルされます。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>CashierのWebhook処理を設定している限り、CashierはPaddleからの受信Webhookを調べることで、アプリケーションのCashier関連のデータベーステーブルを自動的に同期させます。たとえば、Paddleのダッシュボードから顧客のサブスクリプションをキャンセルすると、Cashierは対応するWebhookを受信し、アプリケーションのデータベースでそのサブスクリプションを「キャンセル済み」とマークします。</p>
</div>
<p><a name="checkout-sessions"></a></p>
<h2 id="_12">チェックアウトセッション<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h2>
<p>顧客への請求操作のほとんどは、Paddleの<a href="https://developer.paddle.com/build/checkout/build-overlay-checkout">Checkout Overlayウィジェット</a>を介して、または<a href="https://developer.paddle.com/build/checkout/build-branded-inline-checkout">インラインチェックアウト</a>を利用して「チェックアウト」を実行します。</p>
<p>Paddleを使用してチェックアウト支払いを処理する前に、Paddleのチェックアウト設定ダッシュボードでアプリケーションの<a href="https://developer.paddle.com/build/transactions/default-payment-link#set-default-link">デフォルト支払いリンク</a>を定義する必要があります。</p>
<p><a name="overlay-checkout"></a></p>
<h3 id="_13">オーバーレイチェックアウト<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>Checkout Overlayウィジェットを表示する前に、Cashierを使用してチェックアウトセッションを生成する必要があります。チェックアウトセッションは、実行すべき請求操作をチェックアウトウィジェットに通知します。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/buy&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">(</span><span class="s1">&#39;pri_34567&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p>Cashierには<code>paddle-button</code> <a href="blade.html#components">Bladeコンポーネント</a>が含まれています。このコンポーネントにチェックアウトセッションを「prop」として渡すことができます。そして、このボタンがクリックされると、Paddleのチェックアウトウィジェットが表示されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="p">&lt;</span><span class="nt">x-paddle-button</span> <span class="na">:checkout</span><span class="o">=</span><span class="s">&quot;$checkout&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;px-8 py-4&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>    Subscribe
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="p">&lt;/</span><span class="nt">x-paddle-button</span><span class="p">&gt;</span>
</code></pre></div>
<p>デフォルトでは、これによりPaddleのデフォルトスタイリングを使用してウィジェットが表示されます。ウィジェットをカスタマイズするには、<code>data-theme='light'</code>属性のような<a href="https://developer.paddle.com/paddlejs/html-data-attributes">Paddleがサポートする属性</a>をコンポーネントに追加します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="p">&lt;</span><span class="nt">x-paddle-button</span> <span class="na">:url</span><span class="o">=</span><span class="s">&quot;$payLink&quot;</span> <span class="na">class</span><span class="o">=</span><span class="s">&quot;px-8 py-4&quot;</span> <span class="na">data-theme</span><span class="o">=</span><span class="s">&quot;light&quot;</span><span class="p">&gt;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>    Subscribe
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="p">&lt;/</span><span class="nt">x-paddle-button</span><span class="p">&gt;</span>
</code></pre></div>
<p>Paddleのチェックアウトウィジェットは非同期です。ユーザーがウィジェット内でサブスクリプションを作成すると、PaddleはアプリケーションにWebhookを送信し、サブスクリプションの状態をアプリケーションのデータベースで適切に更新できるようにします。したがって、Paddleからの状態変更に対応するために、適切に<a href="#handling-paddle-webhooks">Webhookを設定する</a>ことが重要です。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>サブスクリプションの状態が変更された後、対応するWebhookを受信するまでの遅延は通常最小限ですが、チェックアウトを完了した後すぐにユーザーのサブスクリプションが利用できない可能性を考慮して、アプリケーションでこれを考慮する必要があります。</p>
</div>
<p><a name="manually-rendering-an-overlay-checkout"></a></p>
<h4 id="_14">オーバーレイチェックアウトを手動でレンダリングする<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<p>Laravelの組み込みBladeコンポーネントを使用せずに、オーバーレイチェックアウトを手動でレンダリングすることもできます。まず、<a href="#overlay-checkout">前述の例</a>のようにチェックアウトセッションを生成します。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/buy&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">(</span><span class="s1">&#39;pri_34567&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p>次に、Paddle.jsを使用してチェックアウトを初期化します。この例では、<code>paddle_button</code>クラスが割り当てられたリンクを作成します。Paddle.jsはこのクラスを検出し、リンクがクリックされたときにオーバーレイチェックアウトを表示します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="nv">$items</span> <span class="o">=</span> <span class="nv">$checkout</span><span class="o">-&gt;</span><span class="na">getItems</span><span class="p">();</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="nv">$customer</span> <span class="o">=</span> <span class="nv">$checkout</span><span class="o">-&gt;</span><span class="na">getCustomer</span><span class="p">();</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="nv">$custom</span> <span class="o">=</span> <span class="nv">$checkout</span><span class="o">-&gt;</span><span class="na">getCustomData</span><span class="p">();</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="cp">?&gt;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="x">&lt;a</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a><span class="x">    href=&#39;#!&#39;</span>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="x">    class=&#39;paddle_button&#39;</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="x">    data-items=&#39;{!! json_encode($items) !!}&#39;</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a><span class="x">    @if ($customer) data-customer-id=&#39;{{ $customer-&gt;paddle_id }}&#39; @endif</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="x">    @if ($custom) data-custom-data=&#39;{{ json_encode($custom) }}&#39; @endif</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="x">    @if ($returnUrl = $checkout-&gt;getReturnUrl()) data-success-url=&#39;{{ $returnUrl }}&#39; @endif</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="x">&gt;</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="x">    Buy Product</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a><span class="x">&lt;/a&gt;</span>
</code></pre></div>
<p><a name="inline-checkout"></a></p>
<h3 id="_15">インラインチェックアウト<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>Paddleの「オーバーレイ」スタイルのチェックアウトウィジェットを使用したくない場合、Paddleはウィジェットをインラインで表示するオプションも提供しています。このアプローチでは、チェックアウトのHTMLフィールドを調整することはできませんが、ウィジェットをアプリケーション内に埋め込むことができます。</p>
<p>インラインチェックアウトを簡単に始めるために、Cashierには<code>paddle-checkout</code> Bladeコンポーネントが含まれています。まず、<a href="#overlay-checkout">チェックアウトセッションを生成</a>します。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/buy&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">(</span><span class="s1">&#39;pri_34567&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p>次に、チェックアウトセッションをコンポーネントの<code>checkout</code>属性に渡します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="x">&lt;x-paddle-checkout :checkout=&quot;$checkout&quot; class=&quot;w-full&quot; /&gt;</span>
</code></pre></div>
<p>インラインチェックアウトコンポーネントの高さを調整するには、<code>height</code>属性をBladeコンポーネントに渡します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="x">&lt;x-paddle-checkout :checkout=&quot;$checkout&quot; class=&quot;w-full&quot; height=&quot;500&quot; /&gt;</span>
</code></pre></div>
<p>インラインチェックアウトのカスタマイズオプションの詳細については、Paddleの<a href="https://developer.paddle.com/build/checkout/build-branded-inline-checkout">インラインチェックアウトガイド</a>と<a href="https://developer.paddle.com/build/checkout/set-up-checkout-default-settings">利用可能なチェックアウト設定</a>を参照してください。</p>
<p><a name="manually-rendering-an-inline-checkout"></a></p>
<h4 id="_16">インラインチェックアウトを手動でレンダリングする<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h4>
<p>Laravelの組み込みBladeコンポーネントを使用せずに、インラインチェックアウトを手動でレンダリングすることもできます。まず、<a href="#inline-checkout">前述の例</a>のようにチェックアウトセッションを生成します。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/buy&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">(</span><span class="s1">&#39;pri_34567&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;dashboard&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p>次に、Paddle.jsを使用してチェックアウトを初期化します。この例では、<a href="https://github.com/alpinejs/alpine">Alpine.js</a>を使用していますが、この例を自分のフロントエンドスタックに合わせて自由に変更できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="cp">&lt;?php</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="nv">$options</span> <span class="o">=</span> <span class="nv">$checkout</span><span class="o">-&gt;</span><span class="na">options</span><span class="p">();</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;frameTarget&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;paddle-checkout&#39;</span><span class="p">;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="nv">$options</span><span class="p">[</span><span class="s1">&#39;settings&#39;</span><span class="p">][</span><span class="s1">&#39;frameInitialHeight&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">366</span><span class="p">;</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a><span class="cp">?&gt;</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a><span class="x">&lt;div class=&quot;paddle-checkout&quot; x-data=&quot;{}&quot; x-init=&quot;</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="x">    Paddle.Checkout.open(@json($options));</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a><span class="x">&quot;&gt;</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a><span class="x">&lt;/div&gt;</span>
</code></pre></div>
<p><a name="guest-checkouts"></a></p>
<h3 id="_17">ゲストチェックアウト<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>アプリケーションでアカウントを必要としないユーザーのためにチェックアウトセッションを作成する必要がある場合があります。そのためには、<code>guest</code>メソッドを使用します。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Paddle\Checkout</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/buy&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nx">Checkout</span><span class="o">::</span><span class="na">guest</span><span class="p">(</span><span class="s1">&#39;pri_34567&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p>次に、チェックアウトセッションを<a href="#overlay-checkout">Paddleボタン</a>または<a href="#inline-checkout">インラインチェックアウト</a>のBladeコンポーネントに渡します。</p>
<p><a name="price-previews"></a></p>
<h2 id="_18">価格プレビュー<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h2>
<p>Paddleでは、通貨ごとに価格をカスタマイズできます。つまり、異なる国に対して異なる価格を設定できます。Cashier Paddleでは、<code>previewPrices</code>メソッドを使用してこれらの価格をすべて取得できます。このメソッドは、価格を取得したい価格IDを受け取ります。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Paddle\Cashier</span><span class="p">;</span>

<span class="nv">$prices</span> <span class="o">=</span> <span class="nx">Cashier</span><span class="o">::</span><span class="na">previewPrices</span><span class="p">([</span><span class="s1">&#39;pri_123&#39;</span><span class="p">,</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">]);</span>
</code></pre></div>
<p>通貨はリクエストのIPアドレスに基づいて決定されますが、特定の国の価格を取得するためにオプションで国を指定することもできます。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Paddle\Cashier</span><span class="p">;</span>

<span class="nv">$prices</span> <span class="o">=</span> <span class="nx">Cashier</span><span class="o">::</span><span class="na">previewPrices</span><span class="p">([</span><span class="s1">&#39;pri_123&#39;</span><span class="p">,</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;address&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;country_code&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;BE&#39;</span><span class="p">,</span>
    <span class="s1">&#39;postal_code&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;1234&#39;</span><span class="p">,</span>
<span class="p">]]);</span>
</code></pre></div>
<p>価格を取得した後、それらを好きなように表示できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="x">&lt;ul&gt;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="x">    @foreach ($prices as $price)</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="x">        &lt;li&gt;{{ $price-&gt;product[&#39;name&#39;] }} - {{ $price-&gt;total() }}&lt;/li&gt;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="x">    @endforeach</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="x">&lt;/ul&gt;</span>
</code></pre></div>
<p>小計価格と税額を別々に表示することもできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="x">&lt;ul&gt;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="x">    @foreach ($prices as $price)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="x">        &lt;li&gt;{{ $price-&gt;product[&#39;name&#39;] }} - {{ $price-&gt;subtotal() }} (+ {{ $price-&gt;tax() }} tax)&lt;/li&gt;</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="x">    @endforeach</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="x">&lt;/ul&gt;</span>
</code></pre></div>
<p>詳細については、Paddleの<a href="https://developer.paddle.com/api-reference/pricing-preview/preview-prices">価格プレビューに関するAPIドキュメント</a>を確認してください。</p>
<p><a name="customer-price-previews"></a></p>
<h3 id="_19">顧客の価格プレビュー<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p>ユーザーがすでに顧客であり、その顧客に適用される価格を表示したい場合、顧客インスタンスから直接価格を取得できます。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="nv">$prices</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">previewPrices</span><span class="p">([</span><span class="s1">&#39;pri_123&#39;</span><span class="p">,</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">]);</span>
</code></pre></div>
<p>内部的には、Cashierはユーザーの顧客IDを使用してその通貨で価格を取得します。たとえば、米国に住むユーザーは米ドルで価格を見ることになり、ベルギーに住むユーザーはユーロで価格を見ることになります。一致する通貨が見つからない場合、商品のデフォルト通貨が使用されます。Paddleのコントロールパネルで商品またはサブスクリプションプランのすべての価格をカスタマイズできます。</p>
<p><a name="price-discounts"></a></p>
<h3 id="_20">割引<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h3>
<p>割引後の価格を表示することもできます。<code>previewPrices</code>メソッドを呼び出す際に、<code>discount_id</code>オプションを介して割引IDを提供します。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Paddle\Cashier</span><span class="p">;</span>

<span class="nv">$prices</span> <span class="o">=</span> <span class="nx">Cashier</span><span class="o">::</span><span class="na">previewPrices</span><span class="p">([</span><span class="s1">&#39;pri_123&#39;</span><span class="p">,</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">],</span> <span class="p">[</span>
    <span class="s1">&#39;discount_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;dsc_123&#39;</span>
<span class="p">]);</span>
</code></pre></div>
<p>そして、計算された価格を表示します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="x">&lt;ul&gt;</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="x">    @foreach ($prices as $price)</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="x">        &lt;li&gt;{{ $price-&gt;product[&#39;name&#39;] }} - {{ $price-&gt;total() }}&lt;/li&gt;</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="x">    @endforeach</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="x">&lt;/ul&gt;</span>
</code></pre></div>
<p><a name="customers"></a></p>
<h2 id="_21">顧客<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h2>
<p><a name="customer-defaults"></a></p>
<h3 id="_22">顧客のデフォルト設定<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p>Cashierを使用すると、チェックアウトセッションを作成する際に、顧客に対していくつかの便利なデフォルトを定義できます。これらのデフォルトを設定することで、顧客のメールアドレスと名前を事前に入力し、チェックアウトウィジェットの支払い部分にすぐに進むことができます。これらのデフォルトは、請求可能なモデルで以下のメソッドをオーバーライドすることで設定できます。</p>
<div class="highlight"><pre><span></span><code><span class="sd">/**</span>
<span class="sd"> * Paddleに関連付ける顧客の名前を取得します。</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">paddleName</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span><span class="o">|</span><span class="k">null</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * Paddleに関連付ける顧客のメールアドレスを取得します。</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">paddleEmail</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span><span class="o">|</span><span class="k">null</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>これらのデフォルトは、<a href="#checkout-sessions">チェックアウトセッション</a>を生成するCashierのすべてのアクションで使用されます。</p>
<p><a name="retrieving-customers"></a></p>
<h3 id="_23">顧客の取得<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p><code>Cashier::findBillable</code>メソッドを使用して、Paddleの顧客IDで顧客を取得できます。このメソッドは、請求可能なモデルのインスタンスを返します。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Paddle\Cashier</span><span class="p">;</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nx">Cashier</span><span class="o">::</span><span class="na">findBillable</span><span class="p">(</span><span class="nv">$customerId</span><span class="p">);</span>
</code></pre></div>
<p><a name="creating-customers"></a></p>
<h3 id="_24">顧客の作成<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>場合によっては、サブスクリプションを開始せずにPaddleの顧客を作成したいことがあります。これは、<code>createAsCustomer</code>メソッドを使用して行うことができます。</p>
<div class="highlight"><pre><span></span><code><span class="nv">$customer</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createAsCustomer</span><span class="p">();</span>
</code></pre></div>
<p><code>Laravel\Paddle\Customer</code>のインスタンスが返されます。Paddleで顧客が作成されたら、後でサブスクリプションを開始できます。オプションの<code>$options</code>配列を渡して、<a href="https://developer.paddle.com/api-reference/customers/create-customer">Paddle APIがサポートする追加の顧客作成パラメータ</a>を渡すこともできます。</p>
<div class="highlight"><pre><span></span><code><span class="nv">$customer</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createAsCustomer</span><span class="p">(</span><span class="nv">$options</span><span class="p">);</span>
</code></pre></div>
<p><a name="subscriptions"></a></p>
<h2 id="_25">サブスクリプション<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h2>
<p><a name="creating-subscriptions"></a></p>
<h3 id="_26">サブスクリプションの作成<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p>サブスクリプションを作成するには、まずデータベースから請求可能なモデルのインスタンスを取得します。これは通常、<code>App\Models\User</code>のインスタンスになります。モデルインスタンスを取得したら、<code>subscribe</code>メソッドを使用してモデルのチェックアウトセッションを作成できます。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/subscribe&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subscribe</span><span class="p">(</span><span class="nv">$premium</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p><code>subscribe</code>メソッドに渡される最初の引数は、ユーザーがサブスクライブする特定の価格です。この値は、Paddle内の価格の識別子に対応する必要があります。<code>returnTo</code>メソッドは、ユーザーがチェックアウトを正常に完了した後にリダイレクトされるURLを受け取ります。<code>subscribe</code>メソッドに渡される2番目の引数は、サブスクリプションの内部「タイプ」です。アプリケーションが単一のサブスクリプションのみを提供する場合、これを<code>default</code>または<code>primary</code>と呼ぶことがあります。このサブスクリプションタイプは、内部アプリケーションの使用のみを目的としており、ユーザーに表示されることはありません。また、スペースを含めず、サブスクリプションを作成した後は変更しないでください。</p>
<p>サブスクリプションに関するカスタムメタデータを配列で提供するには、<code>customData</code>メソッドを使用します。</p>
<div class="highlight"><pre><span></span><code><span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subscribe</span><span class="p">(</span><span class="nv">$premium</span> <span class="o">=</span> <span class="mi">12345</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">customData</span><span class="p">([</span><span class="s1">&#39;key&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;value&#39;</span><span class="p">])</span>
    <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">));</span>
</code></pre></div>
<p>サブスクリプションのチェックアウトセッションが作成されたら、Cashier Paddleに含まれる<code>paddle-button</code> <a href="#overlay-checkout">Bladeコンポーネント</a>にチェックアウトセッションを提供できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="x">&lt;x-paddle-button :checkout=&quot;$checkout&quot; class=&quot;px-8 py-4&quot;&gt;</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="x">    Subscribe</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="x">&lt;/x-paddle-button&gt;</span>
</code></pre></div>
<p>ユーザーがチェックアウトを完了した後、Paddleから<code>subscription_created</code>ウェブフックがディスパッチされます。Cashierはこのウェブフックを受信し、顧客のサブスクリプションを設定します。アプリケーションがすべてのウェブフックを適切に受信および処理するように、<a href="#handling-paddle-webhooks">ウェブフックの処理</a>を正しく設定していることを確認してください。</p>
<p><a name="checking-subscription-status"></a></p>
<h3 id="_27">サブスクリプションステータスの確認<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<p>ユーザーがアプリケーションにサブスクライブした後、さまざまな便利なメソッドを使用してサブスクリプションステータスを確認できます。まず、<code>subscribed</code>メソッドは、ユーザーが有効なサブスクリプションを持っている場合、たとえサブスクリプションが現在試用期間内であっても、<code>true</code>を返します。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscribed</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>アプリケーションが複数のサブスクリプションを提供する場合、<code>subscribed</code>メソッドを呼び出す際にサブスクリプションを指定できます。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscribed</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p><code>subscribed</code>メソッドは、ユーザーのサブスクリプションステータスに基づいてルートとコントローラへのアクセスをフィルタリングするために、<a href="middleware.html">ルートミドルウェア</a>に適した候補です。</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Http\Middleware</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Closure</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">EnsureUserIsSubscribed</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * 受信リクエストを処理します。</span>
<span class="sd">     *</span>
<span class="sd">     * @param  \Closure(\Illuminate\Http\Request): (\Symfony\Component\HttpFoundation\Response)  $next</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Closure</span> <span class="nv">$next</span><span class="p">)</span><span class="o">:</span> <span class="nx">Response</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subscribed</span><span class="p">())</span> <span class="p">{</span>
            <span class="c1">// このユーザーは支払い済みの顧客ではありません...</span>
            <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/billing&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$next</span><span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>ユーザーがまだ試用期間内かどうかを確認したい場合は、<code>onTrial</code>メソッドを使用できます。このメソッドは、ユーザーがまだ試用期間内であることを示す警告を表示する必要があるかどうかを判断するのに役立ちます。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p><code>subscribedToPrice</code>メソッドは、ユーザーが指定されたPaddle価格IDに基づいて特定のプランにサブスクライブしているかどうかを判断するために使用できます。この例では、ユーザーの<code>default</code>サブスクリプションが月額プランにアクティブにサブスクライブしているかどうかを判断します。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscribedToPrice</span><span class="p">(</span><span class="nv">$monthly</span> <span class="o">=</span> <span class="s1">&#39;pri_123&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p><code>recurring</code>メソッドは、ユーザーが現在アクティブなサブスクリプションを持っているかどうか、また試用期間や猶予期間が終了しているかどうかを判断するために使用できます。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">recurring</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="canceled-subscription-status"></a></p>
<h4 id="_28">キャンセルされたサブスクリプションステータス<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h4>
<p>ユーザーが一度アクティブなサブスクライバーであったが、サブスクリプションをキャンセルしたかどうかを判断するには、<code>canceled</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">canceled</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>また、ユーザーがサブスクリプションをキャンセルしたが、サブスクリプションが完全に期限切れになるまでの「猶予期間」にまだいるかどうかを判断することもできます。たとえば、ユーザーが3月5日にサブスクリプションをキャンセルし、本来は3月10日に期限切れになる予定であった場合、ユーザーは3月10日まで「猶予期間」にいます。この間、<code>subscribed</code>メソッドはまだ<code>true</code>を返します。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">onGracePeriod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="past-due-status"></a></p>
<h4 id="_29">過去の期限切れステータス<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h4>
<p>サブスクリプションの支払いが失敗した場合、そのサブスクリプションは<code>past_due</code>としてマークされます。サブスクリプションがこの状態にある場合、顧客が支払い情報を更新するまでアクティブではありません。サブスクリプションが過去の期限切れかどうかを判断するには、サブスクリプションインスタンスの<code>pastDue</code>メソッドを使用します。</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pastDue</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>サブスクリプションが<code>past_due</code>状態の場合、ユーザーに<a href="#updating-payment-information">支払い情報の更新</a>を指示する必要があります。</p>
<p>サブスクリプションが<code>past_due</code>状態でも有効と見なしたい場合は、Cashierが提供する<code>keepPastDueSubscriptionsActive</code>メソッドを使用できます。通常、このメソッドは<code>AppServiceProvider</code>の<code>register</code>メソッドで呼び出す必要があります。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Paddle\Cashier</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * 任意のアプリケーションサービスを登録します。</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">Cashier</span><span class="o">::</span><span class="na">keepPastDueSubscriptionsActive</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>サブスクリプションが<code>past_due</code>状態の場合、支払い情報が更新されるまで変更できません。したがって、<code>swap</code>および<code>updateQuantity</code>メソッドは、サブスクリプションが<code>past_due</code>状態の場合に例外をスローします。</p>
</div>
<p><a name="subscription-scopes"></a></p>
<h4 id="_30">サブスクリプションスコープ<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h4>
<p>ほとんどのサブスクリプションステータスは、クエリスコープとしても利用できるため、指定された状態のサブスクリプションを簡単にクエリできます。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// すべての有効なサブスクリプションを取得します...</span>
<span class="nv">$subscriptions</span> <span class="o">=</span> <span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>

<span class="c1">// ユーザーのキャンセルされたサブスクリプションをすべて取得します...</span>
<span class="nv">$subscriptions</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscriptions</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">canceled</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p>利用可能なスコープの完全なリストは以下の通りです。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">valid</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">onTrial</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">expiredTrial</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">notOnTrial</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">active</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">recurring</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pastDue</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">paused</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">notPaused</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">onPausedGracePeriod</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">notOnPausedGracePeriod</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">canceled</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">notCanceled</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">onGracePeriod</span><span class="p">();</span>
<span class="nx">Subscription</span><span class="o">::</span><span class="na">query</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">notOnGracePeriod</span><span class="p">();</span>
</code></pre></div>
<p><a name="subscription-single-charges"></a></p>
<h3 id="_31">サブスクリプションの一括請求<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<p>サブスクリプションの一括請求を使用すると、サブスクライバーに対してサブスクリプションに加えて一括請求を行うことができます。<code>charge</code>メソッドを呼び出す際に、1つまたは複数の価格IDを提供する必要があります。</p>
<div class="highlight"><pre><span></span><code><span class="c1">// 単一の価格を請求します...</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">charge</span><span class="p">(</span><span class="s1">&#39;pri_123&#39;</span><span class="p">);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="c1">// 一度に複数の価格を請求する...</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">charge</span><span class="p">([</span><span class="s1">&#39;pri_123&#39;</span><span class="p">,</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">]);</span>
</code></pre></div>
<p><code>charge</code>メソッドは、サブスクリプションの次の請求期間まで、実際には顧客に請求しません。顧客に即座に請求したい場合は、代わりに<code>chargeAndInvoice</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">chargeAndInvoice</span><span class="p">(</span><span class="s1">&#39;pri_123&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a name="updating-payment-information"></a></p>
<h3 id="_32">支払い情報の更新<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<p>Paddleは常にサブスクリプションごとに支払い方法を保存します。サブスクリプションのデフォルトの支払い方法を更新したい場合は、サブスクリプションモデルの<code>redirectToUpdatePaymentMethod</code>メソッドを使用して、顧客をPaddleのホストされた支払い方法更新ページにリダイレクトする必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/update-payment-method&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>    <span class="nv">$user</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">();</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a>    <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">redirectToUpdatePaymentMethod</span><span class="p">();</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="p">});</span>
</code></pre></div>
<p>ユーザーが情報の更新を完了すると、<code>subscription_updated</code>ウェブフックがPaddleによってディスパッチされ、サブスクリプションの詳細がアプリケーションのデータベースで更新されます。</p>
<p><a name="changing-plans"></a></p>
<h3 id="_33">プランの変更<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<p>ユーザーがアプリケーションにサブスクライブした後、新しいサブスクリプションプランに変更したい場合があります。ユーザーのサブスクリプションプランを更新するには、Paddleの価格の識別子をサブスクリプションの<code>swap</code>メソッドに渡す必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">swap</span><span class="p">(</span><span class="nv">$premium</span> <span class="o">=</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">);</span>
</code></pre></div>
<p>プランを交換し、ユーザーに即座に請求したい場合は、<code>swapAndInvoice</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">swapAndInvoice</span><span class="p">(</span><span class="nv">$premium</span> <span class="o">=</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a name="prorations"></a></p>
<h4 id="_34">日割り計算<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h4>
<p>デフォルトでは、Paddleはプラン間の交換時に料金を日割り計算します。<code>noProrate</code>メソッドを使用して、料金を日割り計算せずにサブスクリプションを更新できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">noProrate</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">swap</span><span class="p">(</span><span class="nv">$premium</span> <span class="o">=</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">);</span>
</code></pre></div>
<p>日割り計算を無効にし、顧客に即座に請求したい場合は、<code>swapAndInvoice</code>メソッドと<code>noProrate</code>を組み合わせて使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">noProrate</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">swapAndInvoice</span><span class="p">(</span><span class="nv">$premium</span> <span class="o">=</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">);</span>
</code></pre></div>
<p>または、サブスクリプションの変更に対して顧客に請求しない場合は、<code>doNotBill</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">doNotBill</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">swap</span><span class="p">(</span><span class="nv">$premium</span> <span class="o">=</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">);</span>
</code></pre></div>
<p>Paddleの日割り計算ポリシーの詳細については、Paddleの<a href="https://developer.paddle.com/concepts/subscriptions/proration">日割り計算ドキュメント</a>を参照してください。</p>
<p><a name="subscription-quantity"></a></p>
<h3 id="_35">サブスクリプションの数量<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<p>サブスクリプションは、「数量」によって影響を受けることがあります。例えば、プロジェクト管理アプリケーションは、プロジェクトごとに月額$10を請求する場合があります。サブスクリプションの数量を簡単に増減するには、<code>incrementQuantity</code>と<code>decrementQuantity</code>メソッドを使用します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">incrementQuantity</span><span class="p">();</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="c1">// サブスクリプションの現在の数量に5を追加...</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">incrementQuantity</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">decrementQuantity</span><span class="p">();</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a><span class="c1">// サブスクリプションの現在の数量から5を引く...</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">decrementQuantity</span><span class="p">(</span><span class="mi">5</span><span class="p">);</span>
</code></pre></div>
<p>または、<code>updateQuantity</code>メソッドを使用して特定の数量を設定できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">updateQuantity</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</code></pre></div>
<p><code>noProrate</code>メソッドを使用して、料金を日割り計算せずにサブスクリプションの数量を更新できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">noProrate</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">updateQuantity</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span>
</code></pre></div>
<p><a name="quantities-for-subscription-with-multiple-products"></a></p>
<h4 id="_36">複数の製品を持つサブスクリプションの数量<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h4>
<p>サブスクリプションが<a href="#subscriptions-with-multiple-products">複数の製品を持つサブスクリプション</a>である場合、数量を増減する価格のIDをincrement / decrementメソッドの第2引数として渡す必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">incrementQuantity</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;price_chat&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a name="subscriptions-with-multiple-products"></a></p>
<h3 id="_37">複数の製品を持つサブスクリプション<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h3>
<p><a href="https://developer.paddle.com/build/subscriptions/add-remove-products-prices-addons">複数の製品を持つサブスクリプション</a>を使用すると、単一のサブスクリプションに複数の請求製品を割り当てることができます。例えば、顧客サービスの「ヘルプデスク」アプリケーションがあり、月額$10の基本サブスクリプションがあり、ライブチャットアドオン製品が追加で月額$15で提供されているとします。</p>
<p>サブスクリプションのチェックアウトセッションを作成する際、<code>subscribe</code>メソッドの第1引数として価格の配列を渡すことで、特定のサブスクリプションに複数の製品を指定できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/user/subscribe&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a>    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subscribe</span><span class="p">([</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>        <span class="s1">&#39;price_monthly&#39;</span><span class="p">,</span>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a>        <span class="s1">&#39;price_chat&#39;</span><span class="p">,</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a>    <span class="p">]);</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a>    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="p">});</span>
</code></pre></div>
<p>上記の例では、顧客は<code>default</code>サブスクリプションに2つの価格が添付されます。両方の価格は、それぞれの請求間隔で請求されます。必要に応じて、各価格の特定の数量を示すために、キー/値ペアの連想配列を渡すことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscribe</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;price_monthly&#39;</span><span class="p">,</span> <span class="s1">&#39;price_chat&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">]);</span>
</code></pre></div>
<p>既存のサブスクリプションに別の価格を追加したい場合は、サブスクリプションの<code>swap</code>メソッドを使用する必要があります。<code>swap</code>メソッドを呼び出す際には、サブスクリプションの現在の価格と数量も含める必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">swap</span><span class="p">([</span><span class="s1">&#39;price_chat&#39;</span><span class="p">,</span> <span class="s1">&#39;price_original&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">]);</span>
</code></pre></div>
<p>上記の例では、新しい価格が追加されますが、顧客は次の請求サイクルまで請求されません。即座に顧客に請求したい場合は、<code>swapAndInvoice</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">swapAndInvoice</span><span class="p">([</span><span class="s1">&#39;price_chat&#39;</span><span class="p">,</span> <span class="s1">&#39;price_original&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">]);</span>
</code></pre></div>
<p>サブスクリプションから価格を削除するには、<code>swap</code>メソッドを使用し、削除したい価格を省略します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">swap</span><span class="p">([</span><span class="s1">&#39;price_original&#39;</span> <span class="o">=&gt;</span> <span class="mi">2</span><span class="p">]);</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>サブスクリプションの最後の価格を削除することはできません。代わりに、サブスクリプションを単にキャンセルしてください。</p>
</div>
<p><a name="multiple-subscriptions"></a></p>
<h3 id="_38">複数のサブスクリプション<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h3>
<p>Paddleでは、顧客が複数のサブスクリプションを同時に持つことができます。例えば、ジムを運営しており、水泳サブスクリプションとダンベルサブスクリプションを提供しているとします。各サブスクリプションは異なる価格設定を持つことができます。もちろん、顧客はどちらか一方または両方のプランにサブスクライブできるはずです。</p>
<p>アプリケーションがサブスクリプションを作成する際、<code>subscribe</code>メソッドの第2引数としてサブスクリプションのタイプを提供できます。タイプは、ユーザーが開始しているサブスクリプションのタイプを表す任意の文字列です。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/swimming/subscribe&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a>    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subscribe</span><span class="p">(</span><span class="nv">$swimmingMonthly</span> <span class="o">=</span> <span class="s1">&#39;pri_123&#39;</span><span class="p">,</span> <span class="s1">&#39;swimming&#39;</span><span class="p">);</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a>    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a><span class="p">});</span>
</code></pre></div>
<p>この例では、顧客の月額水泳サブスクリプションを開始しています。しかし、後で年間サブスクリプションに切り替えたい場合があります。顧客のサブスクリプションを調整する際に、<code>swimming</code>サブスクリプションの価格を交換するだけです。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">(</span><span class="s1">&#39;swimming&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">swap</span><span class="p">(</span><span class="nv">$swimmingYearly</span> <span class="o">=</span> <span class="s1">&#39;pri_456&#39;</span><span class="p">);</span>
</code></pre></div>
<p>もちろん、サブスクリプションを完全にキャンセルすることもできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">(</span><span class="s1">&#39;swimming&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">cancel</span><span class="p">();</span>
</code></pre></div>
<p><a name="pausing-subscriptions"></a></p>
<h3 id="_39">サブスクリプションの一時停止<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h3>
<p>サブスクリプションを一時停止するには、ユーザーのサブスクリプションの<code>pause</code>メソッドを呼び出します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pause</span><span class="p">();</span>
</code></pre></div>
<p>サブスクリプションが一時停止されると、Cashierは自動的にデータベースの<code>paused_at</code>カラムを設定します。このカラムは、<code>paused</code>メソッドがいつ<code>true</code>を返すべきかを決定するために使用されます。例えば、顧客が3月1日にサブスクリプションを一時停止したが、サブスクリプションが3月5日まで再開される予定でなかった場合、<code>paused</code>メソッドは3月5日まで<code>false</code>を返し続けます。これは、通常、ユーザーが請求サイクルの終了までアプリケーションを使用し続けることが許可されているためです。</p>
<p>デフォルトでは、一時停止は次の請求間隔で行われるため、顧客は支払った期間の残りを使用できます。即座にサブスクリプションを一時停止したい場合は、<code>pauseNow</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pauseNow</span><span class="p">();</span>
</code></pre></div>
<p><code>pauseUntil</code>メソッドを使用して、サブスクリプションを特定の時点まで一時停止できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pauseUntil</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addMonth</span><span class="p">());</span>
</code></pre></div>
<p>または、<code>pauseNowUntil</code>メソッドを使用して、即座にサブスクリプションを特定の時点まで一時停止できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pauseNowUntil</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addMonth</span><span class="p">());</span>
</code></pre></div>
<p>ユーザーがサブスクリプションを一時停止したが、まだ「猶予期間」にいるかどうかを判断するには、<code>onPausedGracePeriod</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">onPausedGracePeriod</span><span class="p">())</span> <span class="p">{</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a>    <span class="c1">// ...</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="p">}</span>
</code></pre></div>
<p>一時停止されたサブスクリプションを再開するには、サブスクリプションの<code>resume</code>メソッドを呼び出します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">resume</span><span class="p">();</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>サブスクリプションが一時停止中は変更できません。別のプランに交換したり数量を更新したりする場合は、まずサブスクリプションを再開する必要があります。</p>
</div>
<p><a name="canceling-subscriptions"></a></p>
<h3 id="_40">サブスクリプションのキャンセル<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h3>
<p>サブスクリプションをキャンセルするには、ユーザーのサブスクリプションの<code>cancel</code>メソッドを呼び出します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cancel</span><span class="p">();</span>
</code></pre></div>
<p>サブスクリプションがキャンセルされると、Cashierは自動的にデータベース内の<code>ends_at</code>カラムを設定します。このカラムは、<code>subscribed</code>メソッドが<code>false</code>を返すべきタイミングを決定するために使用されます。例えば、顧客が3月1日にサブスクリプションをキャンセルしたが、サブスクリプションの終了予定日は3月5日であった場合、<code>subscribed</code>メソッドは3月5日まで<code>true</code>を返し続けます。これは、ユーザーが通常、請求サイクルの終了までアプリケーションを使用し続けることが許可されているためです。</p>
<p>ユーザーがサブスクリプションをキャンセルしたが、まだ「猶予期間」にいるかどうかを判断するには、<code>onGracePeriod</code>メソッドを使用できます:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">onGracePeriod</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>サブスクリプションを即座にキャンセルしたい場合は、サブスクリプションの<code>cancelNow</code>メソッドを呼び出すことができます:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">cancelNow</span><span class="p">();</span>
</code></pre></div>
<p>猶予期間中のサブスクリプションのキャンセルを停止するには、<code>stopCancelation</code>メソッドを呼び出すことができます:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">stopCancelation</span><span class="p">();</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Paddleのサブスクリプションは、キャンセル後に再開することはできません。顧客がサブスクリプションを再開したい場合は、新しいサブスクリプションを作成する必要があります。</p>
</div>
<p><a name="subscription-trials"></a></p>
<h2 id="_41">サブスクリプションのトライアル<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h2>
<p><a name="with-payment-method-up-front"></a></p>
<h3 id="_42">事前に支払い方法を収集するトライアル<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h3>
<p>顧客にトライアル期間を提供しながら、事前に支払い方法の情報を収集したい場合、顧客がサブスクライブする価格のPaddleダッシュボードでトライアル期間を設定する必要があります。その後、通常通りチェックアウトセッションを開始します:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/subscribe&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subscribe</span><span class="p">(</span><span class="s1">&#39;pri_monthly&#39;</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p>アプリケーションが<code>subscription_created</code>イベントを受け取ると、Cashierはトライアル期間の終了日をアプリケーションのデータベース内のサブスクリプションレコードに設定し、この日付まで顧客への請求を開始しないようPaddleに指示します。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>顧客のサブスクリプションがトライアル終了日までにキャンセルされない場合、トライアルが終了するとすぐに課金されますので、ユーザーにトライアル終了日を通知することを確認してください。</p>
</div>
<p>ユーザーがトライアル期間内にいるかどうかは、ユーザーインスタンスの<code>onTrial</code>メソッドまたはサブスクリプションインスタンスの<code>onTrial</code>メソッドを使用して判断できます。以下の2つの例は同等です:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>既存のトライアルが期限切れかどうかを判断するには、<code>hasExpiredTrial</code>メソッドを使用できます:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">hasExpiredTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">hasExpiredTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>特定のサブスクリプションタイプのトライアル中かどうかを判断するには、<code>onTrial</code>または<code>hasExpiredTrial</code>メソッドにタイプを指定できます:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">onTrial</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">hasExpiredTrial</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="without-payment-method-up-front"></a></p>
<h3 id="_43">事前に支払い方法を収集しないトライアル<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h3>
<p>顧客の支払い方法の情報を事前に収集せずにトライアル期間を提供したい場合、ユーザーに関連付けられた顧客レコードの<code>trial_ends_at</code>カラムを希望するトライアル終了日に設定できます。これは通常、ユーザー登録時に行われます:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
    <span class="c1">// ...</span>
<span class="p">]);</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createAsCustomer</span><span class="p">([</span>
    <span class="s1">&#39;trial_ends_at&#39;</span> <span class="o">=&gt;</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addDays</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="p">]);</span>
</code></pre></div>
<p>Cashierはこのタイプのトライアルを「ジェネリックトライアル」と呼び、既存のサブスクリプションに関連付けられていません。<code>User</code>インスタンスの<code>onTrial</code>メソッドは、現在の日付が<code>trial_ends_at</code>の値を過ぎていない場合に<code>true</code>を返します:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">onTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ユーザーはトライアル期間内です...</span>
<span class="p">}</span>
</code></pre></div>
<p>ユーザーのために実際のサブスクリプションを作成する準備ができたら、通常通り<code>subscribe</code>メソッドを使用できます:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user/subscribe&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscribe</span><span class="p">(</span><span class="s1">&#39;pri_monthly&#39;</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">returnTo</span><span class="p">(</span><span class="nx">route</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">));</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;billing&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p>ユーザーのトライアル終了日を取得するには、<code>trialEndsAt</code>メソッドを使用できます。このメソッドは、ユーザーがトライアル中の場合はCarbonの日付インスタンスを返し、そうでない場合は<code>null</code>を返します。デフォルト以外の特定のサブスクリプションのトライアル終了日を取得したい場合は、オプションのサブスクリプションタイプパラメータを渡すこともできます:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">onTrial</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$trialEndsAt</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">trialEndsAt</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>ユーザーがまだ実際のサブスクリプションを作成していない「ジェネリック」トライアル期間内にいるかどうかを知りたい場合は、<code>onGenericTrial</code>メソッドを使用できます:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">onGenericTrial</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ユーザーは「ジェネリック」トライアル期間内です...</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="extend-or-activate-a-trial"></a></p>
<h3 id="_44">トライアルの延長またはアクティベーション<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h3>
<p>既存のサブスクリプションのトライアル期間を延長するには、<code>extendTrial</code>メソッドを呼び出し、トライアルが終了する時点を指定します:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">extendTrial</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addDays</span><span class="p">(</span><span class="mi">5</span><span class="p">));</span>
</code></pre></div>
<p>または、トライアルを終了してサブスクリプションを即座にアクティベートするには、サブスクリプションの<code>activate</code>メソッドを呼び出します:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">activate</span><span class="p">();</span>
</code></pre></div>
<p><a name="handling-paddle-webhooks"></a></p>
<h2 id="paddle-webhooks">Paddle Webhooksの処理<a class="headerlink" href="#paddle-webhooks" title="Permanent link">&para;</a></h2>
<p>Paddleは、さまざまなイベントをWebhooks経由でアプリケーションに通知できます。デフォルトでは、Cashierのサービスプロバイダによって、CashierのWebhookコントローラを指すルートが登録されます。このコントローラは、すべての着信Webhookリクエストを処理します。</p>
<p>デフォルトでは、このコントローラは、失敗した請求が多すぎるサブスクリプションのキャンセル、サブスクリプションの更新、支払い方法の変更を自動的に処理します。しかし、すぐにわかるように、このコントローラを拡張して、好きなPaddle Webhookイベントを処理することができます。</p>
<p>アプリケーションがPaddle Webhooksを処理できるようにするには、<a href="https://vendors.paddle.com/alerts-webhooks">PaddleコントロールパネルでWebhook URLを設定</a>してください。デフォルトでは、CashierのWebhookコントローラは<code>/paddle/webhook</code> URLパスに応答します。Paddleコントロールパネルで有効にする必要があるすべてのWebhooksの完全なリストは以下の通りです:</p>
<ul>
<li>Customer Updated</li>
<li>Transaction Completed</li>
<li>Transaction Updated</li>
<li>Subscription Created</li>
<li>Subscription Updated</li>
<li>Subscription Paused</li>
<li>Subscription Canceled</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>着信リクエストをCashierの含まれる<a href="cashier-paddle.html#verifying-webhook-signatures">Webhook署名検証</a>ミドルウェアで保護するようにしてください。</p>
</div>
<p><a name="webhooks-csrf-protection"></a></p>
<h4 id="webhookscsrf">WebhooksとCSRF保護<a class="headerlink" href="#webhookscsrf" title="Permanent link">&para;</a></h4>
<p>Paddle WebhooksはLaravelの<a href="csrf.html">CSRF保護</a>をバイパスする必要があるため、アプリケーションの<code>bootstrap/app.php</code>ファイルで<code>paddle/*</code>をCSRF保護から除外するようにしてください:</p>
<div class="highlight"><pre><span></span><code><span class="o">-&gt;</span><span class="na">withMiddleware</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Middleware</span> <span class="nv">$middleware</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$middleware</span><span class="o">-&gt;</span><span class="na">validateCsrfTokens</span><span class="p">(</span><span class="nx">except</span><span class="o">:</span> <span class="p">[</span>
        <span class="s1">&#39;paddle/*&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">})</span>
</code></pre></div>
<p><a name="webhooks-local-development"></a></p>
<h4 id="webhooks">Webhooksとローカル開発<a class="headerlink" href="#webhooks" title="Permanent link">&para;</a></h4>
<p>Paddleがローカル開発中にアプリケーションにWebhooksを送信できるようにするには、<a href="https://ngrok.com/">Ngrok</a>や<a href="https://expose.dev/docs/introduction">Expose</a>などのサイト共有サービスを介してアプリケーションを公開する必要があります。<a href="sail.html">Laravel Sail</a>を使用してアプリケーションをローカルで開発している場合は、Sailの<a href="sail.html#sharing-your-site">サイト共有コマンド</a>を使用できます。</p>
<p><a name="defining-webhook-event-handlers"></a></p>
<h3 id="webhook">Webhookイベントハンドラの定義<a class="headerlink" href="#webhook" title="Permanent link">&para;</a></h3>
<p>Cashierは、失敗した請求によるサブスクリプションのキャンセルやその他の一般的なPaddle Webhooksを自動的に処理します。ただし、追加のWebhookイベントを処理したい場合は、Cashierが発行する以下のイベントをリッスンすることができます:</p>
<ul>
<li><code>Laravel\Paddle\Events\WebhookReceived</code></li>
<li><code>Laravel\Paddle\Events\WebhookHandled</code></li>
</ul>
<p>両方のイベントには、Paddle Webhookの完全なペイロードが含まれています。例えば、<code>transaction.billed</code> Webhookを処理したい場合は、イベントを処理する<a href="events.html#defining-listeners">リスナー</a>を登録できます:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Listeners</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Laravel\Paddle\Events\WebhookReceived</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">PaddleEventListener</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * Handle received Paddle webhooks.</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle</span><span class="p">(</span><span class="nx">WebhookReceived</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$event</span><span class="o">-&gt;</span><span class="na">payload</span><span class="p">[</span><span class="s1">&#39;event_type&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;transaction.billed&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Handle the incoming event...</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Cashierは、受信したWebhookのタイプに特化したイベントも発行します。Paddleからの完全なペイロードに加えて、請求可能なモデル、サブスクリプション、またはレシートなど、Webhookの処理に使用された関連モデルも含まれます:</p>
<div class="content-list">
<ul>
<li><code>Laravel\Paddle\Events\CustomerUpdated</code></li>
<li><code>Laravel\Paddle\Events\TransactionCompleted</code></li>
<li><code>Laravel\Paddle\Events\TransactionUpdated</code></li>
<li><code>Laravel\Paddle\Events\SubscriptionCreated</code></li>
<li><code>Laravel\Paddle\Events\SubscriptionUpdated</code></li>
<li><code>Laravel\Paddle\Events\SubscriptionPaused</code></li>
<li><code>Laravel\Paddle\Events\SubscriptionCanceled</code></li>
</ul>
</div>
<p>デフォルトの組み込みWebhookルートをオーバーライドするには、アプリケーションの<code>.env</code>ファイルで<code>CASHIER_WEBHOOK</code>環境変数を定義します。この値は、Webhookルートへの完全なURLである必要があり、Paddleコントロールパネルで設定されたURLと一致する必要があります:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="na">CASHIER_WEBHOOK</span><span class="o">=</span><span class="s">https://example.com/my-paddle-webhook-url</span>
</code></pre></div>
<p><a name="verifying-webhook-signatures"></a></p>
<h3 id="webhook_1">Webhook署名の検証<a class="headerlink" href="#webhook_1" title="Permanent link">&para;</a></h3>
<p>Webhookを安全にするために、<a href="https://developer.paddle.com/webhook-reference/verifying-webhooks">PaddleのWebhook署名検証</a>を使用できます。便利なことに、CashierにはPaddleのWebhookリクエストを検証するミドルウェアが含まれています。</p>
<p>すべての受信Webhookルートに<code>Laravel\Paddle\Http\Middleware\VerifyWebhookSignature</code>ミドルウェアを追加するだけで、Cashierはリクエストの署名を自動的に検証します:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Paddle\Http\Middleware\VerifyWebhookSignature</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/paddle/webhook&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="nx">VerifyWebhookSignature</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</code></pre></div>
<p>Webhookを保護するために、<a href="https://developer.paddle.com/webhook-reference/verifying-webhooks">PaddleのWebhook署名</a>を使用することができます。便宜上、Cashierは自動的にミドルウェアを含め、受信したPaddleのWebhookリクエストが有効であることを検証します。</p>
<p>Webhookの検証を有効にするには、アプリケーションの<code>.env</code>ファイルで<code>PADDLE_WEBHOOK_SECRET</code>環境変数が定義されていることを確認してください。Webhookシークレットは、Paddleアカウントのダッシュボードから取得できます。</p>
<p><a name="single-charges"></a></p>
<h2 id="_45">一括請求<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h2>
<p><a name="charging-for-products"></a></p>
<h3 id="_46">商品の請求<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h3>
<p>顧客に対して商品の購入を開始したい場合、請求可能なモデルインスタンスの<code>checkout</code>メソッドを使用して、購入のためのチェックアウトセッションを生成できます。<code>checkout</code>メソッドは、1つまたは複数の価格IDを受け取ります。必要に応じて、連想配列を使用して購入される商品の数量を指定できます：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/buy&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">([</span><span class="s1">&#39;pri_tshirt&#39;</span><span class="p">,</span> <span class="s1">&#39;pri_socks&#39;</span> <span class="o">=&gt;</span> <span class="mi">5</span><span class="p">]);</span>

    <span class="k">return</span> <span class="nx">view</span><span class="p">(</span><span class="s1">&#39;buy&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;checkout&#39;</span> <span class="o">=&gt;</span> <span class="nv">$checkout</span><span class="p">]);</span>
<span class="p">});</span>
</code></pre></div>
<p>チェックアウトセッションを生成した後、Cashierが提供する<code>paddle-button</code> <a href="#overlay-checkout">Bladeコンポーネント</a>を使用して、ユーザーがPaddleのチェックアウトウィジェットを表示し、購入を完了できるようにすることができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="x">&lt;x-paddle-button :checkout=&quot;$checkout&quot; class=&quot;px-8 py-4&quot;&gt;</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="x">    Buy</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="x">&lt;/x-paddle-button&gt;</span>
</code></pre></div>
<p>チェックアウトセッションには<code>customData</code>メソッドがあり、基礎となるトランザクション作成に任意のカスタムデータを渡すことができます。カスタムデータを渡す際に利用可能なオプションの詳細については、<a href="https://developer.paddle.com/build/transactions/custom-data">Paddleのドキュメント</a>を参照してください：</p>
<div class="highlight"><pre><span></span><code><span class="nv">$checkout</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">checkout</span><span class="p">(</span><span class="s1">&#39;pri_tshirt&#39;</span><span class="p">)</span>
    <span class="o">-&gt;</span><span class="na">customData</span><span class="p">([</span>
        <span class="s1">&#39;custom_option&#39;</span> <span class="o">=&gt;</span> <span class="nv">$value</span><span class="p">,</span>
    <span class="p">]);</span>
</code></pre></div>
<p><a name="refunding-transactions"></a></p>
<h3 id="_47">トランザクションの返金<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h3>
<p>トランザクションの返金は、購入時に使用された顧客の支払い方法に返金額を返します。Paddleの購入を返金する必要がある場合、<code>Cashier\Paddle\Transaction</code>モデルの<code>refund</code>メソッドを使用できます。このメソッドは、最初の引数として理由を受け取り、オプションの金額とともに1つ以上の価格IDを連想配列として返金します。特定の請求可能モデルのトランザクションを<code>transactions</code>メソッドを使用して取得できます。</p>
<p>例えば、価格<code>pri_123</code>と<code>pri_456</code>の特定のトランザクションを返金したいとします。<code>pri_123</code>を全額返金し、<code>pri_456</code>を2ドルだけ返金したい場合：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nv">$transaction</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">transactions</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">refund</span><span class="p">(</span><span class="s1">&#39;Accidental charge&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;pri_123&#39;</span><span class="p">,</span> <span class="c1">// この価格を全額返金...</span>
    <span class="s1">&#39;pri_456&#39;</span> <span class="o">=&gt;</span> <span class="mi">200</span><span class="p">,</span> <span class="c1">// この価格を部分的に返金...</span>
<span class="p">]);</span>
</code></pre></div>
<p>上記の例は、トランザクション内の特定の明細項目を返金します。トランザクション全体を返金したい場合は、単に理由を指定します：</p>
<div class="highlight"><pre><span></span><code><span class="nv">$response</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">refund</span><span class="p">(</span><span class="s1">&#39;Accidental charge&#39;</span><span class="p">);</span>
</code></pre></div>
<p>返金の詳細については、<a href="https://developer.paddle.com/build/transactions/create-transaction-adjustments">Paddleの返金ドキュメント</a>を参照してください。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>返金は、完全に処理される前に常にPaddleによって承認される必要があります。</p>
</div>
<p><a name="crediting-transactions"></a></p>
<h3 id="_48">トランザクションのクレジット<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h3>
<p>返金と同様に、トランザクションにクレジットを付与することもできます。トランザクションにクレジットを付与すると、顧客の残高に資金が追加され、将来の購入に使用できるようになります。トランザクションのクレジットは、手動で収集されたトランザクションに対してのみ行うことができ、自動的に収集されたトランザクション（サブスクリプションなど）には行うことができません。Paddleはサブスクリプションのクレジットを自動的に処理します：</p>
<div class="highlight"><pre><span></span><code><span class="nv">$transaction</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">transactions</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>

<span class="c1">// 特定の明細項目を全額クレジット...</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">credit</span><span class="p">(</span><span class="s1">&#39;Compensation&#39;</span><span class="p">,</span> <span class="s1">&#39;pri_123&#39;</span><span class="p">);</span>
</code></pre></div>
<p>詳細については、<a href="https://developer.paddle.com/build/transactions/create-transaction-adjustments">Paddleのクレジットに関するドキュメント</a>を参照してください。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>クレジットは、手動で収集されたトランザクションに対してのみ適用できます。自動的に収集されたトランザクションは、Paddle自身によってクレジットされます。</p>
</div>
<p><a name="transactions"></a></p>
<h2 id="_49">トランザクション<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h2>
<p>請求可能モデルのトランザクションの配列は、<code>transactions</code>プロパティを介して簡単に取得できます：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nv">$transactions</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">transactions</span><span class="p">;</span>
</code></pre></div>
<p>トランザクションは、商品および購入の支払いを表し、請求書が付随しています。完了したトランザクションのみがアプリケーションのデータベースに保存されます。</p>
<p>顧客のトランザクションをリストする際に、トランザクションインスタンスのメソッドを使用して、関連する支払い情報を表示できます。例えば、テーブルにすべてのトランザクションをリストし、ユーザーが請求書を簡単にダウンロードできるようにすることができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>    @foreach ($transactions as $transaction)
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a>        <span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ $transaction-&gt;billed_at-&gt;toFormattedDateString() }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a>            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ $transaction-&gt;total() }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a>            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span>{{ $transaction-&gt;tax() }}<span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>            <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;{{ route(&#39;download-invoice&#39;, $transaction-&gt;id) }}&quot;</span> <span class="na">target</span><span class="o">=</span><span class="s">&quot;_blank&quot;</span><span class="p">&gt;</span>Download<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>        <span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a>    @endforeach
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>
</code></pre></div>
<p><code>download-invoice</code>ルートは、次のようになります：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Paddle\Transaction</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/download-invoice/{transaction}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">,</span> <span class="nx">Transaction</span> <span class="nv">$transaction</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nv">$transaction</span><span class="o">-&gt;</span><span class="na">redirectToInvoicePdf</span><span class="p">();</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">(</span><span class="s1">&#39;download-invoice&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a name="past-and-upcoming-payments"></a></p>
<h3 id="_50">過去および今後の支払い<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h3>
<p><code>lastPayment</code>および<code>nextPayment</code>メソッドを使用して、顧客の過去または今後の支払いを取得し、表示できます。これは、繰り返しのサブスクリプションに対して行われます：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nv">$subscription</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">subscription</span><span class="p">();</span>

<span class="nv">$lastPayment</span> <span class="o">=</span> <span class="nv">$subscription</span><span class="o">-&gt;</span><span class="na">lastPayment</span><span class="p">();</span>
<span class="nv">$nextPayment</span> <span class="o">=</span> <span class="nv">$subscription</span><span class="o">-&gt;</span><span class="na">nextPayment</span><span class="p">();</span>
</code></pre></div>
<p>これらのメソッドはどちらも<code>Laravel\Paddle\Payment</code>のインスタンスを返します。ただし、<code>lastPayment</code>はトランザクションがまだWebhookによって同期されていない場合に<code>null</code>を返し、<code>nextPayment</code>は請求サイクルが終了した場合（サブスクリプションがキャンセルされた場合など）に<code>null</code>を返します：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="x">次の支払い: {{ $nextPayment-&gt;amount() }} 支払期限: {{ $nextPayment-&gt;date()-&gt;format(&#39;d/m/Y&#39;) }}</span>
</code></pre></div>
<p><a name="testing"></a></p>
<h2 id="_51">テスト<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h2>
<p>テスト中は、請求フローを手動でテストして、統合が期待どおりに機能することを確認する必要があります。</p>
<p>自動テスト（CI環境内で実行されるものを含む）の場合、<a href="http-client.html#testing">LaravelのHTTPクライアント</a>を使用して、PaddleへのHTTP呼び出しをフェイクすることができます。これにより、実際にPaddleのAPIを呼び出すことなくアプリケーションをテストする方法が提供されますが、Paddleからの実際のレスポンスはテストされません。</p>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
<nav class="md-footer-nav">
    
    
</nav>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["back-to-top", "navigation.expand", "navigation.tabs", "navigation.footer", "navigation.sections", "navigation.expand", "content.code.copy", "hide_repository_button", "content.code.annotate", "content.tabs.link", "toc.none", "content.action.edit"], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>