
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/koriym/l11ja/broadcasting.html">
      
      
        <link rel="prev" href="artisan.html">
      
      
        <link rel="next" href="cache.html">
      
      
      <link rel="icon" href="assets/images/favicon_io/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.35">
    
    
      
        <title>ブロードキャスティング - L11JA</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.35f28582.min.css">
      
      


    
    

    

    
      <link rel="stylesheet" href="assets/css/php.css">
    
      <link rel="stylesheet" href="assets/css/mkdocs_material_extra.css">
    
      <link rel="stylesheet" href="assets/css/extra.css">
    
      <link rel="stylesheet" href="assets/css/giscuss.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-G60CEHXLQ1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-G60CEHXLQ1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-G60CEHXLQ1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    

  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!-- Determine classes -->



<!-- Header -->
<header class="md-header" data-md-component="header">
  <nav
          class="md-header__inner md-grid"
          aria-label="Header"
  >

    <!-- Link to home -->
    <a
            href="."
            title="L11JA"
            class="md-header__button md-logo"
            aria-label="L11JA"
            data-md-component="logo"
    >
      
  <img src="assets/images/logo.png" alt="logo">

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            <span style="font-family: 'Noto Sans'; font-size: 20px" >
            L11JA
            </span>
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            <span style="font-family: 'Noto Sans Batak'; font-size: 20px" >
            
              ブロードキャスティング
            
            </span>
          </span>
        </div>
      </div>
    </div>

    <!-- Color palette toggle -->
    

    <!-- User preference: color palette -->
    
    <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
    <label class="md-header__button md-icon" for="__search">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
    </label>

    <!-- Search interface -->
    <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository information -->
    
    <div class="md-header__source">
      

<!--
  Check whether the repository is hosted on one of the supported code hosting
  platforms (GitHub, GitLab or Bitbucket) to show icon.
-->


  


<!-- Repository containing source -->
<a href="https://github.com/koriym/l11ja" title="source.link.title"
    class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg width="24" height="24" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" fill="#000"/></svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="releases.html" class="md-tabs__link">
          
  
  プロローグ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="installation.html" class="md-tabs__link">
          
  
  はじめに

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="lifecycle.html" class="md-tabs__link">
          
  
  アーキテクチャ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="routing.html" class="md-tabs__link">
          
  
  基本

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="artisan.html" class="md-tabs__link">
          
  
  掘り下げる

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="authentication.html" class="md-tabs__link">
          
  
  セキュリティ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="database.html" class="md-tabs__link">
          
  
  データベース

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="eloquent.html" class="md-tabs__link">
          
  
  Eloquent ORM

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="testing.html" class="md-tabs__link">
          
  
  テスト

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="starter-kits.html" class="md-tabs__link">
          
  
  パッケージ

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="L11JA" class="md-nav__button md-logo" aria-label="L11JA" data-md-component="logo">
      
  <img src="assets/images/logo.png" alt="logo">

    </a>
    L11JA
  </label>
  
    <div class="md-nav__source">
      

<!--
  Check whether the repository is hosted on one of the supported code hosting
  platforms (GitHub, GitLab or Bitbucket) to show icon.
-->


  


<!-- Repository containing source -->
<a href="https://github.com/koriym/l11ja" title="source.link.title"
    class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg width="24" height="24" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" fill="#000"/></svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    プロローグ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            プロローグ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="releases.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リリースノート
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="upgrade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    アップグレードガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contributions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    貢献ガイド
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            はじめに
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="installation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    インストール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="configuration.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    設定
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="structure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ディレクトリ構造
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="frontend.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    フロントエンド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="starter-kits.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    スターターキット
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deployment.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    デプロイ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    アーキテクチャ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            アーキテクチャ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lifecycle.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リクエストライフサイクル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="container.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    サービスコンテナ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="providers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    サービスプロバイダ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="facades.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファサード
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    基本
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            基本
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="routing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ルーティング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="middleware.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ミドルウェア
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="csrf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSRF保護
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="controllers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コントローラ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="requests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リクエスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="responses.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    レスポンス
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="views.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ビュー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="blade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bladeテンプレート
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vite.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    アセットバンドル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="urls.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    URL生成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="session.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    セッション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="validation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    バリデーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="errors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    エラー処理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="logging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ログ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    掘り下げる
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            掘り下げる
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="artisan.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artisanコンソール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    ブロードキャスティング
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="broadcasting.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    ブロードキャスティング
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
    <nav class="md-nav" aria-label="はじめに">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      サポートされているドライバ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      サーバーサイドのインストール
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サーバーサイドのインストール">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      設定
    </span>
  </a>
  
    <nav class="md-nav" aria-label="設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      インストール
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      キュー設定
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverb" class="md-nav__link">
    <span class="md-ellipsis">
      Reverb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pusher-channels" class="md-nav__link">
    <span class="md-ellipsis">
      Pusher Channels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ably" class="md-nav__link">
    <span class="md-ellipsis">
      Ably
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントサイドのインストール
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クライアントサイドのインストール">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reverb_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reverb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pusher-channels_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pusher Channels
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pusher Channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      既存のクライアントインスタンスの使用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ably_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ably
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      概念の概要
    </span>
  </a>
  
    <nav class="md-nav" aria-label="概念の概要">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      サンプルアプリケーションの使用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サンプルアプリケーションの使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shouldbroadcast" class="md-nav__link">
    <span class="md-ellipsis">
      ShouldBroadcastインターフェース
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルの認可
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      イベントブロードキャストのリッスン
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストイベントの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ブロードキャストイベントの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャスト名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストデータ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストキュー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャスト条件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ブロードキャスト条件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストとデータベーストランザクション
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルの承認
    </span>
  </a>
  
    <nav class="md-nav" aria-label="チャンネルの承認">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      承認コールバックの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="承認コールバックの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      認証コールバックモデルバインディング
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      認証コールバック認証
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルクラスの定義
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      イベントのブロードキャスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イベントのブロードキャスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      他のユーザーのみにブロードキャスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="他のユーザーのみにブロードキャスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      設定
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      接続のカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      匿名イベント
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストの受信
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ブロードキャストの受信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      イベントのリッスン
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イベントのリッスン">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      イベントリッスンの停止
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルの離脱
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      名前空間
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      プレゼンスチャンネル
    </span>
  </a>
  
    <nav class="md-nav" aria-label="プレゼンスチャンネル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      プレゼンスチャンネルの認可
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      プレゼンスチャンネルへの参加
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      プレゼンスチャンネルへのブロードキャスト
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      モデルのブロードキャスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルのブロードキャスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      モデルブロードキャストイベント作成のカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      モデルブロードキャストの規約
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルブロードキャストの規約">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルの規約
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      イベントの規約
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      モデルブロードキャストのリスニング
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントイベント
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      通知
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cache.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    キャッシュ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="collections.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コレクション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concurrency.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    並行処理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="context.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コンテキスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contracts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コントラクト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="events.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    イベント
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="filesystem.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファイルストレージ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="helpers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ヘルパー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http-client.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTPクライアント
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="localization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ローカライゼーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mail.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    メール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="notifications.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    通知
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="packages.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    パッケージ開発
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="processes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    プロセス
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="queues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    キュー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rate-limiting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    レート制限
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="strings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文字列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="scheduling.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    タスクスケジューリング
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    セキュリティ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            セキュリティ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="authentication.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認証
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="authorization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認可
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="verification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    メール確認
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="encryption.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    暗号化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hashing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ハッシュ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="passwords.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    パスワードリセット
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    データベース
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            データベース
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="database.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="queries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    クエリビルダ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pagination.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ページネーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="migrations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    マイグレーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="seeding.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    シーディング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="redis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Eloquent ORM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Eloquent ORM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-relationships.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リレーションシップ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-collections.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コレクション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-mutators.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ミューテータ / キャスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-resources.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APIリソース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-serialization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    シリアライゼーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-factories.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファクトリ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    テスト
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            テスト
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http-tests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTPテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="console-tests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コンソールテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dusk.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブラウザテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="database-testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    データベース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mocking.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    モック
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    パッケージ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            パッケージ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="starter-kits.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    スターターキット
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="billing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cashier (Stripe)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cashier-paddle.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cashier (Paddle)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dusk.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブラウザテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="envoy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Envoy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fortify.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fortify
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="folio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="homestead.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homestead
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="horizon.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Horizon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mix.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="octane.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octane
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="passport.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Passport
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pennant.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pennant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pint.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="precognition.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Precognition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="prompts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prompts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pulse.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pulse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reverb.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sail.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sail
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sanctum.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sanctum
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="scout.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="socialite.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Socialite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="telescope.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Telescope
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="valet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Valet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
    <nav class="md-nav" aria-label="はじめに">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      サポートされているドライバ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      サーバーサイドのインストール
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サーバーサイドのインストール">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      設定
    </span>
  </a>
  
    <nav class="md-nav" aria-label="設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      インストール
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      キュー設定
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reverb" class="md-nav__link">
    <span class="md-ellipsis">
      Reverb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pusher-channels" class="md-nav__link">
    <span class="md-ellipsis">
      Pusher Channels
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ably" class="md-nav__link">
    <span class="md-ellipsis">
      Ably
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントサイドのインストール
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クライアントサイドのインストール">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reverb_1" class="md-nav__link">
    <span class="md-ellipsis">
      Reverb
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pusher-channels_1" class="md-nav__link">
    <span class="md-ellipsis">
      Pusher Channels
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pusher Channels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      既存のクライアントインスタンスの使用
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ably_1" class="md-nav__link">
    <span class="md-ellipsis">
      Ably
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      概念の概要
    </span>
  </a>
  
    <nav class="md-nav" aria-label="概念の概要">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      サンプルアプリケーションの使用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="サンプルアプリケーションの使用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shouldbroadcast" class="md-nav__link">
    <span class="md-ellipsis">
      ShouldBroadcastインターフェース
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルの認可
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      イベントブロードキャストのリッスン
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストイベントの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ブロードキャストイベントの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャスト名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストデータ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストキュー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャスト条件
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ブロードキャスト条件">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストとデータベーストランザクション
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルの承認
    </span>
  </a>
  
    <nav class="md-nav" aria-label="チャンネルの承認">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      承認コールバックの定義
    </span>
  </a>
  
    <nav class="md-nav" aria-label="承認コールバックの定義">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      認証コールバックモデルバインディング
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      認証コールバック認証
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルクラスの定義
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      イベントのブロードキャスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イベントのブロードキャスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      他のユーザーのみにブロードキャスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="他のユーザーのみにブロードキャスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      設定
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      接続のカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      匿名イベント
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      ブロードキャストの受信
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ブロードキャストの受信">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      イベントのリッスン
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イベントのリッスン">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      イベントリッスンの停止
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルの離脱
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      名前空間
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      プレゼンスチャンネル
    </span>
  </a>
  
    <nav class="md-nav" aria-label="プレゼンスチャンネル">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      プレゼンスチャンネルの認可
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      プレゼンスチャンネルへの参加
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      プレゼンスチャンネルへのブロードキャスト
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      モデルのブロードキャスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルのブロードキャスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      モデルブロードキャストイベント作成のカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      モデルブロードキャストの規約
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルブロードキャストの規約">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      チャンネルの規約
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      イベントの規約
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      モデルブロードキャストのリスニング
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントイベント
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      通知
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/koriym/l11ja/edit/11.x-ja/broadcasting.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="_1">ブロードキャスト<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="#introduction">はじめに</a></li>
<li><a href="#server-side-installation">サーバーサイドのインストール</a><ul>
<li><a href="#configuration">設定</a></li>
<li><a href="#reverb">Reverb</a></li>
<li><a href="#pusher-channels">Pusher Channels</a></li>
<li><a href="#ably">Ably</a></li>
</ul>
</li>
<li><a href="#client-side-installation">クライアントサイドのインストール</a><ul>
<li><a href="#client-reverb">Reverb</a></li>
<li><a href="#client-pusher-channels">Pusher Channels</a></li>
<li><a href="#client-ably">Ably</a></li>
</ul>
</li>
<li><a href="#concept-overview">概念の概要</a><ul>
<li><a href="#using-example-application">サンプルアプリケーションの使用</a></li>
</ul>
</li>
<li><a href="#defining-broadcast-events">ブロードキャストイベントの定義</a><ul>
<li><a href="#broadcast-name">ブロードキャスト名</a></li>
<li><a href="#broadcast-data">ブロードキャストデータ</a></li>
<li><a href="#broadcast-queue">ブロードキャストキュー</a></li>
<li><a href="#broadcast-conditions">ブロードキャスト条件</a></li>
<li><a href="#broadcasting-and-database-transactions">ブロードキャストとデータベーストランザクション</a></li>
</ul>
</li>
<li><a href="#authorizing-channels">チャンネルの認可</a><ul>
<li><a href="#defining-authorization-callbacks">認可コールバックの定義</a></li>
<li><a href="#defining-channel-classes">チャンネルクラスの定義</a></li>
</ul>
</li>
<li><a href="#broadcasting-events">イベントのブロードキャスト</a><ul>
<li><a href="#only-to-others">他のユーザーのみ</a></li>
<li><a href="#customizing-the-connection">接続のカスタマイズ</a></li>
<li><a href="#anonymous-events">匿名イベント</a></li>
</ul>
</li>
<li><a href="#receiving-broadcasts">ブロードキャストの受信</a><ul>
<li><a href="#listening-for-events">イベントのリスニング</a></li>
<li><a href="#leaving-a-channel">チャンネルからの退出</a></li>
<li><a href="#namespaces">名前空間</a></li>
</ul>
</li>
<li><a href="#presence-channels">プレゼンスチャンネル</a><ul>
<li><a href="#authorizing-presence-channels">プレゼンスチャンネルの認可</a></li>
<li><a href="#joining-presence-channels">プレゼンスチャンネルへの参加</a></li>
<li><a href="#broadcasting-to-presence-channels">プレゼンスチャンネルへのブロードキャスト</a></li>
</ul>
</li>
<li><a href="#model-broadcasting">モデルのブロードキャスト</a><ul>
<li><a href="#model-broadcasting-conventions">モデルブロードキャストの規約</a></li>
<li><a href="#listening-for-model-broadcasts">モデルブロードキャストのリスニング</a></li>
</ul>
</li>
<li><a href="#client-events">クライアントイベント</a></li>
<li><a href="#notifications">通知</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="_2">はじめに<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>多くの現代のWebアプリケーションでは、リアルタイムでライブアップデートされるユーザーインターフェースを実装するためにWebSocketsが使用されています。サーバー上のデータが更新されると、通常、WebSocket接続を介してメッセージが送信され、クライアントによって処理されます。WebSocketsは、UIに反映されるべきデータの変更を反映するために、アプリケーションのサーバーに継続的にポーリングするよりも効率的な代替手段を提供します。</p>
<p>例えば、アプリケーションがユーザーのデータをCSVファイルにエクスポートし、メールで送信することができると想像してください。しかし、このCSVファイルの作成には数分かかるため、<a href="queues.html">キュージョブ</a>内でCSVの作成とメール送信を行うことにします。CSVが作成され、ユーザーにメールで送信されたとき、イベントブロードキャストを使用して<code>App\Events\UserDataExported</code>イベントをディスパッチし、アプリケーションのJavaScriptで受信できます。イベントが受信されると、ユーザーにCSVがメールで送信されたことをメッセージで表示し、ページをリフレッシュする必要がなくなります。</p>
<p>このような機能を構築するのを支援するために、LaravelはサーバーサイドのLaravel <a href="events.html">イベント</a>をWebSocket接続を介して「ブロードキャスト」することを容易にします。Laravelイベントのブロードキャストにより、サーバーサイドのLaravelアプリケーションとクライアントサイドのJavaScriptアプリケーション間で同じイベント名とデータを共有できます。</p>
<p>ブロードキャストの背後にある中心的な概念はシンプルです：クライアントはフロントエンドで名前付きチャンネルに接続し、Laravelアプリケーションはバックエンドでこれらのチャンネルにイベントをブロードキャストします。これらのイベントには、フロントエンドで利用可能にしたい追加のデータを含めることができます。</p>
<p><a name="supported-drivers"></a></p>
<h4 id="_3">サポートされているドライバ<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<p>デフォルトで、Laravelには3つのサーバーサイドのブロードキャストドライバが含まれています：<a href="https://reverb.laravel.com">Laravel Reverb</a>、<a href="https://pusher.com/channels">Pusher Channels</a>、および<a href="https://ably.com">Ably</a>。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>イベントブロードキャストに入る前に、Laravelの<a href="events.html">イベントとリスナー</a>のドキュメントを読むことを確認してください。</p>
</div>
<p><a name="server-side-installation"></a></p>
<h2 id="_4">サーバーサイドのインストール<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>Laravelのイベントブロードキャストを使用するためには、Laravelアプリケーション内でいくつかの設定を行い、いくつかのパッケージをインストールする必要があります。</p>
<p>イベントブロードキャストは、サーバーサイドのブロードキャストドライバによって実現され、Laravelイベントをブロードキャストして、ブラウザクライアント内で受信できるようにします。心配しないでください。インストールプロセスの各部分を段階的に説明します。</p>
<p><a name="configuration"></a></p>
<h3 id="_5">設定<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>アプリケーションのすべてのイベントブロードキャスト設定は、<code>config/broadcasting.php</code>設定ファイルに保存されます。このディレクトリがアプリケーションに存在しない場合でも心配しないでください。<code>install:broadcasting</code> Artisanコマンドを実行すると作成されます。</p>
<p>Laravelはいくつかのブロードキャストドライバをデフォルトでサポートしています：<a href="reverb.html">Laravel Reverb</a>、<a href="https://pusher.com/channels">Pusher Channels</a>、<a href="https://ably.com">Ably</a>、およびローカル開発とデバッグ用の<code>log</code>ドライバ。さらに、テスト中にブロードキャストを無効にするための<code>null</code>ドライバも含まれています。これらのドライバの設定例は、<code>config/broadcasting.php</code>設定ファイルに含まれています。</p>
<p><a name="installation"></a></p>
<h4 id="_6">インストール<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>デフォルトでは、ブロードキャストは新しいLaravelアプリケーションでは有効になっていません。<code>install:broadcasting</code> Artisanコマンドを使用してブロードキャストを有効にできます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>install:broadcasting
</code></pre></div>
<p><code>install:broadcasting</code>コマンドは、<code>config/broadcasting.php</code>設定ファイルを作成します。さらに、アプリケーションのブロードキャスト認可ルートとコールバックを登録できる<code>routes/channels.php</code>ファイルを作成します。</p>
<p><a name="queue-configuration"></a></p>
<h4 id="_7">キュー設定<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h4>
<p>イベントをブロードキャストする前に、最初に<a href="queues.html">キューワーカー</a>を設定して実行する必要があります。すべてのイベントブロードキャストはキュージョブを介して行われるため、アプリケーションの応答時間はイベントのブロードキャストによって深刻に影響を受けません。</p>
<p><a name="reverb"></a></p>
<h3 id="reverb">Reverb<a class="headerlink" href="#reverb" title="Permanent link">&para;</a></h3>
<p><code>install:broadcasting</code>コマンドを実行すると、<a href="reverb.html">Laravel Reverb</a>のインストールを求められます。もちろん、Composerパッケージマネージャを使用して手動でReverbをインストールすることもできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>composer<span class="w"> </span>require<span class="w"> </span>laravel/reverb
</code></pre></div>
<p>パッケージがインストールされたら、Reverbのインストールコマンドを実行して設定を公開し、Reverbの必要な環境変数を追加し、アプリケーションでイベントブロードキャストを有効にできます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>reverb:install
</code></pre></div>
<p>Reverbのインストールと使用方法の詳細な手順は、<a href="reverb.html">Reverbドキュメント</a>で確認できます。</p>
<p><a name="pusher-channels"></a></p>
<h3 id="pusher-channels">Pusher Channels<a class="headerlink" href="#pusher-channels" title="Permanent link">&para;</a></h3>
<p>イベントを<a href="https://pusher.com/channels">Pusher Channels</a>を使用してブロードキャストする場合、Composerパッケージマネージャを使用してPusher Channels PHP SDKをインストールする必要があります：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>composer<span class="w"> </span>require<span class="w"> </span>pusher/pusher-php-server
</code></pre></div>
<p>次に、<code>config/broadcasting.php</code>設定ファイルでPusher Channelsの認証情報を設定する必要があります。このファイルには、キー、シークレット、アプリケーションIDをすばやく指定できるPusher Channelsの設定例が既に含まれています。通常、Pusher Channelsの認証情報はアプリケーションの<code>.env</code>ファイルで設定する必要があります：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="na">PUSHER_APP_ID</span><span class="o">=</span><span class="s">&quot;your-pusher-app-id&quot;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="na">PUSHER_APP_KEY</span><span class="o">=</span><span class="s">&quot;your-pusher-key&quot;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="na">PUSHER_APP_SECRET</span><span class="o">=</span><span class="s">&quot;your-pusher-secret&quot;</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="na">PUSHER_HOST</span><span class="o">=</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="na">PUSHER_PORT</span><span class="o">=</span><span class="s">443</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="na">PUSHER_SCHEME</span><span class="o">=</span><span class="s">&quot;https&quot;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="na">PUSHER_APP_CLUSTER</span><span class="o">=</span><span class="s">&quot;mt1&quot;</span>
</code></pre></div>
<p><code>config/broadcasting.php</code>ファイルの<code>pusher</code>設定では、クラスタなど、Channelsでサポートされている追加の<code>options</code>を指定することもできます。</p>
<p>次に、アプリケーションの<code>.env</code>ファイルで<code>BROADCAST_CONNECTION</code>環境変数を<code>pusher</code>に設定します：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="na">BROADCAST_CONNECTION</span><span class="o">=</span><span class="s">pusher</span>
</code></pre></div>
<p>最後に、クライアントサイドでブロードキャストイベントを受信するために、<a href="#client-side-installation">Laravel Echo</a>をインストールして設定する準備が整いました。</p>
<p><a name="ably"></a></p>
<h3 id="ably">Ably<a class="headerlink" href="#ably" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>以下のドキュメントでは、Ablyを「Pusher互換」モードで使用する方法について説明します。ただし、Ablyチームは、Ablyが提供する独自の機能を活用できるブロードキャスタとEchoクライアントを推奨しています。Ablyが提供するドライバの使用に関する詳細は、<a href="https://github.com/ably/laravel-broadcaster">AblyのLaravelブロードキャスタドキュメント</a>を参照してください。</p>
</div>
<p>イベントを<a href="https://ably.com">Ably</a>を使用してブロードキャストする場合、Composerパッケージマネージャを使用してAbly PHP SDKをインストールする必要があります：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>composer<span class="w"> </span>require<span class="w"> </span>ably/ably-php
</code></pre></div>
<p>次に、<code>config/broadcasting.php</code>設定ファイルでAblyの認証情報を設定する必要があります。このファイルには、キーをすばやく指定できるAblyの設定例が既に含まれています。通常、この値は<code>ABLY_KEY</code><a href="configuration.html#environment-configuration">環境変数</a>を介して設定する必要があります：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="na">ABLY_KEY</span><span class="o">=</span><span class="s">your-ably-key</span>
</code></pre></div>
<p>次に、アプリケーションの<code>.env</code>ファイルで<code>BROADCAST_CONNECTION</code>環境変数を<code>ably</code>に設定します：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="na">BROADCAST_CONNECTION</span><span class="o">=</span><span class="s">ably</span>
</code></pre></div>
<p>最後に、クライアントサイドでブロードキャストイベントを受信するために、<a href="#client-side-installation">Laravel Echo</a>をインストールして設定する準備が整いました。</p>
<p><a name="client-side-installation"></a></p>
<h2 id="_8">クライアントサイドのインストール<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p><a name="client-reverb"></a></p>
<h3 id="reverb_1">Reverb<a class="headerlink" href="#reverb_1" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/laravel/echo">Laravel Echo</a>は、チャンネルを購読し、サーバーサイドのブロードキャストドライバによってブロードキャストされたイベントをリスニングすることを容易にするJavaScriptライブラリです。NPMパッケージマネージャを介してEchoをインストールできます。この例では、ReverbはWebSocketのサブスクリプション、チャンネル、メッセージにPusherプロトコルを使用するため、<code>pusher-js</code>パッケージもインストールします：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a>npm<span class="w"> </span>install<span class="w"> </span>--save-dev<span class="w"> </span>laravel-echo<span class="w"> </span>pusher-js
</code></pre></div>
<p>Echoがインストールされたら、アプリケーションのJavaScriptで新しいEchoインスタンスを作成する準備が整いました。これを行う良い場所は、Laravelフレームワークに含まれている<code>resources/js/bootstrap.js</code>ファイルの最後です。デフォルトでは、Echoの設定例がこのファイルに既に含まれています - 単にそれをアンコメントし、<code>broadcaster</code>設定オプションを<code>reverb</code>に更新するだけです：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">Echo</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;laravel-echo&#39;</span><span class="p">;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="k">import</span><span class="w"> </span><span class="nx">Pusher</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pusher-js&#39;</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nb">window</span><span class="p">.</span><span class="nx">Pusher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Pusher</span><span class="p">;</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Echo</span><span class="p">({</span>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="nx">broadcaster</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;reverb&#39;</span><span class="p">,</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_REVERB_APP_KEY</span><span class="p">,</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">    </span><span class="nx">wsHost</span><span class="o">:</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_REVERB_HOST</span><span class="p">,</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="nx">wsPort</span><span class="o">:</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_REVERB_PORT</span><span class="p">,</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="nx">wssPort</span><span class="o">:</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_REVERB_PORT</span><span class="p">,</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="w">    </span><span class="nx">forceTLS</span><span class="o">:</span><span class="w"> </span><span class="p">(</span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_REVERB_SCHEME</span><span class="w"> </span><span class="o">??</span><span class="w"> </span><span class="s1">&#39;https&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s1">&#39;https&#39;</span><span class="p">,</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="w">    </span><span class="nx">enabledTransports</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="s1">&#39;ws&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;wss&#39;</span><span class="p">],</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="p">});</span>
</code></pre></div>
<p>次に、アプリケーションのアセットをコンパイルする必要があります：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>npm<span class="w"> </span>run<span class="w"> </span>build
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Laravel Echoの<code>reverb</code>ブロードキャスターにはlaravel-echo v1.16.0以上が必要です。</p>
</div>
<p><a name="client-pusher-channels"></a></p>
<h3 id="pusher-channels_1">Pusher Channels<a class="headerlink" href="#pusher-channels_1" title="Permanent link">&para;</a></h3>
<p><a href="https://github.com/laravel/echo">Laravel Echo</a>は、サーバーサイドのブロードキャストドライバによってブロードキャストされるイベントを購読し、リッスンするのを容易にするJavaScriptライブラリです。Echoはまた、WebSocketのサブスクリプション、チャンネル、メッセージのためにPusherプロトコルを実装するために<code>pusher-js</code> NPMパッケージを活用します。</p>
<p><code>install:broadcasting</code> Artisanコマンドは自動的に<code>laravel-echo</code>と<code>pusher-js</code>パッケージをインストールしますが、これらのパッケージは手動でNPMを介してインストールすることもできます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>npm<span class="w"> </span>install<span class="w"> </span>--save-dev<span class="w"> </span>laravel-echo<span class="w"> </span>pusher-js
</code></pre></div>
<p>Echoがインストールされたら、アプリケーションのJavaScriptで新しいEchoインスタンスを作成する準備が整いました。<code>install:broadcasting</code>コマンドは<code>resources/js/echo.js</code>にEcho設定ファイルを作成しますが、このファイルのデフォルト設定はLaravel Reverb向けです。以下の設定をコピーして、設定をPusherに移行することができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">Echo</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;laravel-echo&#39;</span><span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">import</span><span class="w"> </span><span class="nx">Pusher</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pusher-js&#39;</span><span class="p">;</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="nb">window</span><span class="p">.</span><span class="nx">Pusher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Pusher</span><span class="p">;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Echo</span><span class="p">({</span>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="nx">broadcaster</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_PUSHER_APP_KEY</span><span class="p">,</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a><span class="w">    </span><span class="nx">cluster</span><span class="o">:</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_PUSHER_APP_CLUSTER</span><span class="p">,</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a><span class="w">    </span><span class="nx">forceTLS</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a><span class="p">});</span>
</code></pre></div>
<p>次に、アプリケーションの<code>.env</code>ファイルでPusher環境変数に適切な値を定義する必要があります。これらの変数がまだ<code>.env</code>ファイルに存在しない場合は、追加する必要があります：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="na">PUSHER_APP_ID</span><span class="o">=</span><span class="s">&quot;your-pusher-app-id&quot;</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="na">PUSHER_APP_KEY</span><span class="o">=</span><span class="s">&quot;your-pusher-key&quot;</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="na">PUSHER_APP_SECRET</span><span class="o">=</span><span class="s">&quot;your-pusher-secret&quot;</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="na">PUSHER_HOST</span><span class="o">=</span>
<a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="na">PUSHER_PORT</span><span class="o">=</span><span class="s">443</span>
<a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="na">PUSHER_SCHEME</span><span class="o">=</span><span class="s">&quot;https&quot;</span>
<a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="na">PUSHER_APP_CLUSTER</span><span class="o">=</span><span class="s">&quot;mt1&quot;</span>
<a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a>
<a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="na">VITE_APP_NAME</span><span class="o">=</span><span class="s">&quot;${APP_NAME}&quot;</span>
<a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="na">VITE_PUSHER_APP_KEY</span><span class="o">=</span><span class="s">&quot;${PUSHER_APP_KEY}&quot;</span>
<a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="na">VITE_PUSHER_HOST</span><span class="o">=</span><span class="s">&quot;${PUSHER_HOST}&quot;</span>
<a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="na">VITE_PUSHER_PORT</span><span class="o">=</span><span class="s">&quot;${PUSHER_PORT}&quot;</span>
<a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="na">VITE_PUSHER_SCHEME</span><span class="o">=</span><span class="s">&quot;${PUSHER_SCHEME}&quot;</span>
<a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a><span class="na">VITE_PUSHER_APP_CLUSTER</span><span class="o">=</span><span class="s">&quot;${PUSHER_APP_CLUSTER}&quot;</span>
</code></pre></div>
<p>Echoの設定をアプリケーションのニーズに合わせて調整したら、アプリケーションのアセットをコンパイルすることができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>npm<span class="w"> </span>run<span class="w"> </span>build
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>アプリケーションのJavaScriptアセットのコンパイルについて詳しく学ぶには、<a href="vite.html">Vite</a>のドキュメントを参照してください。</p>
</div>
<p><a name="using-an-existing-client-instance"></a></p>
<h4 id="_9">既存のクライアントインスタンスの使用<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h4>
<p>既に設定済みのPusher Channelsクライアントインスタンスがあり、それをEchoで利用したい場合は、<code>client</code>設定オプションを介してEchoに渡すことができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">Echo</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;laravel-echo&#39;</span><span class="p">;</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="k">import</span><span class="w"> </span><span class="nx">Pusher</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pusher-js&#39;</span><span class="p">;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="kd">const</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="nx">broadcaster</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;your-pusher-channels-key&#39;</span>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="p">}</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Echo</span><span class="p">({</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="w">    </span><span class="p">...</span><span class="nx">options</span><span class="p">,</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">    </span><span class="nx">client</span><span class="o">:</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Pusher</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span><span class="w"> </span><span class="nx">options</span><span class="p">)</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="p">});</span>
</code></pre></div>
<p><a name="client-ably"></a></p>
<h3 id="ably_1">Ably<a class="headerlink" href="#ably_1" title="Permanent link">&para;</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>以下のドキュメントでは、Ablyを「Pusher互換」モードで使用する方法について説明します。ただし、Ablyチームは、Ablyが提供する独自の機能を活用できるブロードキャスターとEchoクライアントを推奨し、メンテナンスしています。Ablyがメンテナンスするドライバーの使用について詳しくは、<a href="https://github.com/ably/laravel-broadcaster">AblyのLaravelブロードキャスタードキュメント</a>を参照してください。</p>
</div>
<p><a href="https://github.com/laravel/echo">Laravel Echo</a>は、サーバーサイドのブロードキャストドライバによってブロードキャストされるイベントを購読し、リッスンするのを容易にするJavaScriptライブラリです。Echoはまた、WebSocketのサブスクリプション、チャンネル、メッセージのためにPusherプロトコルを実装するために<code>pusher-js</code> NPMパッケージを活用します。</p>
<p><code>install:broadcasting</code> Artisanコマンドは自動的に<code>laravel-echo</code>と<code>pusher-js</code>パッケージをインストールしますが、これらのパッケージは手動でNPMを介してインストールすることもできます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>npm<span class="w"> </span>install<span class="w"> </span>--save-dev<span class="w"> </span>laravel-echo<span class="w"> </span>pusher-js
</code></pre></div>
<p><strong>続行する前に、Ablyアプリケーションの設定でPusherプロトコルサポートを有効にする必要があります。この機能は、Ablyアプリケーションの設定ダッシュボードの「Protocol Adapter Settings」部分で有効にできます。</strong></p>
<p>Echoがインストールされたら、アプリケーションのJavaScriptで新しいEchoインスタンスを作成する準備が整いました。<code>install:broadcasting</code>コマンドは<code>resources/js/echo.js</code>にEcho設定ファイルを作成しますが、このファイルのデフォルト設定はLaravel Reverb向けです。以下の設定をコピーして、設定をAblyに移行することができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">import</span><span class="w"> </span><span class="nx">Echo</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;laravel-echo&#39;</span><span class="p">;</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="k">import</span><span class="w"> </span><span class="nx">Pusher</span><span class="w"> </span><span class="kr">from</span><span class="w"> </span><span class="s1">&#39;pusher-js&#39;</span><span class="p">;</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="nb">window</span><span class="p">.</span><span class="nx">Pusher</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Pusher</span><span class="p">;</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Echo</span><span class="p">({</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">    </span><span class="nx">broadcaster</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="nx">key</span><span class="o">:</span><span class="w"> </span><span class="k">import</span><span class="p">.</span><span class="nx">meta</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">VITE_ABLY_PUBLIC_KEY</span><span class="p">,</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">    </span><span class="nx">wsHost</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;realtime-pusher.ably.io&#39;</span><span class="p">,</span>
<a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">    </span><span class="nx">wsPort</span><span class="o">:</span><span class="w"> </span><span class="mf">443</span><span class="p">,</span>
<a id="__codelineno-18-11" name="__codelineno-18-11" href="#__codelineno-18-11"></a><span class="w">    </span><span class="nx">disableStats</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-18-12" name="__codelineno-18-12" href="#__codelineno-18-12"></a><span class="w">    </span><span class="nx">encrypted</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span>
<a id="__codelineno-18-13" name="__codelineno-18-13" href="#__codelineno-18-13"></a><span class="p">});</span>
</code></pre></div>
<p>Ably Echo設定で<code>VITE_ABLY_PUBLIC_KEY</code>環境変数を参照していることに注意してください。この変数の値は、Ablyの公開鍵である必要があります。公開鍵は、Ablyのキーのうち<code>:</code>文字の前にある部分です。</p>
<p>Echoの設定をニーズに合わせて調整したら、アプリケーションのアセットをコンパイルすることができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a>npm<span class="w"> </span>run<span class="w"> </span>dev
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>アプリケーションのJavaScriptアセットのコンパイルについて詳しく学ぶには、<a href="vite.html">Vite</a>のドキュメントを参照してください。</p>
</div>
<p><a name="concept-overview"></a></p>
<h2 id="_10">概念の概要<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>Laravelのイベントブロードキャストにより、サーバーサイドのLaravelイベントをWebSocketを使用してクライアントサイドのJavaScriptアプリケーションにブロードキャストすることができます。現在、Laravelには<a href="https://pusher.com/channels">Pusher Channels</a>と<a href="https://ably.com">Ably</a>のドライバが付属しています。イベントは、<a href="#client-side-installation">Laravel Echo</a> JavaScriptパッケージを使用してクライアントサイドで簡単に消費できます。</p>
<p>イベントは「チャンネル」を介してブロードキャストされ、チャンネルは公開または非公開として指定できます。アプリケーションの訪問者は、認証や承認なしに公開チャンネルを購読できます。ただし、非公開チャンネルを購読するには、ユーザーは認証され、そのチャンネルをリッスンする権限が必要です。</p>
<p><a name="using-example-application"></a></p>
<h3 id="_11">サンプルアプリケーションの使用<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p>イベントブロードキャストの各コンポーネントに飛び込む前に、eコマースストアを例にして高レベルの概要を説明しましょう。</p>
<p>アプリケーションで、ユーザーが注文の配送状況を表示できるページがあるとします。また、配送状況の更新がアプリケーションによって処理されるときに<code>OrderShipmentStatusUpdated</code>イベントが発生するとします：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Events\OrderShipmentStatusUpdated</span><span class="p">;</span>

<span class="nx">OrderShipmentStatusUpdated</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$order</span><span class="p">);</span>
</code></pre></div>
<p><a name="the-shouldbroadcast-interface"></a></p>
<h4 id="shouldbroadcast"><code>ShouldBroadcast</code>インターフェース<a class="headerlink" href="#shouldbroadcast" title="Permanent link">&para;</a></h4>
<p>ユーザーが注文の一つを表示しているとき、状況の更新を表示するためにページを更新する必要はありません。代わりに、更新が作成されたときにアプリケーションにブロードキャストしたいと考えています。そのため、<code>OrderShipmentStatusUpdated</code>イベントに<code>ShouldBroadcast</code>インターフェースをマークする必要があります。これにより、Laravelにイベントが発生したときにブロードキャストするよう指示します：</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\Channel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\InteractsWithSockets</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PresenceChannel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">OrderShipmentStatusUpdated</span> <span class="k">implements</span> <span class="nx">ShouldBroadcast</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * 注文インスタンス。</span>
<span class="sd">     *</span>
<span class="sd">     * @var \App\Models\Order</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$order</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><code>ShouldBroadcast</code>インターフェースは、イベントに<code>broadcastOn</code>メソッドを定義する必要があります。このメソッドは、イベントがブロードキャストされるチャンネルを返す役割を果たします。生成されたイベントクラスには、このメソッドの空のスタブが既に定義されているため、詳細を埋めるだけです。注文の作成者だけが状況の更新を見ることができるように、注文に関連付けられた非公開チャンネルでイベントをブロードキャストします：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\Channel</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * イベントがブロードキャストされるチャンネルを取得します。</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">()</span><span class="o">:</span> <span class="nx">Channel</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="nx">PrivateChannel</span><span class="p">(</span><span class="s1">&#39;orders.&#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>イベントを複数のチャンネルでブロードキャストしたい場合は、代わりに<code>array</code>を返すことができます：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * イベントがブロードキャストされるチャンネルを取得します。</span>
<span class="sd"> *</span>
<span class="sd"> * @return array&lt;int, \Illuminate\Broadcasting\Channel&gt;</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="k">new</span> <span class="nx">PrivateChannel</span><span class="p">(</span><span class="s1">&#39;orders.&#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">),</span>
        <span class="c1">// ...</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="example-application-authorizing-channels"></a></p>
<h4 id="_12">チャンネルの認可<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>ユーザーが非公開チャンネルを購読できるようにするには、チャンネルの認可ルールを定義する必要があります。これは、<code>routes/channels.php</code>ファイルで行います。この例では、<code>orders.1</code>チャンネルを購読しようとするユーザーが実際にその注文の所有者であることを確認する必要があります：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">channel</span><span class="p">(</span><span class="s1">&#39;orders.{orderId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nv">$user</span><span class="p">,</span> <span class="nv">$orderId</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nx">Order</span><span class="o">::</span><span class="na">findOrNew</span><span class="p">(</span><span class="nv">$orderId</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="p">});</span>
</code></pre></div>
<p><code>channel</code>メソッドは2つの引数を取ります：チャンネルの名前と、ユーザーがチャンネルを購読できるかどうかを決定する<code>true</code>または<code>false</code>を返すクロージャです。</p>
<p>認可クロージャは、現在認証されているユーザーと、チャンネル名に含まれるすべてのワイルドカードパラメータを受け取ります。この例では、<code>{orderId}</code>プレースホルダーを使用して、チャンネル名の「order ID」部分がワイルドカードであることを示しています。
<a name="listening-for-event-broadcasts"></a></p>
<h4 id="_13">イベントブロードキャストのリッスン<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p>次に、残っているのはJavaScriptアプリケーションでイベントをリッスンすることです。これは <a href="#client-side-installation">Laravel Echo</a> を使って行うことができます。まず、<code>private</code> メソッドを使用してプライベートチャンネルを購読します。次に、<code>listen</code> メソッドを使用して <code>OrderShipmentStatusUpdated</code> イベントをリッスンします。デフォルトでは、イベントのすべてのパブリックプロパティがブロードキャストイベントに含まれます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="sb">`orders.</span><span class="si">${</span><span class="nx">orderId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;OrderShipmentStatusUpdated&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">order</span><span class="p">);</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="defining-broadcast-events"></a></p>
<h2 id="_14">ブロードキャストイベントの定義<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>Laravelに特定のイベントをブロードキャストするよう指示するには、イベントクラスに <code>Illuminate\Contracts\Broadcasting\ShouldBroadcast</code> インターフェースを実装する必要があります。このインターフェースは、フレームワークによって生成されるすべてのイベントクラスにインポートされているため、簡単に任意のイベントに追加できます。</p>
<p><code>ShouldBroadcast</code> インターフェースでは、<code>broadcastOn</code> メソッドを実装する必要があります。<code>broadcastOn</code> メソッドは、イベントをブロードキャストするチャンネルまたはチャンネルの配列を返す必要があります。チャンネルは <code>Channel</code>、<code>PrivateChannel</code>、または <code>PresenceChannel</code> のインスタンスである必要があります。<code>Channel</code> のインスタンスは誰でも購読できるパブリックチャンネルを表し、<code>PrivateChannels</code> と <code>PresenceChannels</code> は <a href="#authorizing-channels">チャンネルの承認</a> が必要なプライベートチャンネルを表します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\Channel</span><span class="p">;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\InteractsWithSockets</span><span class="p">;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PresenceChannel</span><span class="p">;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</span><span class="p">;</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="k">class</span> <span class="nc">ServerCreated</span> <span class="k">implements</span> <span class="nx">ShouldBroadcast</span>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="p">{</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a>    <span class="k">use</span> <span class="nx">SerializesModels</span><span class="p">;</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>    <span class="sd">/**</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a><span class="sd">     * Create a new event instance.</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a><span class="sd">     */</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">(</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a>        <span class="k">public</span> <span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span>
<a id="__codelineno-22-22" name="__codelineno-22-22" href="#__codelineno-22-22"></a>    <span class="p">)</span> <span class="p">{}</span>
<a id="__codelineno-22-23" name="__codelineno-22-23" href="#__codelineno-22-23"></a>
<a id="__codelineno-22-24" name="__codelineno-22-24" href="#__codelineno-22-24"></a>    <span class="sd">/**</span>
<a id="__codelineno-22-25" name="__codelineno-22-25" href="#__codelineno-22-25"></a><span class="sd">     * Get the channels the event should broadcast on.</span>
<a id="__codelineno-22-26" name="__codelineno-22-26" href="#__codelineno-22-26"></a><span class="sd">     *</span>
<a id="__codelineno-22-27" name="__codelineno-22-27" href="#__codelineno-22-27"></a><span class="sd">     * @return array&lt;int, \Illuminate\Broadcasting\Channel&gt;</span>
<a id="__codelineno-22-28" name="__codelineno-22-28" href="#__codelineno-22-28"></a><span class="sd">     */</span>
<a id="__codelineno-22-29" name="__codelineno-22-29" href="#__codelineno-22-29"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
<a id="__codelineno-22-30" name="__codelineno-22-30" href="#__codelineno-22-30"></a>    <span class="p">{</span>
<a id="__codelineno-22-31" name="__codelineno-22-31" href="#__codelineno-22-31"></a>        <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-22-32" name="__codelineno-22-32" href="#__codelineno-22-32"></a>            <span class="k">new</span> <span class="nx">PrivateChannel</span><span class="p">(</span><span class="s1">&#39;user.&#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">),</span>
<a id="__codelineno-22-33" name="__codelineno-22-33" href="#__codelineno-22-33"></a>        <span class="p">];</span>
<a id="__codelineno-22-34" name="__codelineno-22-34" href="#__codelineno-22-34"></a>    <span class="p">}</span>
<a id="__codelineno-22-35" name="__codelineno-22-35" href="#__codelineno-22-35"></a><span class="p">}</span>
</code></pre></div>
<p><code>ShouldBroadcast</code> インターフェースを実装した後、通常どおり <a href="events.html">イベントを発火</a> するだけです。イベントが発火されると、<a href="queues.html">キュージョブ</a> が自動的に指定されたブロードキャストドライバを使用してイベントをブロードキャストします。</p>
<p><a name="broadcast-name"></a></p>
<h3 id="_15">ブロードキャスト名<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>デフォルトでは、Laravelはイベントのクラス名を使用してイベントをブロードキャストします。ただし、イベントに <code>broadcastAs</code> メソッドを定義することでブロードキャスト名をカスタマイズできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="sd">/**</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="sd"> * The event&#39;s broadcast name.</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="sd"> */</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastAs</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="p">{</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="k">return</span> <span class="s1">&#39;server.created&#39;</span><span class="p">;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="p">}</span>
</code></pre></div>
<p><code>broadcastAs</code> メソッドを使用してブロードキャスト名をカスタマイズする場合、リスナーを先頭に <code>.</code> 文字を付けて登録する必要があります。これにより、Echoにアプリケーションの名前空間をイベントに追加しないように指示します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;.server.created&#39;</span><span class="p">,</span><span class="w"> </span><span class="kd">function</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a><span class="w">    </span><span class="p">....</span>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="p">});</span>
</code></pre></div>
<p><a name="broadcast-data"></a></p>
<h3 id="_16">ブロードキャストデータ<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p>イベントがブロードキャストされると、そのすべての <code>public</code> プロパティは自動的にシリアライズされ、イベントのペイロードとしてブロードキャストされます。これにより、JavaScriptアプリケーションからそのパブリックデータにアクセスできます。したがって、例えばイベントにEloquentモデルを含む単一の <code>$user</code> パブリックプロパティがある場合、イベントのブロードキャストペイロードは次のようになります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="p">{</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span><span class="nt">&quot;user&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w">        </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Patrick Stewart&quot;</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w">        </span><span class="err">...</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="p">}</span>
</code></pre></div>
<p>ただし、ブロードキャストペイロードをより細かく制御したい場合は、イベントに <code>broadcastWith</code> メソッドを追加できます。このメソッドは、イベントのペイロードとしてブロードキャストしたいデータの配列を返す必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="sd">/**</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="sd"> * Get the data to broadcast.</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="sd"> *</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="sd"> * @return array&lt;string, mixed&gt;</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="sd"> */</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastWith</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="p">{</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a>    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">];</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="p">}</span>
</code></pre></div>
<p><a name="broadcast-queue"></a></p>
<h3 id="_17">ブロードキャストキュー<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>デフォルトでは、各ブロードキャストイベントは <code>queue.php</code> 設定ファイルで指定されたデフォルトのキュー接続のデフォルトキューに配置されます。ブロードキャストに使用されるキュー接続と名前をカスタマイズするには、イベントクラスに <code>connection</code> および <code>queue</code> プロパティを定義します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="sd">/**</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="sd"> * The name of the queue connection to use when broadcasting the event.</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="sd"> *</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="sd"> * @var string</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="sd"> */</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="k">public</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="s1">&#39;redis&#39;</span><span class="p">;</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="sd">/**</span>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="sd"> * The name of the queue on which to place the broadcasting job.</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="sd"> *</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="sd"> * @var string</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="sd"> */</span>
<a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="k">public</span> <span class="nv">$queue</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">;</span>
</code></pre></div>
<p>または、イベントに <code>broadcastQueue</code> メソッドを定義することでキュー名をカスタマイズできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="sd">/**</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="sd"> * The name of the queue on which to place the broadcasting job.</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="sd"> */</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastQueue</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="p">{</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="k">return</span> <span class="s1">&#39;default&#39;</span><span class="p">;</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="p">}</span>
</code></pre></div>
<p>デフォルトのキュードライバの代わりに <code>sync</code> キューを使用してイベントをブロードキャストしたい場合は、<code>ShouldBroadcast</code> の代わりに <code>ShouldBroadcastNow</code> インターフェースを実装できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcastNow</span><span class="p">;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a><span class="k">class</span> <span class="nc">OrderShipmentStatusUpdated</span> <span class="k">implements</span> <span class="nx">ShouldBroadcastNow</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a><span class="p">{</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    <span class="c1">// ...</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="p">}</span>
</code></pre></div>
<p><a name="broadcast-conditions"></a></p>
<h3 id="_18">ブロードキャスト条件<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>特定の条件が真の場合にのみイベントをブロードキャストしたい場合があります。これらの条件は、イベントクラスに <code>broadcastWhen</code> メソッドを追加することで定義できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="sd">/**</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="sd"> * Determine if this event should broadcast.</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="sd"> */</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastWhen</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="p">{</span>
<a id="__codelineno-30-6" name="__codelineno-30-6" href="#__codelineno-30-6"></a>    <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">order</span><span class="o">-&gt;</span><span class="na">value</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">;</span>
<a id="__codelineno-30-7" name="__codelineno-30-7" href="#__codelineno-30-7"></a><span class="p">}</span>
</code></pre></div>
<p><a name="broadcasting-and-database-transactions"></a></p>
<h4 id="_19">ブロードキャストとデータベーストランザクション<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>ブロードキャストイベントがデータベーストランザクション内でディスパッチされると、データベーストランザクションがコミットされる前にキューによって処理される可能性があります。この場合、データベーストランザクション中にモデルやデータベースレコードに加えた更新がまだデータベースに反映されていない可能性があります。また、トランザクション内で作成されたモデルやデータベースレコードがまだデータベースに存在しない可能性があります。イベントがこれらのモデルに依存している場合、イベントをブロードキャストするジョブが処理されるときに予期しないエラーが発生する可能性があります。</p>
<p>キュー接続の <code>after_commit</code> 設定オプションが <code>false</code> に設定されている場合でも、イベントクラスに <code>ShouldDispatchAfterCommit</code> インターフェースを実装することで、すべての開いているデータベーストランザクションがコミットされた後に特定のブロードキャストイベントをディスパッチすることを示すことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a><span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</span><span class="p">;</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="k">use</span> <span class="nx">Illuminate\Contracts\Events\ShouldDispatchAfterCommit</span><span class="p">;</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="k">class</span> <span class="nc">ServerCreated</span> <span class="k">implements</span> <span class="nx">ShouldBroadcast</span><span class="p">,</span> <span class="nx">ShouldDispatchAfterCommit</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a><span class="p">{</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>    <span class="k">use</span> <span class="nx">SerializesModels</span><span class="p">;</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>これらの問題を回避する方法について詳しくは、<a href="queues.html#jobs-and-database-transactions">キュージョブとデータベーストランザクション</a> に関するドキュメントを参照してください。</p>
</div>
<p><a name="authorizing-channels"></a></p>
<h2 id="_20">チャンネルの承認<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h2>
<p>プライベートチャンネルは、現在認証されているユーザーが実際にそのチャンネルをリッスンできるかどうかを承認する必要があります。これは、チャンネル名を含むHTTPリクエストをLaravelアプリケーションに送信し、アプリケーションがユーザーがそのチャンネルをリッスンできるかどうかを判断することで実現されます。<a href="#client-side-installation">Laravel Echo</a> を使用する場合、プライベートチャンネルへの購読を承認するためのHTTPリクエストは自動的に行われます。</p>
<p>ブロードキャストが有効になっている場合、Laravelは <code>/broadcasting/auth</code> ルートを自動的に登録して承認リクエストを処理します。<code>/broadcasting/auth</code> ルートは自動的に <code>web</code> ミドルウェアグループ内に配置されます。</p>
<p><a name="defining-authorization-callbacks"></a></p>
<h3 id="_21">承認コールバックの定義<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h3>
<p>次に、現在認証されているユーザーが特定のチャンネルをリッスンできるかどうかを実際に判断するロジックを定義する必要があります。これは、<code>install:broadcasting</code> Artisanコマンドによって作成された <code>routes/channels.php</code> ファイルで行います。このファイルで、<code>Broadcast::channel</code> メソッドを使用してチャンネル承認コールバックを登録できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">channel</span><span class="p">(</span><span class="s1">&#39;orders.{orderId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$orderId</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>    <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nx">Order</span><span class="o">::</span><span class="na">findOrNew</span><span class="p">(</span><span class="nv">$orderId</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="p">});</span>
</code></pre></div>
<p><code>channel</code> メソッドは、チャンネルの名前と、ユーザーがチャンネルをリッスンする権限があるかどうかを示す <code>true</code> または <code>false</code> を返すコールバックの2つの引数を受け取ります。</p>
<p>すべての認証コールバックは、現在認証されているユーザーを最初の引数として受け取り、それに続いて追加のワイルドカードパラメータを受け取ります。この例では、チャンネル名の「ID」部分がワイルドカードであることを示すために、<code>{orderId}</code>プレースホルダを使用しています。</p>
<p>アプリケーションのブロードキャスト認証コールバックのリストは、<code>channel:list</code> Artisanコマンドを使用して表示できます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>channel:list
</code></pre></div>
<p><a name="authorization-callback-model-binding"></a></p>
<h4 id="_22">認証コールバックモデルバインディング<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<p>HTTPルートと同様に、チャンネルルートも暗黙的および明示的な<a href="routing.html#route-model-binding">ルートモデルバインディング</a>を利用できます。例えば、文字列または数値の注文IDを受け取る代わりに、実際の<code>Order</code>モデルインスタンスを要求できます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">channel</span><span class="p">(</span><span class="s1">&#39;orders.{order}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Order</span> <span class="nv">$order</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a>    <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a><span class="p">});</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>HTTPルートモデルバインディングとは異なり、チャンネルモデルバインディングは自動的な<a href="routing.html#implicit-model-binding-scoping">暗黙的モデルバインディングスコープ</a>をサポートしていません。ただし、これはほとんどのチャンネルが単一モデルのユニークなプライマリキーに基づいてスコープされるため、問題になることはほとんどありません。</p>
</div>
<p><a name="authorization-callback-authentication"></a></p>
<h4 id="_23">認証コールバック認証<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h4>
<p>プライベートおよびプレゼンスブロードキャストチャンネルは、アプリケーションのデフォルトの認証ガードを介して現在のユーザーを認証します。ユーザーが認証されていない場合、チャンネル認証は自動的に拒否され、認証コールバックは実行されません。ただし、必要に応じて、受信リクエストを認証するために複数のカスタムガードを割り当てることができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">channel</span><span class="p">(</span><span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>    <span class="c1">// ...</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="p">},</span> <span class="p">[</span><span class="s1">&#39;guards&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;web&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">]]);</span>
</code></pre></div>
<p><a name="defining-channel-classes"></a></p>
<h3 id="_24">チャンネルクラスの定義<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>アプリケーションが多くの異なるチャンネルを消費している場合、<code>routes/channels.php</code>ファイルは肥大化する可能性があります。そのため、チャンネルを認証するためにクロージャを使用する代わりに、チャンネルクラスを使用できます。チャンネルクラスを生成するには、<code>make:channel</code> Artisanコマンドを使用します。このコマンドは新しいチャンネルクラスを<code>App/Broadcasting</code>ディレクトリに配置します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:channel<span class="w"> </span>OrderChannel
</code></pre></div>
<p>次に、チャンネルを<code>routes/channels.php</code>ファイルに登録します：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">use</span> <span class="nx">App\Broadcasting\OrderChannel</span><span class="p">;</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">channel</span><span class="p">(</span><span class="s1">&#39;orders.{order}&#39;</span><span class="p">,</span> <span class="nx">OrderChannel</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
</code></pre></div>
<p>最後に、チャンネルクラスの<code>join</code>メソッドにチャンネルの認証ロジックを配置できます。この<code>join</code>メソッドには、通常チャンネル認証クロージャに配置するロジックを配置します。チャンネルモデルバインディングを利用することもできます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="k">namespace</span> <span class="nx">App\Broadcasting</span><span class="p">;</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="k">use</span> <span class="nx">App\Models\Order</span><span class="p">;</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="k">class</span> <span class="nc">OrderChannel</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="p">{</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>    <span class="sd">/**</span>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a><span class="sd">     * Create a new channel instance.</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a><span class="sd">     */</span>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span> <span class="p">{}</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a>
<a id="__codelineno-38-15" name="__codelineno-38-15" href="#__codelineno-38-15"></a>    <span class="sd">/**</span>
<a id="__codelineno-38-16" name="__codelineno-38-16" href="#__codelineno-38-16"></a><span class="sd">     * Authenticate the user&#39;s access to the channel.</span>
<a id="__codelineno-38-17" name="__codelineno-38-17" href="#__codelineno-38-17"></a><span class="sd">     */</span>
<a id="__codelineno-38-18" name="__codelineno-38-18" href="#__codelineno-38-18"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">join</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">Order</span> <span class="nv">$order</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span><span class="o">|</span><span class="nx">bool</span>
<a id="__codelineno-38-19" name="__codelineno-38-19" href="#__codelineno-38-19"></a>    <span class="p">{</span>
<a id="__codelineno-38-20" name="__codelineno-38-20" href="#__codelineno-38-20"></a>        <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">===</span> <span class="nv">$order</span><span class="o">-&gt;</span><span class="na">user_id</span><span class="p">;</span>
<a id="__codelineno-38-21" name="__codelineno-38-21" href="#__codelineno-38-21"></a>    <span class="p">}</span>
<a id="__codelineno-38-22" name="__codelineno-38-22" href="#__codelineno-38-22"></a><span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Laravelの他の多くのクラスと同様に、チャンネルクラスは<a href="container.html">サービスコンテナ</a>によって自動的に解決されます。したがって、チャンネルのコンストラクタで必要な依存関係をタイプヒントで指定できます。</p>
</div>
<p><a name="broadcasting-events"></a></p>
<h2 id="_25">イベントのブロードキャスト<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h2>
<p>イベントを定義し、<code>ShouldBroadcast</code>インターフェースでマークしたら、イベントのディスパッチメソッドを使用してイベントを発火するだけです。イベントディスパッチャは、イベントが<code>ShouldBroadcast</code>インターフェースでマークされていることを認識し、イベントをブロードキャストのためにキューに入れます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">use</span> <span class="nx">App\Events\OrderShipmentStatusUpdated</span><span class="p">;</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="nx">OrderShipmentStatusUpdated</span><span class="o">::</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$order</span><span class="p">);</span>
</code></pre></div>
<p><a name="only-to-others"></a></p>
<h3 id="_26">他のユーザーのみにブロードキャスト<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p>イベントブロードキャストを利用するアプリケーションを構築する際、特定のチャンネルのすべてのサブスクライバーにイベントをブロードキャストする必要がある場合がありますが、現在のユーザーを除く必要があります。<code>broadcast</code>ヘルパーと<code>toOthers</code>メソッドを使用してこれを実現できます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">use</span> <span class="nx">App\Events\OrderShipmentStatusUpdated</span><span class="p">;</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a><span class="nx">broadcast</span><span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipmentStatusUpdated</span><span class="p">(</span><span class="nv">$update</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">toOthers</span><span class="p">();</span>
</code></pre></div>
<p><code>toOthers</code>メソッドをいつ使用するかをよりよく理解するために、タスク名を入力して新しいタスクを作成できるタスクリストアプリケーションを想像してみましょう。タスクを作成するために、アプリケーションはタスクの作成をブロードキャストし、新しいタスクのJSON表現を返す<code>/task</code> URLにリクエストを送信するかもしれません。JavaScriptアプリケーションがエンドポイントからのレスポンスを受け取ると、次のように新しいタスクをタスクリストに直接挿入するかもしれません：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/task&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">task</span><span class="p">)</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="nx">tasks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p>ただし、タスクの作成もブロードキャストしていることを忘れないでください。JavaScriptアプリケーションがこのイベントをリッスンしてタスクリストにタスクを追加している場合、リストに重複したタスクが表示されます：エンドポイントからのものとブロードキャストからのものです。これを解決するために、<code>toOthers</code>メソッドを使用してブロードキャスタに現在のユーザーにイベントをブロードキャストしないように指示できます。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>toOthers</code>メソッドを呼び出すには、イベントが<code>Illuminate\Broadcasting\InteractsWithSockets</code>トレイトを使用している必要があります。</p>
</div>
<p><a name="only-to-others-configuration"></a></p>
<h4 id="_27">設定<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h4>
<p>Laravel Echoインスタンスを初期化すると、ソケットIDが接続に割り当てられます。グローバルな<a href="https://github.com/mzabriskie/axios">Axios</a>インスタンスを使用してJavaScriptアプリケーションからHTTPリクエストを行う場合、ソケットIDは自動的にすべての送信リクエストに<code>X-Socket-ID</code>ヘッダとして添付されます。その後、<code>toOthers</code>メソッドを呼び出すと、LaravelはヘッダからソケットIDを抽出し、ブロードキャスタにそのソケットIDを持つ接続にイベントをブロードキャストしないように指示します。</p>
<p>グローバルなAxiosインスタンスを使用していない場合は、JavaScriptアプリケーションを手動で設定して、すべての送信リクエストに<code>X-Socket-ID</code>ヘッダを送信する必要があります。ソケットIDは<code>Echo.socketId</code>メソッドを使用して取得できます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="kd">var</span><span class="w"> </span><span class="nx">socketId</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">Echo</span><span class="p">.</span><span class="nx">socketId</span><span class="p">();</span>
</code></pre></div>
<p><a name="customizing-the-connection"></a></p>
<h3 id="_28">接続のカスタマイズ<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<p>アプリケーションが複数のブロードキャスト接続と対話し、デフォルト以外のブロードキャスタを使用してイベントをブロードキャストする場合、<code>via</code>メソッドを使用してイベントをプッシュする接続を指定できます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="k">use</span> <span class="nx">App\Events\OrderShipmentStatusUpdated</span><span class="p">;</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="nx">broadcast</span><span class="p">(</span><span class="k">new</span> <span class="nx">OrderShipmentStatusUpdated</span><span class="p">(</span><span class="nv">$update</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">via</span><span class="p">(</span><span class="s1">&#39;pusher&#39;</span><span class="p">);</span>
</code></pre></div>
<p>または、イベントのコンストラクタ内で<code>broadcastVia</code>メソッドを呼び出してイベントのブロードキャスト接続を指定することもできます。ただし、その前に、イベントクラスが<code>InteractsWithBroadcasting</code>トレイトを使用していることを確認してください：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="k">namespace</span> <span class="nx">App\Events</span><span class="p">;</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\Channel</span><span class="p">;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\InteractsWithBroadcasting</span><span class="p">;</span>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\InteractsWithSockets</span><span class="p">;</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PresenceChannel</span><span class="p">;</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="k">use</span> <span class="nx">Illuminate\Contracts\Broadcasting\ShouldBroadcast</span><span class="p">;</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a><span class="k">use</span> <span class="nx">Illuminate\Queue\SerializesModels</span><span class="p">;</span>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a>
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="k">class</span> <span class="nc">OrderShipmentStatusUpdated</span> <span class="k">implements</span> <span class="nx">ShouldBroadcast</span>
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="p">{</span>
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a>    <span class="k">use</span> <span class="nx">InteractsWithBroadcasting</span><span class="p">;</span>
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a>
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>    <span class="sd">/**</span>
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="sd">     * Create a new event instance.</span>
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="sd">     */</span>
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a>    <span class="k">public</span> <span class="k">function</span> <span class="fm">__construct</span><span class="p">()</span>
<a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a>    <span class="p">{</span>
<a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a>        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">broadcastVia</span><span class="p">(</span><span class="s1">&#39;pusher&#39;</span><span class="p">);</span>
<a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a>    <span class="p">}</span>
<a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="p">}</span>
</code></pre></div>
<p><a name="anonymous-events"></a></p>
<h3 id="_29">匿名イベント<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<p>場合によっては、専用のイベントクラスを作成せずに、アプリケーションのフロントエンドに単純なイベントをブロードキャストしたいことがあります。これに対応するために、<code>Broadcast</code>ファサードを使用して「匿名イベント」をブロードキャストできます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">on</span><span class="p">(</span><span class="s1">&#39;orders.&#39;</span><span class="o">.</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</code></pre></div>
<p>上記の例は、次のイベントをブロードキャストします：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="p">{</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;AnonymousEvent&quot;</span><span class="p">,</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;[]&quot;</span><span class="p">,</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="w">    </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;orders.1&quot;</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="p">}</span>
</code></pre></div>
<p><code>as</code>および<code>with</code>メソッドを使用して、イベントの名前とデータをカスタマイズできます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">on</span><span class="p">(</span><span class="s1">&#39;orders.&#39;</span><span class="o">.</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a>    <span class="o">-&gt;</span><span class="na">as</span><span class="p">(</span><span class="s1">&#39;OrderPlaced&#39;</span><span class="p">)</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a>    <span class="o">-&gt;</span><span class="na">with</span><span class="p">(</span><span class="nv">$order</span><span class="p">)</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a>    <span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</code></pre></div>
<p>上記の例は、次のようなイベントをブロードキャストします：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="p">{</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="nt">&quot;event&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;OrderPlaced&quot;</span><span class="p">,</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">    </span><span class="nt">&quot;data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;{ id: 1, total: 100 }&quot;</span><span class="p">,</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="nt">&quot;channel&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;orders.1&quot;</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="p">}</span>
</code></pre></div>
<p>匿名イベントをプライベートまたはプレゼンスチャンネルでブロードキャストする場合は、<code>private</code>および<code>presence</code>メソッドを使用できます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">private</span><span class="p">(</span><span class="s1">&#39;orders.&#39;</span><span class="o">.</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">presence</span><span class="p">(</span><span class="s1">&#39;channels.&#39;</span><span class="o">.</span><span class="nv">$channel</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</code></pre></div>
<p><code>send</code>メソッドを使用して匿名イベントをブロードキャストすると、イベントはアプリケーションの<a href="queues.html">キュー</a>にディスパッチされて処理されます。ただし、イベントを即座にブロードキャストしたい場合は、<code>sendNow</code>メソッドを使用できます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">on</span><span class="p">(</span><span class="s1">&#39;orders.&#39;</span><span class="o">.</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">sendNow</span><span class="p">();</span>
</code></pre></div>
<p>現在認証されているユーザーを除くすべてのチャンネルサブスクライバーにイベントをブロードキャストするには、<code>toOthers</code>メソッドを呼び出すことができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">on</span><span class="p">(</span><span class="s1">&#39;orders.&#39;</span><span class="o">.</span><span class="nv">$order</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a>    <span class="o">-&gt;</span><span class="na">toOthers</span><span class="p">()</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a>    <span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</code></pre></div>
<p><a name="receiving-broadcasts"></a></p>
<h2 id="_30">ブロードキャストの受信<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h2>
<p><a name="listening-for-events"></a></p>
<h3 id="_31">イベントのリッスン<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h3>
<p><a href="#client-side-installation">Laravel Echoのインストールと初期化</a>が完了したら、Laravelアプリケーションからブロードキャストされるイベントのリッスンを開始する準備が整いました。まず、<code>channel</code>メソッドを使用してチャンネルのインスタンスを取得し、次に<code>listen</code>メソッドを呼び出して指定されたイベントをリッスンします：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="sb">`orders.</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;OrderShipmentStatusUpdated&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p>プライベートチャンネルでイベントをリッスンしたい場合は、代わりに<code>private</code>メソッドを使用してください。単一のチャンネルで複数のイベントをリッスンするために、<code>listen</code>メソッドの呼び出しを連鎖させ続けることができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="sb">`orders.</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">)</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">    </span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">)</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">    </span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">);</span>
</code></pre></div>
<p><a name="stop-listening-for-events"></a></p>
<h4 id="_32">イベントリッスンの停止<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h4>
<p><a href="#leaving-a-channel">チャンネルを離れる</a>ことなく、特定のイベントのリッスンを停止したい場合は、<code>stopListening</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="sb">`orders.</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">stopListening</span><span class="p">(</span><span class="s1">&#39;OrderShipmentStatusUpdated&#39;</span><span class="p">)</span>
</code></pre></div>
<p><a name="leaving-a-channel"></a></p>
<h3 id="_33">チャンネルの離脱<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h3>
<p>チャンネルを離れるには、Echoインスタンスの<code>leaveChannel</code>メソッドを呼び出すことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="nx">leaveChannel</span><span class="p">(</span><span class="sb">`orders.</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>
<p>チャンネルとそれに関連するプライベートおよびプレゼンスチャンネルも離れたい場合は、<code>leave</code>メソッドを呼び出すことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="nx">leave</span><span class="p">(</span><span class="sb">`orders.</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">order</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</code></pre></div>
<p><a name="namespaces"></a></p>
<h3 id="_34">名前空間<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<p>上記の例では、イベントクラスの完全な<code>App\Events</code>名前空間を指定していないことに気づいたかもしれません。これは、Echoがイベントが<code>App\Events</code>名前空間にあると自動的に想定するためです。ただし、Echoをインスタンス化する際に<code>namespace</code>設定オプションを渡すことで、ルート名前空間を設定できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="nb">window</span><span class="p">.</span><span class="nx">Echo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Echo</span><span class="p">({</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">    </span><span class="nx">broadcaster</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;pusher&#39;</span><span class="p">,</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-57-4" name="__codelineno-57-4" href="#__codelineno-57-4"></a><span class="w">    </span><span class="nx">namespace</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;App.Other.Namespace&#39;</span>
<a id="__codelineno-57-5" name="__codelineno-57-5" href="#__codelineno-57-5"></a><span class="p">});</span>
</code></pre></div>
<p>あるいは、Echoを使用してイベントを購読する際に、イベントクラスに<code>.</code>をプレフィックスとして付けることができます。これにより、常に完全修飾クラス名を指定できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="nx">channel</span><span class="p">(</span><span class="s1">&#39;orders&#39;</span><span class="p">)</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;.Namespace\\Event\\Class&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="presence-channels"></a></p>
<h2 id="_35">プレゼンスチャンネル<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h2>
<p>プレゼンスチャンネルは、プライベートチャンネルのセキュリティを基にしながら、チャンネルを購読しているユーザーを認識するという追加機能を提供します。これにより、他のユーザーが同じページを閲覧しているときにユーザーに通知したり、チャットルームの居住者をリストアップしたりするなど、強力で協力的なアプリケーション機能を簡単に構築できます。</p>
<p><a name="authorizing-presence-channels"></a></p>
<h3 id="_36">プレゼンスチャンネルの認可<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h3>
<p>すべてのプレゼンスチャンネルはプライベートチャンネルでもあるため、ユーザーは<a href="#authorizing-channels">それらにアクセスするために認可される必要があります</a>。ただし、プレゼンスチャンネルの認可コールバックを定義する際に、ユーザーがチャンネルに参加することが認可されている場合に<code>true</code>を返すのではなく、ユーザーに関するデータの配列を返す必要があります。</p>
<p>認可コールバックによって返されたデータは、JavaScriptアプリケーションのプレゼンスチャンネルイベントリスナーで利用可能になります。ユーザーがプレゼンスチャンネルに参加することが認可されていない場合は、<code>false</code>または<code>null</code>を返す必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="nx">Broadcast</span><span class="o">::</span><span class="na">channel</span><span class="p">(</span><span class="s1">&#39;chat.{roomId}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$roomId</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a>    <span class="k">if</span> <span class="p">(</span><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">canJoinRoom</span><span class="p">(</span><span class="nv">$roomId</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">];</span>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a>    <span class="p">}</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="p">});</span>
</code></pre></div>
<p><a name="joining-presence-channels"></a></p>
<h3 id="_37">プレゼンスチャンネルへの参加<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h3>
<p>プレゼンスチャンネルに参加するには、Echoの<code>join</code>メソッドを使用できます。<code>join</code>メソッドは<code>PresenceChannel</code>実装を返します。これにより、<code>listen</code>メソッドを公開するだけでなく、<code>here</code>、<code>joining</code>、<code>leaving</code>イベントを購読できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="sb">`chat.</span><span class="si">${</span><span class="nx">roomId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">here</span><span class="p">((</span><span class="nx">users</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="w">    </span><span class="p">.</span><span class="nx">joining</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">    </span><span class="p">.</span><span class="nx">leaving</span><span class="p">((</span><span class="nx">user</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="w">    </span><span class="p">.</span><span class="nx">error</span><span class="p">((</span><span class="nx">error</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><code>here</code>コールバックは、チャンネルが正常に参加されるとすぐに実行され、現在チャンネルを購読している他のすべてのユーザーのユーザー情報を含む配列を受け取ります。<code>joining</code>メソッドは新しいユーザーがチャンネルに参加したときに実行され、<code>leaving</code>メソッドはユーザーがチャンネルを離れたときに実行されます。<code>error</code>メソッドは、認証エンドポイントが200以外のHTTPステータスコードを返した場合、または返されたJSONの解析に問題がある場合に実行されます。</p>
<p><a name="broadcasting-to-presence-channels"></a></p>
<h3 id="_38">プレゼンスチャンネルへのブロードキャスト<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h3>
<p>プレゼンスチャンネルは、公開チャンネルやプライベートチャンネルと同様にイベントを受信できます。チャットルームの例を使用して、<code>NewMessage</code>イベントをルームのプレゼンスチャンネルにブロードキャストしたい場合、イベントの<code>broadcastOn</code>メソッドから<code>PresenceChannel</code>のインスタンスを返します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="sd">/**</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="sd"> * Get the channels the event should broadcast on.</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a><span class="sd"> *</span>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="sd"> * @return array&lt;int, \Illuminate\Broadcasting\Channel&gt;</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="sd"> */</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="p">{</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a>    <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-61-9" name="__codelineno-61-9" href="#__codelineno-61-9"></a>        <span class="k">new</span> <span class="nx">PresenceChannel</span><span class="p">(</span><span class="s1">&#39;chat.&#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">message</span><span class="o">-&gt;</span><span class="na">room_id</span><span class="p">),</span>
<a id="__codelineno-61-10" name="__codelineno-61-10" href="#__codelineno-61-10"></a>    <span class="p">];</span>
<a id="__codelineno-61-11" name="__codelineno-61-11" href="#__codelineno-61-11"></a><span class="p">}</span>
</code></pre></div>
<p>他のイベントと同様に、<code>broadcast</code>ヘルパーと<code>toOthers</code>メソッドを使用して、現在のユーザーがブロードキャストを受信しないようにすることができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="nx">broadcast</span><span class="p">(</span><span class="k">new</span> <span class="nx">NewMessage</span><span class="p">(</span><span class="nv">$message</span><span class="p">));</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="nx">broadcast</span><span class="p">(</span><span class="k">new</span> <span class="nx">NewMessage</span><span class="p">(</span><span class="nv">$message</span><span class="p">))</span><span class="o">-&gt;</span><span class="na">toOthers</span><span class="p">();</span>
</code></pre></div>
<p>他の種類のイベントと同様に、Echoの<code>listen</code>メソッドを使用してプレゼンスチャンネルに送信されるイベントをリッスンできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="sb">`chat.</span><span class="si">${</span><span class="nx">roomId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">here</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">)</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="w">    </span><span class="p">.</span><span class="nx">joining</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">)</span>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="p">.</span><span class="nx">leaving</span><span class="p">(</span><span class="cm">/* ... */</span><span class="p">)</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">    </span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;NewMessage&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="model-broadcasting"></a></p>
<h2 id="_39">モデルのブロードキャスト<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>モデルのブロードキャストに関する以下のドキュメントを読む前に、Laravelのモデルブロードキャストサービスの一般的な概念と、ブロードキャストイベントを手動で作成してリッスンする方法について慣れておくことをお勧めします。</p>
</div>
<p>アプリケーションの<a href="eloquent.html">Eloquentモデル</a>が作成、更新、または削除されたときにイベントをブロードキャストすることは一般的です。もちろん、これは手動で<a href="eloquent.html#events">Eloquentモデルの状態変化に対するカスタムイベントを定義</a>し、それらのイベントに<code>ShouldBroadcast</code>インターフェースを付けることで簡単に実現できます。</p>
<p>ただし、アプリケーションでこれらのイベントを他の目的で使用していない場合、ブロードキャストするためだけにイベントクラスを作成するのは面倒な場合があります。これを解決するために、LaravelではEloquentモデルがその状態変化を自動的にブロードキャストするように指示できます。</p>
<p>これを開始するには、Eloquentモデルは<code>Illuminate\Database\Eloquent\BroadcastsEvents</code>トレイトを使用する必要があります。さらに、モデルはモデルのイベントをブロードキャストするチャンネルの配列を返す<code>broadcastOn</code>メソッドを定義する必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\Channel</span><span class="p">;</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\BroadcastsEvents</span><span class="p">;</span>
<a id="__codelineno-64-8" name="__codelineno-64-8" href="#__codelineno-64-8"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<a id="__codelineno-64-9" name="__codelineno-64-9" href="#__codelineno-64-9"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-64-10" name="__codelineno-64-10" href="#__codelineno-64-10"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Relations\BelongsTo</span><span class="p">;</span>
<a id="__codelineno-64-11" name="__codelineno-64-11" href="#__codelineno-64-11"></a>
<a id="__codelineno-64-12" name="__codelineno-64-12" href="#__codelineno-64-12"></a><span class="k">class</span> <span class="nc">Post</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-64-13" name="__codelineno-64-13" href="#__codelineno-64-13"></a><span class="p">{</span>
<a id="__codelineno-64-14" name="__codelineno-64-14" href="#__codelineno-64-14"></a>    <span class="k">use</span> <span class="nx">BroadcastsEvents</span><span class="p">,</span> <span class="nx">HasFactory</span><span class="p">;</span>
<a id="__codelineno-64-15" name="__codelineno-64-15" href="#__codelineno-64-15"></a>
<a id="__codelineno-64-16" name="__codelineno-64-16" href="#__codelineno-64-16"></a>    <span class="sd">/**</span>
<a id="__codelineno-64-17" name="__codelineno-64-17" href="#__codelineno-64-17"></a><span class="sd">     * Get the user that the post belongs to.</span>
<a id="__codelineno-64-18" name="__codelineno-64-18" href="#__codelineno-64-18"></a><span class="sd">     */</span>
<a id="__codelineno-64-19" name="__codelineno-64-19" href="#__codelineno-64-19"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">user</span><span class="p">()</span><span class="o">:</span> <span class="nx">BelongsTo</span>
<a id="__codelineno-64-20" name="__codelineno-64-20" href="#__codelineno-64-20"></a>    <span class="p">{</span>
<a id="__codelineno-64-21" name="__codelineno-64-21" href="#__codelineno-64-21"></a>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="nx">User</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<a id="__codelineno-64-22" name="__codelineno-64-22" href="#__codelineno-64-22"></a>    <span class="p">}</span>
<a id="__codelineno-64-23" name="__codelineno-64-23" href="#__codelineno-64-23"></a>
<a id="__codelineno-64-24" name="__codelineno-64-24" href="#__codelineno-64-24"></a>    <span class="sd">/**</span>
<a id="__codelineno-64-25" name="__codelineno-64-25" href="#__codelineno-64-25"></a><span class="sd">     * Get the channels that model events should broadcast on.</span>
<a id="__codelineno-64-26" name="__codelineno-64-26" href="#__codelineno-64-26"></a><span class="sd">     *</span>
<a id="__codelineno-64-27" name="__codelineno-64-27" href="#__codelineno-64-27"></a><span class="sd">     * @return array&lt;int, \Illuminate\Broadcasting\Channel|\Illuminate\Database\Eloquent\Model&gt;</span>
<a id="__codelineno-64-28" name="__codelineno-64-28" href="#__codelineno-64-28"></a><span class="sd">     */</span>
<a id="__codelineno-64-29" name="__codelineno-64-29" href="#__codelineno-64-29"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
<a id="__codelineno-64-30" name="__codelineno-64-30" href="#__codelineno-64-30"></a>    <span class="p">{</span>
<a id="__codelineno-64-31" name="__codelineno-64-31" href="#__codelineno-64-31"></a>        <span class="k">return</span> <span class="p">[</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">];</span>
<a id="__codelineno-64-32" name="__codelineno-64-32" href="#__codelineno-64-32"></a>    <span class="p">}</span>
<a id="__codelineno-64-33" name="__codelineno-64-33" href="#__codelineno-64-33"></a><span class="p">}</span>
</code></pre></div>
<p>モデルがこのトレイトを含み、そのブロードキャストチャンネルを定義すると、モデルインスタンスが作成、更新、削除、ゴミ箱に入れられた、または復元されたときにイベントが自動的にブロードキャストされるようになります。</p>
<p>さらに、<code>broadcastOn</code>メソッドが文字列の<code>$event</code>引数を受け取ることに気づいたかもしれません。この引数にはモデルで発生したイベントのタイプが含まれ、<code>created</code>、<code>updated</code>、<code>deleted</code>、<code>trashed</code>、または<code>restored</code>の値を持ちます。この変数の値を検査することで、特定のイベントに対してモデルがどのチャンネル（もしあれば）にブロードキャストするかを決定できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="sd">/**</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="sd"> * Get the channels that model events should broadcast on.</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="sd"> *</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="sd"> * @return array&lt;string, array&lt;int, \Illuminate\Broadcasting\Channel|\Illuminate\Database\Eloquent\Model&gt;&gt;</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="sd"> */</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="p">{</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a>    <span class="k">return</span> <span class="k">match</span> <span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a>        <span class="s1">&#39;deleted&#39;</span> <span class="o">=&gt;</span> <span class="p">[],</span>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a>        <span class="k">default</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">],</span>
<a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a>    <span class="p">};</span>
<a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="p">}</span>
</code></pre></div>
<p><a name="customizing-model-broadcasting-event-creation"></a></p>
<h4 id="_40">モデルブロードキャストイベント作成のカスタマイズ<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h4>
<p>Laravelがモデルブロードキャストイベントを作成する方法をカスタマイズしたい場合があります。これは、Eloquentモデルに<code>newBroadcastableEvent</code>メソッドを定義することで実現できます。このメソッドは<code>Illuminate\Database\Eloquent\BroadcastableModelEventOccurred</code>インスタンスを返す必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\BroadcastableModelEventOccurred</span><span class="p">;</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="sd">/**</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a><span class="sd"> * Create a new broadcastable model event for the model.</span>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="sd"> */</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="k">protected</span> <span class="k">function</span> <span class="nf">newBroadcastableEvent</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">BroadcastableModelEventOccurred</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="p">{</span>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a>    <span class="k">return</span> <span class="p">(</span><span class="k">new</span> <span class="nx">BroadcastableModelEventOccurred</span><span class="p">(</span>
<a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a>        <span class="nv">$this</span><span class="p">,</span> <span class="nv">$event</span>
<a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a>    <span class="p">))</span><span class="o">-&gt;</span><span class="na">dontBroadcastToCurrentUser</span><span class="p">();</span>
<a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="p">}</span>
</code></pre></div>
<p><a name="model-broadcasting-conventions"></a></p>
<h3 id="_41">モデルブロードキャストの規約<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h3>
<p><a name="model-broadcasting-channel-conventions"></a></p>
<h4 id="_42">チャンネルの規約<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h4>
<p>上記のモデル例では、<code>broadcastOn</code>メソッドが<code>Channel</code>インスタンスを返していないことに気づいたかもしれません。代わりに、Eloquentモデルが直接返されています。モデルの<code>broadcastOn</code>メソッドによってEloquentモデルインスタンスが返される場合（またはメソッドによって返される配列に含まれる場合）、Laravelは自動的にモデルのクラス名と主キー識別子を使用してチャンネル名としてプライベートチャンネルインスタンスを作成します。</p>
<p>つまり、<code>App\Models\User</code>モデルで<code>id</code>が<code>1</code>の場合、<code>Illuminate\Broadcasting\PrivateChannel</code>インスタンスに変換され、名前は<code>App.Models.User.1</code>になります。もちろん、モデルの<code>broadcastOn</code>メソッドからEloquentモデルインスタンスを返すだけでなく、完全な<code>Channel</code>インスタンスを返すことで、モデルのチャンネル名を完全に制御することができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">use</span> <span class="nx">Illuminate\Broadcasting\PrivateChannel</span><span class="p">;</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="sd">/**</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a><span class="sd"> * モデルイベントがブロードキャストされるチャンネルを取得する。</span>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="sd"> *</span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="sd"> * @return array&lt;int, \Illuminate\Broadcasting\Channel&gt;</span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="sd"> */</span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastOn</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
<a id="__codelineno-67-9" name="__codelineno-67-9" href="#__codelineno-67-9"></a><span class="p">{</span>
<a id="__codelineno-67-10" name="__codelineno-67-10" href="#__codelineno-67-10"></a>    <span class="k">return</span> <span class="p">[</span>
<a id="__codelineno-67-11" name="__codelineno-67-11" href="#__codelineno-67-11"></a>        <span class="k">new</span> <span class="nx">PrivateChannel</span><span class="p">(</span><span class="s1">&#39;user.&#39;</span><span class="o">.</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">)</span>
<a id="__codelineno-67-12" name="__codelineno-67-12" href="#__codelineno-67-12"></a>    <span class="p">];</span>
<a id="__codelineno-67-13" name="__codelineno-67-13" href="#__codelineno-67-13"></a><span class="p">}</span>
</code></pre></div>
<p>モデルの<code>broadcastOn</code>メソッドからチャンネルインスタンスを明示的に返す場合、Eloquentモデルインスタンスをチャンネルのコンストラクタに渡すことができます。そうすると、Laravelは上記で説明したモデルチャンネルの規約を使用して、Eloquentモデルをチャンネル名の文字列に変換します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="k">return</span> <span class="p">[</span><span class="k">new</span> <span class="nx">Channel</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">)];</span>
</code></pre></div>
<p>モデルのチャンネル名を決定する必要がある場合、任意のモデルインスタンスで<code>broadcastChannel</code>メソッドを呼び出すことができます。例えば、このメソッドは<code>App\Models\User</code>モデルで<code>id</code>が<code>1</code>の場合、文字列<code>App.Models.User.1</code>を返します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">broadcastChannel</span><span class="p">()</span>
</code></pre></div>
<p><a name="model-broadcasting-event-conventions"></a></p>
<h4 id="_43">イベントの規約<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h4>
<p>モデルブロードキャストイベントは、アプリケーションの<code>App\Events</code>ディレクトリ内の「実際の」イベントに関連付けられていないため、規約に基づいて名前とペイロードが割り当てられます。Laravelの規約では、モデルのクラス名（名前空間を除く）とブロードキャストをトリガーしたモデルイベントの名前を使用してイベントをブロードキャストします。</p>
<p>したがって、例えば、<code>App\Models\Post</code>モデルの更新は、クライアントサイドアプリケーションに<code>PostUpdated</code>というイベントを以下のペイロードでブロードキャストします。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="p">{</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">    </span><span class="nt">&quot;model&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">        </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a><span class="w">        </span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;My first post&quot;</span>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="w">        </span><span class="err">...</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">    </span><span class="p">},</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">    </span><span class="err">...</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="w">    </span><span class="nt">&quot;socket&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;someSocketId&quot;</span><span class="p">,</span>
<a id="__codelineno-70-9" name="__codelineno-70-9" href="#__codelineno-70-9"></a><span class="p">}</span>
</code></pre></div>
<p><code>App\Models\User</code>モデルの削除は、<code>UserDeleted</code>という名前のイベントをブロードキャストします。</p>
<p>必要に応じて、モデルに<code>broadcastAs</code>と<code>broadcastWith</code>メソッドを追加することで、カスタムのブロードキャスト名とペイロードを定義できます。これらのメソッドは、発生しているモデルイベント/操作の名前を受け取り、各モデル操作に対してイベントの名前とペイロードをカスタマイズできます。<code>broadcastAs</code>メソッドから<code>null</code>が返されると、Laravelは上記で説明したモデルブロードキャストイベントの名前の規約を使用してイベントをブロードキャストします。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="sd">/**</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="sd"> * モデルイベントのブロードキャスト名。</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a><span class="sd"> */</span>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastAs</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="nx">string</span><span class="o">|</span><span class="k">null</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="p">{</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a>    <span class="k">return</span> <span class="k">match</span> <span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>        <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;post.created&#39;</span><span class="p">,</span>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a>        <span class="k">default</span> <span class="o">=&gt;</span> <span class="k">null</span><span class="p">,</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a>    <span class="p">};</span>
<a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="p">}</span>
<a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>
<a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="sd">/**</span>
<a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="sd"> * モデルのブロードキャストデータを取得する。</span>
<a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a><span class="sd"> *</span>
<a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a><span class="sd"> * @return array&lt;string, mixed&gt;</span>
<a id="__codelineno-71-16" name="__codelineno-71-16" href="#__codelineno-71-16"></a><span class="sd"> */</span>
<a id="__codelineno-71-17" name="__codelineno-71-17" href="#__codelineno-71-17"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">broadcastWith</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$event</span><span class="p">)</span><span class="o">:</span> <span class="k">array</span>
<a id="__codelineno-71-18" name="__codelineno-71-18" href="#__codelineno-71-18"></a><span class="p">{</span>
<a id="__codelineno-71-19" name="__codelineno-71-19" href="#__codelineno-71-19"></a>    <span class="k">return</span> <span class="k">match</span> <span class="p">(</span><span class="nv">$event</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-71-20" name="__codelineno-71-20" href="#__codelineno-71-20"></a>        <span class="s1">&#39;created&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">title</span><span class="p">],</span>
<a id="__codelineno-71-21" name="__codelineno-71-21" href="#__codelineno-71-21"></a>        <span class="k">default</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s1">&#39;model&#39;</span> <span class="o">=&gt;</span> <span class="nv">$this</span><span class="p">],</span>
<a id="__codelineno-71-22" name="__codelineno-71-22" href="#__codelineno-71-22"></a>    <span class="p">};</span>
<a id="__codelineno-71-23" name="__codelineno-71-23" href="#__codelineno-71-23"></a><span class="p">}</span>
</code></pre></div>
<p><a name="listening-for-model-broadcasts"></a></p>
<h3 id="_44">モデルブロードキャストのリスニング<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h3>
<p><code>BroadcastsEvents</code>トレイトをモデルに追加し、モデルの<code>broadcastOn</code>メソッドを定義したら、クライアントサイドアプリケーション内でブロードキャストされたモデルイベントのリスニングを開始する準備が整いました。開始する前に、<a href="#listening-for-events">イベントのリスニング</a>に関する完全なドキュメントを確認することをお勧めします。</p>
<p>まず、<code>private</code>メソッドを使用してチャンネルのインスタンスを取得し、<code>listen</code>メソッドを呼び出して特定のイベントをリスニングします。通常、<code>private</code>メソッドに与えられるチャンネル名は、Laravelの<a href="#model-broadcasting-conventions">モデルブロードキャスト規約</a>に対応する必要があります。</p>
<p>チャンネルインスタンスを取得したら、<code>listen</code>メソッドを使用して特定のイベントをリッスンできます。モデルブロードキャストイベントは、アプリケーションの<code>App\Events</code>ディレクトリ内の「実際の」イベントに関連付けられていないため、<a href="#model-broadcasting-event-conventions">イベント名</a>の前に<code>.</code>を付けて、特定の名前空間に属していないことを示す必要があります。各モデルブロードキャストイベントには、モデルのすべてのブロードキャスト可能なプロパティを含む<code>model</code>プロパティがあります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="sb">`App.Models.User.</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;.PostUpdated&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">model</span><span class="p">);</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="client-events"></a></p>
<h2 id="_45">クライアントイベント<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><a href="https://pusher.com/channels">Pusher Channels</a>を使用する場合、クライアントイベントを送信するには、<a href="https://dashboard.pusher.com/">アプリケーションダッシュボード</a>の「App Settings」セクションで「Client Events」オプションを有効にする必要があります。</p>
</div>
<p>場合によっては、Laravelアプリケーションにアクセスせずに、他の接続されたクライアントにイベントをブロードキャストしたいことがあります。これは、例えば「入力中」通知のようなもので、特定の画面で他のユーザーがメッセージを入力していることをアプリケーションのユーザーに警告したい場合に特に便利です。</p>
<p>クライアントイベントをブロードキャストするには、Echoの<code>whisper</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="sb">`chat.</span><span class="si">${</span><span class="nx">roomId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">whisper</span><span class="p">(</span><span class="s1">&#39;typing&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">        </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p>クライアントイベントをリッスンするには、<code>listenForWhisper</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="sb">`chat.</span><span class="si">${</span><span class="nx">roomId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">listenForWhisper</span><span class="p">(</span><span class="s1">&#39;typing&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="notifications"></a></p>
<h2 id="_46">通知<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h2>
<p>イベントブロードキャストと<a href="notifications.html">通知</a>を組み合わせることで、JavaScriptアプリケーションは、ページを更新することなく新しい通知を受け取ることができます。開始する前に、<a href="notifications.html#broadcast-notifications">ブロードキャスト通知チャンネル</a>の使用に関するドキュメントを確認してください。</p>
<p>ブロードキャストチャンネルを使用するように通知を設定したら、Echoの<code>notification</code>メソッドを使用してブロードキャストイベントをリッスンできます。通知を受け取るエンティティのクラス名と一致するチャンネル名を使用することを忘れないでください。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="nx">Echo</span><span class="p">.</span><span class="kr">private</span><span class="p">(</span><span class="sb">`App.Models.User.</span><span class="si">${</span><span class="nx">userId</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">notification</span><span class="p">((</span><span class="nx">notification</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">notification</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p>この例では、<code>broadcast</code>チャンネルを介して<code>App\Models\User</code>インスタンスに送信されたすべての通知がコールバックによって受信されます。<code>App.Models.User.{id}</code>チャンネルのチャンネル認証コールバックは、アプリケーションの<code>routes/channels.php</code>ファイルに含まれています。</p>









  




<h2>ユーザーノート</h2>
<div id="user-contribution-section">
    <a href="#" id="toggle-contribution" class="toggle-link" aria-expanded="false" aria-controls="contribution-content">+ ユーザーノートを表示する</a>
    <div id="contribution-content" style="display: none;">
        <div id="giscus-container">
            <!-- Giscus script here -->
            <script src="https://giscus.app/client.js"
                    data-repo="koriym/l11ja"
                    data-repo-id="R_kgDOM2Kucw"
                    data-category="Announcements"
                    data-category-id="DIC_kwDOM2Kuc84Civbh"
                    data-mapping="pathname"
                    data-strict="0"
                    data-reactions-enabled="0"
                    data-emit-metadata="0"
                    data-input-position="bottom"
                    data-theme="light"
                    data-lang="en"
                    crossorigin="anonymous"
                    async>
            </script>
            <div id="terms-of-service">
                <h4>ユーザーノートについて</h4>
                <p>PHPマニュアルのように、マニュアルを補足する情報の共有を目的としてます。</p>
                <ul>
                    <li>掲示板ではありません。議論、質問、別のノートへの返信はできません。</li>
                    <li>バグや改善要望、または翻訳の Issue は、該当する GitHub リポジトリで報告してください。</li>
                    <li>ノートは事前の通知なく削除される場合があります。</li>
                    <li>Giscussのコメントシステムを流用しています。そのためノートとしては最適化されてないことをご了承ください。</li>
                    <li>保証されていません。投稿したノートが消失する事やノート機能全体が閉鎖する可能性があります。</li>
                    <li>お願い：いいノートにはup voteを、この規約に違反しているノートを見つけた場合は、優しくdown voteしてください。</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<script>
    (function() {
        const toggleLink = document.getElementById('toggle-contribution');
        const contributionContent = document.getElementById('contribution-content');

        toggleLink.addEventListener('click', function(e) {
            e.preventDefault();
            const isHidden = contributionContent.style.display === 'none';
            contributionContent.style.display = isHidden ? 'block' : 'none';
            toggleLink.textContent = isHidden ? '- ノートを非表示にする' : '+ ノートを表示する';
            toggleLink.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
        });
    })();
</script>

                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
<nav class="md-footer-nav">
    
    
</nav>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["back-to-top", "navigation.expand", "navigation.tabs", "navigation.footer", "navigation.sections", "navigation.expand", "content.code.copy", "hide_repository_button", "content.code.annotate", "content.tabs.link", "toc.none", "content.action.edit"], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>