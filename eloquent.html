
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/koriym/laravel11-ja/eloquent.html">
      
      
        <link rel="prev" href="redis.html">
      
      
        <link rel="next" href="eloquent-relationships.html">
      
      
      <link rel="icon" href="assets/images/favicon_io/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.35">
    
    
      
        <title>はじめに - L11JA</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.35f28582.min.css">
      
      


    
    

    

    
      <link rel="stylesheet" href="assets/css/php.css">
    
      <link rel="stylesheet" href="assets/css/mkdocs_material_extra.css">
    
      <link rel="stylesheet" href="assets/css/extra.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-G60CEHXLQ1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-G60CEHXLQ1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-G60CEHXLQ1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    

  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#eloquent" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!-- Determine classes -->



<!-- Header -->
<header class="md-header" data-md-component="header">
  <nav
          class="md-header__inner md-grid"
          aria-label="Header"
  >

    <!-- Link to home -->
    <a
            href="."
            title="L11JA"
            class="md-header__button md-logo"
            aria-label="L11JA"
            data-md-component="logo"
    >
      
  <img src="assets/images/logo.png" alt="logo">

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            <span style="font-family: 'Noto Sans'; font-size: 20px" >
            L11JA
            </span>
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            <span style="font-family: 'Noto Sans Batak'; font-size: 20px" >
            
              はじめに
            
            </span>
          </span>
        </div>
      </div>
    </div>

    <!-- Color palette toggle -->
    

    <!-- User preference: color palette -->
    
    <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
    <label class="md-header__button md-icon" for="__search">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
    </label>

    <!-- Search interface -->
    <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository information -->
    
    <div class="md-header__source">
      

<!--
  Check whether the repository is hosted on one of the supported code hosting
  platforms (GitHub, GitLab or Bitbucket) to show icon.
-->


  


<!-- Repository containing source -->
<a href="https://github.com/koriym/l11ja" title="source.link.title"
    class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg width="24" height="24" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" fill="#000"/></svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="releases.html" class="md-tabs__link">
          
  
  プロローグ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="installation.html" class="md-tabs__link">
          
  
  はじめに

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="lifecycle.html" class="md-tabs__link">
          
  
  アーキテクチャ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="routing.html" class="md-tabs__link">
          
  
  基本

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="artisan.html" class="md-tabs__link">
          
  
  掘り下げる

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="authentication.html" class="md-tabs__link">
          
  
  セキュリティ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="database.html" class="md-tabs__link">
          
  
  データベース

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="eloquent.html" class="md-tabs__link">
          
  
  Eloquent ORM

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="testing.html" class="md-tabs__link">
          
  
  テスト

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="starter-kits.html" class="md-tabs__link">
          
  
  パッケージ

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="L11JA" class="md-nav__button md-logo" aria-label="L11JA" data-md-component="logo">
      
  <img src="assets/images/logo.png" alt="logo">

    </a>
    L11JA
  </label>
  
    <div class="md-nav__source">
      

<!--
  Check whether the repository is hosted on one of the supported code hosting
  platforms (GitHub, GitLab or Bitbucket) to show icon.
-->


  


<!-- Repository containing source -->
<a href="https://github.com/koriym/l11ja" title="source.link.title"
    class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg width="24" height="24" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" fill="#000"/></svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    プロローグ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            プロローグ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="releases.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リリースノート
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="upgrade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    アップグレードガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contributions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    貢献ガイド
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            はじめに
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="installation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    インストール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="configuration.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    設定
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="structure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ディレクトリ構造
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="frontend.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    フロントエンド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="starter-kits.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    スターターキット
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deployment.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    デプロイ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    アーキテクチャ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            アーキテクチャ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lifecycle.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リクエストライフサイクル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="container.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    サービスコンテナ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="providers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    サービスプロバイダ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="facades.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファサード
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    基本
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            基本
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="routing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ルーティング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="middleware.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ミドルウェア
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="csrf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSRF保護
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="controllers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コントローラ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="requests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リクエスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="responses.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    レスポンス
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="views.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ビュー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="blade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bladeテンプレート
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vite.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    アセットバンドル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="urls.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    URL生成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="session.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    セッション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="validation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    バリデーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="errors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    エラー処理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="logging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ログ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    掘り下げる
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            掘り下げる
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="artisan.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artisanコンソール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="broadcasting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブロードキャスティング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cache.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    キャッシュ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="collections.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コレクション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concurrency.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    並行処理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="context.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コンテキスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contracts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コントラクト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="events.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    イベント
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="filesystem.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファイルストレージ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="helpers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ヘルパー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http-client.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTPクライアント
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="localization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ローカライゼーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mail.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    メール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="notifications.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    通知
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="packages.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    パッケージ開発
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="processes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    プロセス
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="queues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    キュー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rate-limiting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    レート制限
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="strings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文字列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="scheduling.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    タスクスケジューリング
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    セキュリティ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            セキュリティ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="authentication.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認証
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="authorization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認可
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="verification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    メール確認
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="encryption.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    暗号化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hashing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ハッシュ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="passwords.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    パスワードリセット
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    データベース
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            データベース
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="database.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="queries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    クエリビルダ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pagination.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ページネーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="migrations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    マイグレーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="seeding.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    シーディング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="redis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Eloquent ORM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Eloquent ORM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="eloquent.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      イントロダクション
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イントロダクション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laravel-bootcamp" class="md-nav__link">
    <span class="md-ellipsis">
      Laravel Bootcamp
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      モデルクラスの生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルクラスの生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの検査
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eloquent_1" class="md-nav__link">
    <span class="md-ellipsis">
      Eloquentモデルの規約
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Eloquentモデルの規約">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      テーブル名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      主キー
    </span>
  </a>
  
    <nav class="md-nav" aria-label="主キー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      「複合」主キー
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uuidulid" class="md-nav__link">
    <span class="md-ellipsis">
      UUIDとULIDキー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      タイムスタンプ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      データベース接続
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      デフォルトの属性値
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquent_2" class="md-nav__link">
    <span class="md-ellipsis">
      Eloquentの厳格性の設定
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      クエリの構築
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      モデルのリフレッシュ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      コレクション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      結果のチャンキング
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      遅延コレクションを使用したチャンク処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      カーソル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      高度なサブクエリ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="高度なサブクエリ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      サブクエリの選択
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      サブクエリによる順序付け
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      単一モデル / 集計の取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="単一モデル / 集計の取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      見つからない例外
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの取得または作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      集計の取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの挿入と更新
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルの挿入と更新">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      挿入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      更新
    </span>
  </a>
  
    <nav class="md-nav" aria-label="更新">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      マス更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      属性の変更を調べる
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      マスアサインメント
    </span>
  </a>
  
    <nav class="md-nav" aria-label="マスアサインメント">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      マスアサインメントとJSONカラム
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      マスアサインメントの許可
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      マスアサインメントの例外
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      アップサート
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの削除
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルの削除">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      主キーによる既存モデルの削除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      クエリを使用したモデルの削除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリート
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ソフトデリート">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリートされたモデルの復元
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの完全削除
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリートされたモデルのクエリ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ソフトデリートされたモデルのクエリ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリートされたモデルを含める
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリートされたモデルのみを取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの整理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルの整理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      マス整理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの複製
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      クエリスコープ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリスコープ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      グローバルスコープ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="グローバルスコープ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      スコープの生成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      グローバルスコープの記述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      グローバルスコープの適用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      匿名グローバルスコープ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      グローバルスコープの削除
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      ローカルスコープ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ローカルスコープ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      ローカルスコープの利用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      動的スコープ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの比較
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      イベント
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イベント">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      クロージャの使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      オブザーバー
    </span>
  </a>
  
    <nav class="md-nav" aria-label="オブザーバー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    <span class="md-ellipsis">
      オブザーバーの定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    <span class="md-ellipsis">
      オブザーバーとデータベーストランザクション
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    <span class="md-ellipsis">
      イベントのミュート
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イベントのミュート">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    <span class="md-ellipsis">
      イベントなしで単一のモデルを保存
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-relationships.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リレーションシップ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-collections.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コレクション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-mutators.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ミューテータ / キャスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-resources.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APIリソース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-serialization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    シリアライゼーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-factories.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファクトリ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    テスト
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            テスト
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http-tests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTPテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="console-tests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コンソールテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dusk.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブラウザテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="database-testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    データベース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mocking.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    モック
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    パッケージ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            パッケージ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="starter-kits.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    スターターキット
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="billing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cashier (Stripe)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cashier-paddle.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cashier (Paddle)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dusk.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブラウザテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="envoy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Envoy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fortify.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fortify
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="folio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="homestead.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homestead
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="horizon.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Horizon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mix.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="octane.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octane
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="passport.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Passport
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pennant.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pennant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pint.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="precognition.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Precognition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="prompts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prompts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pulse.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pulse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reverb.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sail.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sail
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sanctum.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sanctum
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="scout.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="socialite.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Socialite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="telescope.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Telescope
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="valet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Valet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      イントロダクション
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イントロダクション">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#laravel-bootcamp" class="md-nav__link">
    <span class="md-ellipsis">
      Laravel Bootcamp
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      モデルクラスの生成
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルクラスの生成">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの検査
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#eloquent_1" class="md-nav__link">
    <span class="md-ellipsis">
      Eloquentモデルの規約
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Eloquentモデルの規約">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      テーブル名
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      主キー
    </span>
  </a>
  
    <nav class="md-nav" aria-label="主キー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      「複合」主キー
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#uuidulid" class="md-nav__link">
    <span class="md-ellipsis">
      UUIDとULIDキー
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      タイムスタンプ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      データベース接続
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      デフォルトの属性値
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#eloquent_2" class="md-nav__link">
    <span class="md-ellipsis">
      Eloquentの厳格性の設定
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルの取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      クエリの構築
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      モデルのリフレッシュ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      コレクション
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      結果のチャンキング
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      遅延コレクションを使用したチャンク処理
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      カーソル
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      高度なサブクエリ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="高度なサブクエリ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      サブクエリの選択
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      サブクエリによる順序付け
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      単一モデル / 集計の取得
    </span>
  </a>
  
    <nav class="md-nav" aria-label="単一モデル / 集計の取得">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      見つからない例外
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの取得または作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      集計の取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの挿入と更新
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルの挿入と更新">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      挿入
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      更新
    </span>
  </a>
  
    <nav class="md-nav" aria-label="更新">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      マス更新
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      属性の変更を調べる
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      マスアサインメント
    </span>
  </a>
  
    <nav class="md-nav" aria-label="マスアサインメント">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json" class="md-nav__link">
    <span class="md-ellipsis">
      マスアサインメントとJSONカラム
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      マスアサインメントの許可
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      マスアサインメントの例外
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      アップサート
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの削除
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルの削除">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      主キーによる既存モデルの削除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      クエリを使用したモデルの削除
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリート
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ソフトデリート">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリートされたモデルの復元
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの完全削除
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリートされたモデルのクエリ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ソフトデリートされたモデルのクエリ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリートされたモデルを含める
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      ソフトデリートされたモデルのみを取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの整理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="モデルの整理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      マス整理
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの複製
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      クエリスコープ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クエリスコープ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      グローバルスコープ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="グローバルスコープ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      スコープの生成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      グローバルスコープの記述
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      グローバルスコープの適用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      匿名グローバルスコープ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      グローバルスコープの削除
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      ローカルスコープ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ローカルスコープ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      ローカルスコープの利用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_54" class="md-nav__link">
    <span class="md-ellipsis">
      動的スコープ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_55" class="md-nav__link">
    <span class="md-ellipsis">
      モデルの比較
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_56" class="md-nav__link">
    <span class="md-ellipsis">
      イベント
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イベント">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_57" class="md-nav__link">
    <span class="md-ellipsis">
      クロージャの使用
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_58" class="md-nav__link">
    <span class="md-ellipsis">
      オブザーバー
    </span>
  </a>
  
    <nav class="md-nav" aria-label="オブザーバー">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_59" class="md-nav__link">
    <span class="md-ellipsis">
      オブザーバーの定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_60" class="md-nav__link">
    <span class="md-ellipsis">
      オブザーバーとデータベーストランザクション
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_61" class="md-nav__link">
    <span class="md-ellipsis">
      イベントのミュート
    </span>
  </a>
  
    <nav class="md-nav" aria-label="イベントのミュート">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_62" class="md-nav__link">
    <span class="md-ellipsis">
      イベントなしで単一のモデルを保存
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/koriym/l11ja/edit/11.x-ja/eloquent.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="eloquent">Eloquent: はじめに<a class="headerlink" href="#eloquent" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="#introduction">イントロダクション</a></li>
<li><a href="#generating-model-classes">モデルクラスの生成</a></li>
<li><a href="#eloquent-model-conventions">Eloquentモデルの規約</a><ul>
<li><a href="#table-names">テーブル名</a></li>
<li><a href="#primary-keys">主キー</a></li>
<li><a href="#uuid-and-ulid-keys">UUIDとULIDキー</a></li>
<li><a href="#timestamps">タイムスタンプ</a></li>
<li><a href="#database-connections">データベース接続</a></li>
<li><a href="#default-attribute-values">デフォルトの属性値</a></li>
<li><a href="#configuring-eloquent-strictness">Eloquentの厳格性の設定</a></li>
</ul>
</li>
<li><a href="#retrieving-models">モデルの取得</a><ul>
<li><a href="#collections">コレクション</a></li>
<li><a href="#chunking-results">結果のチャンク</a></li>
<li><a href="#chunking-using-lazy-collections">レイジーコレクションを使用したチャンク</a></li>
<li><a href="#cursors">カーソル</a></li>
<li><a href="#advanced-subqueries">高度なサブクエリ</a></li>
</ul>
</li>
<li><a href="#retrieving-single-models">単一モデル / 集計の取得</a><ul>
<li><a href="#retrieving-or-creating-models">モデルの取得または作成</a></li>
<li><a href="#retrieving-aggregates">集計の取得</a></li>
</ul>
</li>
<li><a href="#inserting-and-updating-models">モデルの挿入と更新</a><ul>
<li><a href="#inserts">挿入</a></li>
<li><a href="#updates">更新</a></li>
<li><a href="#mass-assignment">マスアサインメント</a></li>
<li><a href="#upserts">アップサート</a></li>
</ul>
</li>
<li><a href="#deleting-models">モデルの削除</a><ul>
<li><a href="#soft-deleting">ソフトデリート</a></li>
<li><a href="#querying-soft-deleted-models">ソフトデリートされたモデルのクエリ</a></li>
</ul>
</li>
<li><a href="#pruning-models">モデルの整理</a></li>
<li><a href="#replicating-models">モデルの複製</a></li>
<li><a href="#query-scopes">クエリスコープ</a><ul>
<li><a href="#global-scopes">グローバルスコープ</a></li>
<li><a href="#local-scopes">ローカルスコープ</a></li>
</ul>
</li>
<li><a href="#comparing-models">モデルの比較</a></li>
<li><a href="#events">イベント</a><ul>
<li><a href="#events-using-closures">クロージャの使用</a></li>
<li><a href="#observers">オブザーバー</a></li>
<li><a href="#muting-events">イベントの無効化</a></li>
</ul>
</li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="_1">イントロダクション<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p>LaravelにはEloquentが含まれており、これはデータベースとのやり取りを楽しくするオブジェクト関係マッパー（ORM）です。Eloquentを使用する場合、各データベーステーブルにはそのテーブルとやり取りするために使用される対応する「モデル」があります。データベーステーブルからレコードを取得するだけでなく、Eloquentモデルを使用してテーブルからレコードを挿入、更新、削除することもできます。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>始める前に、アプリケーションの<code>config/database.php</code>設定ファイルでデータベース接続を設定してください。データベースの設定について詳しくは、<a href="database.html#configuration">データベース設定ドキュメント</a>を確認してください。</p>
</div>
<h4 id="laravel-bootcamp">Laravel Bootcamp<a class="headerlink" href="#laravel-bootcamp" title="Permanent link">&para;</a></h4>
<p>Laravelを初めて使う方は、<a href="https://bootcamp.laravel.com">Laravel Bootcamp</a>に飛び込んでみてください。Laravel Bootcampでは、Eloquentを使用して最初のLaravelアプリケーションを構築する手順を説明します。LaravelとEloquentが提供するすべての機能を紹介するのに最適な方法です。</p>
<p><a name="generating-model-classes"></a></p>
<h2 id="_2">モデルクラスの生成<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>始めるには、Eloquentモデルを作成しましょう。モデルは通常<code>app\Models</code>ディレクトリにあり、<code>Illuminate\Database\Eloquent\Model</code>クラスを拡張します。新しいモデルを生成するには、<code>make:model</code> <a href="artisan.html">Artisanコマンド</a>を使用できます:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight
</code></pre></div>
<p>モデルを生成する際に<a href="migrations.html">データベースマイグレーション</a>も一緒に作成したい場合は、<code>--migration</code>または<code>-m</code>オプションを使用できます:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>--migration
</code></pre></div>
<p>モデルを生成する際に、ファクトリー、シーダー、ポリシー、コントローラー、フォームリクエストなど、さまざまな種類のクラスを生成できます。さらに、これらのオプションを組み合わせて一度に複数のクラスを作成することもできます:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1"># モデルとFlightFactoryクラスを生成する...</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>--factory
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>-f
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="c1"># モデルとFlightSeederクラスを生成する...</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>--seed
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>-s
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="c1"># モデルとFlightControllerクラスを生成する...</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>--controller
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>-c
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="c1"># モデル、FlightControllerリソースクラス、フォームリクエストクラスを生成する...</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>--controller<span class="w"> </span>--resource<span class="w"> </span>--requests
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>-crR
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="c1"># モデルとFlightPolicyクラスを生成する...</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>--policy
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="c1"># モデルとマイグレーション、ファクトリー、シーダー、コントローラーを生成する...</span>
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#__codelineno-2-21"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>-mfsc
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#__codelineno-2-23"></a><span class="c1"># モデル、マイグレーション、ファクトリー、シーダー、ポリシー、コントローラー、フォームリクエストを生成するショートカット...</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#__codelineno-2-24"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>--all
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#__codelineno-2-25"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Flight<span class="w"> </span>-a
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#__codelineno-2-26"></a>
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#__codelineno-2-27"></a><span class="c1"># ピボットモデルを生成する...</span>
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#__codelineno-2-28"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Member<span class="w"> </span>--pivot
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#__codelineno-2-29"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:model<span class="w"> </span>Member<span class="w"> </span>-p
</code></pre></div>
<p><a name="inspecting-models"></a></p>
<h4 id="_3">モデルの検査<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<p>モデルのコードをスキャンするだけでは、モデルの利用可能なすべての属性とリレーションを判断するのが難しい場合があります。代わりに、<code>model:show</code> Artisanコマンドを試してみてください。これにより、モデルのすべての属性とリレーションの便利な概要が提供されます:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>model:show<span class="w"> </span>Flight
</code></pre></div>
<p><a name="eloquent-model-conventions"></a></p>
<h2 id="eloquent_1">Eloquentモデルの規約<a class="headerlink" href="#eloquent_1" title="Permanent link">&para;</a></h2>
<p><code>make:model</code>コマンドによって生成されたモデルは、<code>app/Models</code>ディレクトリに配置されます。基本的なモデルクラスを見て、Eloquentのいくつかの主要な規約について説明しましょう:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="table-names"></a></p>
<h3 id="_4">テーブル名<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>上記の例では、<code>Flight</code>モデルに対応するデータベーステーブルを明示的に指定していないことにお気づきでしょう。慣例により、クラスの「スネークケース」の複数形の名前がテーブル名として使用されます。ただし、別の名前が明示的に指定されていない限りです。したがって、この場合、Eloquentは<code>Flight</code>モデルが<code>flights</code>テーブルにレコードを格納し、<code>AirTrafficController</code>モデルが<code>air_traffic_controllers</code>テーブルにレコードを格納すると仮定します。</p>
<p>モデルに対応するデータベーステーブルがこの規約に適合しない場合は、モデルに<code>table</code>プロパティを定義して、モデルのテーブル名を手動で指定できます:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * モデルに関連付けられたテーブル。</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$table</span> <span class="o">=</span> <span class="s1">&#39;my_flights&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="primary-keys"></a></p>
<h3 id="_5">主キー<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>Eloquentは、各モデルの対応するデータベーステーブルに<code>id</code>という名前の主キーカラムがあると仮定します。必要に応じて、モデルに<code>$primaryKey</code>プロパティを定義して、モデルの主キーとして別のカラムを指定できます:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * テーブルに関連付けられた主キー。</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$primaryKey</span> <span class="o">=</span> <span class="s1">&#39;flight_id&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>さらに、Eloquentは主キーが増分する整数値であると仮定します。つまり、Eloquentは自動的に主キーを整数にキャストします。非増分または非数値の主キーを使用する場合は、モデルに<code>$incrementing</code>プロパティを定義し、<code>false</code>に設定する必要があります:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * モデルのIDが自動増分するかどうかを示す。</span>
<span class="sd">     *</span>
<span class="sd">     * @var bool</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="nv">$incrementing</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>モデルの主キーが整数でない場合は、モデルに<code>$keyType</code>プロパティを定義する必要があります。このプロパティの値は<code>string</code>である必要があります:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * 主キーIDのデータ型。</span>
<span class="sd">     *</span>
<span class="sd">     * @var string</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$keyType</span> <span class="o">=</span> <span class="s1">&#39;string&#39;</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="composite-primary-keys"></a></p>
<h4 id="_6">「複合」主キー<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h4>
<p>Eloquentは各モデルに少なくとも1つの一意に識別できる「ID」を持つことを要求します。これは主キーとして機能します。Eloquentモデルは「複合」主キーをサポートしていません。ただし、テーブルの一意に識別する主キーに加えて、テーブルに追加の複数列の一意インデックスを自由に追加できます。</p>
<p><a name="uuid-and-ulid-keys"></a></p>
<h3 id="uuidulid">UUIDとULIDキー<a class="headerlink" href="#uuidulid" title="Permanent link">&para;</a></h3>
<p>Eloquentモデルの主キーとして自動増分する整数を使用する代わりに、UUIDを使用することもできます。UUIDは、36文字の長さのユニバーサルユニークなアルファニューメリック識別子です。</p>
<p>モデルにUUIDキーを使用する場合は、モデルに<code>Illuminate\Database\Eloquent\Concerns\HasUuids</code>トレイトを使用できます。もちろん、モデルに<a href="migrations.html#column-method-uuid">UUID相当の主キーカラム</a>があることを確認する必要があります:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Concerns\HasUuids</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Article</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasUuids</span><span class="p">;</span>

    <span class="c1">// ...</span>
<span class="p">}</span>

<span class="nv">$article</span> <span class="o">=</span> <span class="nx">Article</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Traveling to Europe&#39;</span><span class="p">]);</span>

<span class="nv">$article</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span> <span class="c1">// &quot;8f8e8478-9035-4d23-b9a7-62f4d2612ce5&quot;</span>
</code></pre></div>
<p>デフォルトでは、<code>HasUuids</code>トレイトはモデルに<a href="strings.html#method-str-ordered-uuid">"ordered" UUID</a>を生成します。これらのUUIDは、辞書順にソートできるため、インデックス付きのデータベースストレージに効率的です。</p>
<p>特定のモデルのUUID生成プロセスをオーバーライドするには、モデルに<code>newUniqueId</code>メソッドを定義します。さらに、モデルに<code>uniqueIds</code>メソッドを定義して、UUIDを受け取るべきカラムを指定できます:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Ramsey\Uuid\Uuid</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * モデルの新しいUUIDを生成する。</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">newUniqueId</span><span class="p">()</span><span class="o">:</span> <span class="nx">string</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="nx">Uuid</span><span class="o">::</span><span class="na">uuid4</span><span class="p">();</span>
<span class="p">}</span>

<span class="sd">/**</span>
<span class="sd"> * 一意の識別子を受け取るべきカラムを取得する。</span>
<span class="sd"> *</span>
<span class="sd"> * @return array&lt;int, string&gt;</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">uniqueIds</span><span class="p">()</span><span class="o">:</span> <span class="k">array</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;discount_code&#39;</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>もし希望するなら、UUIDの代わりに「ULID」を利用することもできます。ULIDはUUIDに似ていますが、長さは26文字です。順序付きUUIDと同様に、ULIDはデータベースのインデックス作成に効率的な辞書順にソート可能です。ULIDを利用するには、モデルに<code>Illuminate\Database\Eloquent\Concerns\HasUlids</code>トレイトを使用する必要があります。また、モデルが<a href="migrations.html#column-method-ulid">ULIDに相当する主キーカラム</a>を持つことを確認する必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Concerns\HasUlids</span><span class="p">;</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="k">class</span> <span class="nc">Article</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">{</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>    <span class="k">use</span> <span class="nx">HasUlids</span><span class="p">;</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a>    <span class="c1">// ...</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="p">}</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="nv">$article</span> <span class="o">=</span> <span class="nx">Article</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Traveling to Asia&#39;</span><span class="p">]);</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="nv">$article</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span> <span class="c1">// &quot;01gd4d3tgrrfqeda94gdbtdk5c&quot;</span>
</code></pre></div>
<p><a name="timestamps"></a></p>
<h3 id="_7">タイムスタンプ<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>デフォルトでは、Eloquentはモデルに対応するデータベーステーブルに<code>created_at</code>と<code>updated_at</code>カラムが存在することを期待します。Eloquentは、モデルが作成または更新されるときにこれらのカラムの値を自動的に設定します。これらのカラムをEloquentで自動的に管理したくない場合は、モデルに<code>$timestamps</code>プロパティを<code>false</code>の値で定義する必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
<a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
<a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="p">{</span>
<a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a>    <span class="sd">/**</span>
<a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="sd">     * モデルにタイムスタンプを付けるかどうかを示す</span>
<a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="sd">     *</span>
<a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="sd">     * @var bool</span>
<a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="sd">     */</span>
<a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a>    <span class="k">public</span> <span class="nv">$timestamps</span> <span class="o">=</span> <span class="k">false</span><span class="p">;</span>
<a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a><span class="p">}</span>
</code></pre></div>
<p>モデルのタイムスタンプのフォーマットをカスタマイズする必要がある場合は、モデルに<code>$dateFormat</code>プロパティを設定します。このプロパティは、日付属性がデータベースに保存される方法と、モデルが配列またはJSONにシリアライズされるときのフォーマットを決定します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="p">{</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>    <span class="sd">/**</span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="sd">     * モデルの日付カラムの保存フォーマット</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="sd">     *</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="sd">     * @var string</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="sd">     */</span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a>    <span class="k">protected</span> <span class="nv">$dateFormat</span> <span class="o">=</span> <span class="s1">&#39;U&#39;</span><span class="p">;</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="p">}</span>
</code></pre></div>
<p>タイムスタンプを保存するために使用されるカラムの名前をカスタマイズする必要がある場合は、モデルに<code>CREATED_AT</code>と<code>UPDATED_AT</code>定数を定義できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">{</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    <span class="k">const</span> <span class="no">CREATED_AT</span> <span class="o">=</span> <span class="s1">&#39;creation_date&#39;</span><span class="p">;</span>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>    <span class="k">const</span> <span class="no">UPDATED_AT</span> <span class="o">=</span> <span class="s1">&#39;updated_date&#39;</span><span class="p">;</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="p">}</span>
</code></pre></div>
<p>モデルの<code>updated_at</code>タイムスタンプを変更せずにモデル操作を実行したい場合は、<code>withoutTimestamps</code>メソッドに渡されたクロージャ内でモデルを操作できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nx">Model</span><span class="o">::</span><span class="na">withoutTimestamps</span><span class="p">(</span><span class="nx">fn</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="nv">$post</span><span class="o">-&gt;</span><span class="na">increment</span><span class="p">(</span><span class="s1">&#39;reads&#39;</span><span class="p">));</span>
</code></pre></div>
<p><a name="database-connections"></a></p>
<h3 id="_8">データベース接続<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>デフォルトでは、すべてのEloquentモデルはアプリケーションに設定されたデフォルトのデータベース接続を使用します。特定のモデルとのやり取り時に別の接続を使用する場合は、モデルに<code>$connection</code>プロパティを定義する必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a>
<a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a>
<a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="p">{</span>
<a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a>    <span class="sd">/**</span>
<a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="sd">     * モデルで使用されるデータベース接続</span>
<a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="sd">     *</span>
<a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="sd">     * @var string</span>
<a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="sd">     */</span>
<a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a>    <span class="k">protected</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="s1">&#39;mysql&#39;</span><span class="p">;</span>
<a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="p">}</span>
</code></pre></div>
<p><a name="default-attribute-values"></a></p>
<h3 id="_9">デフォルトの属性値<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>新しくインスタンス化されたモデルインスタンスには、デフォルトで属性値が含まれません。モデルの一部の属性にデフォルト値を定義したい場合は、モデルに<code>$attributes</code>プロパティを定義できます。<code>$attributes</code>配列に配置された属性値は、データベースから読み取られたかのように、そのままの「保存可能な」形式である必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="p">{</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>    <span class="sd">/**</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="sd">     * モデルの属性のデフォルト値</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="sd">     *</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="sd">     * @var array</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="sd">     */</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="k">protected</span> <span class="nv">$attributes</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>        <span class="s1">&#39;options&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;[]&#39;</span><span class="p">,</span>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>        <span class="s1">&#39;delayed&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">,</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a>    <span class="p">];</span>
<a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="p">}</span>
</code></pre></div>
<p><a name="configuring-eloquent-strictness"></a></p>
<h3 id="eloquent_2">Eloquentの厳格性の設定<a class="headerlink" href="#eloquent_2" title="Permanent link">&para;</a></h3>
<p>Laravelは、さまざまな状況でEloquentの動作と「厳格性」を設定できるいくつかのメソッドを提供しています。</p>
<p>まず、<code>preventLazyLoading</code>メソッドは、遅延読み込みを防止するかどうかを示すオプションのブール値引数を受け入れます。たとえば、本番環境では遅延読み込みを無効にせず、本番コードに誤って遅延読み込みされた関係が存在しても本番環境が正常に機能し続けるように、非本番環境でのみ遅延読み込みを無効にすることができます。通常、このメソッドはアプリケーションの<code>AppServiceProvider</code>の<code>boot</code>メソッドで呼び出す必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a>
<a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="sd">/**</span>
<a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="sd"> * 任意のアプリケーションサービスをブートストラップする</span>
<a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="sd"> */</span>
<a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-11-7" name="__codelineno-11-7" href="#__codelineno-11-7"></a><span class="p">{</span>
<a id="__codelineno-11-8" name="__codelineno-11-8" href="#__codelineno-11-8"></a>    <span class="nx">Model</span><span class="o">::</span><span class="na">preventLazyLoading</span><span class="p">(</span><span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">isProduction</span><span class="p">());</span>
<a id="__codelineno-11-9" name="__codelineno-11-9" href="#__codelineno-11-9"></a><span class="p">}</span>
</code></pre></div>
<p>また、<code>preventSilentlyDiscardingAttributes</code>メソッドを呼び出すことで、設定不可能な属性を設定しようとしたときに例外をスローするようにLaravelに指示できます。これにより、ローカル開発中にモデルの<code>fillable</code>配列に追加されていない属性を設定しようとしたときに、予期せぬエラーを防ぐことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="nx">Model</span><span class="o">::</span><span class="na">preventSilentlyDiscardingAttributes</span><span class="p">(</span><span class="o">!</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">isProduction</span><span class="p">());</span>
</code></pre></div>
<p><a name="retrieving-models"></a></p>
<h2 id="_10">モデルの取得<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h2>
<p>モデルを作成し、<a href="migrations.html#generating-migrations">それに関連するデータベーステーブル</a>を作成したら、データベースからデータを取得する準備が整いました。各Eloquentモデルを、モデルに関連するデータベーステーブルを流暢にクエリできる強力な<a href="queries.html">クエリビルダ</a>と考えることができます。モデルの<code>all</code>メソッドは、モデルに関連するデータベーステーブルからすべてのレコードを取得します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="k">foreach</span> <span class="p">(</span><span class="nx">Flight</span><span class="o">::</span><span class="na">all</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$flight</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a>    <span class="k">echo</span> <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="p">}</span>
</code></pre></div>
<p><a name="building-queries"></a></p>
<h4 id="_11">クエリの構築<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>Eloquentの<code>all</code>メソッドは、モデルのテーブルからすべての結果を返します。ただし、各Eloquentモデルは<a href="queries.html">クエリビルダ</a>として機能するため、クエリに追加の制約を追加し、<code>get</code>メソッドを呼び出して結果を取得できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nv">$flights</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a>               <span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a>               <span class="o">-&gt;</span><span class="na">take</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>               <span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Eloquentモデルはクエリビルダであるため、Laravelの<a href="queries.html">クエリビルダ</a>が提供するすべてのメソッドを確認する必要があります。Eloquentクエリを記述する際に、これらのメソッドを使用できます。</p>
</div>
<p><a name="refreshing-models"></a></p>
<h4 id="_12">モデルのリフレッシュ<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>データベースから取得されたEloquentモデルのインスタンスが既にある場合、<code>fresh</code>および<code>refresh</code>メソッドを使用してモデルを「リフレッシュ」できます。<code>fresh</code>メソッドは、モデルをデータベースから再取得します。既存のモデルインスタンスには影響しません。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;FR 900&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="nv">$freshFlight</span> <span class="o">=</span> <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">fresh</span><span class="p">();</span>
</code></pre></div>
<p><code>refresh</code>メソッドは、データベースからの新鮮なデータを使用して既存のモデルを再ハイドレートします。さらに、そのすべての読み込まれたリレーションもリフレッシュされます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;number&#39;</span><span class="p">,</span> <span class="s1">&#39;FR 900&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">number</span> <span class="o">=</span> <span class="s1">&#39;FR 456&#39;</span><span class="p">;</span>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">refresh</span><span class="p">();</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">number</span><span class="p">;</span> <span class="c1">// &quot;FR 900&quot;</span>
</code></pre></div>
<p><a name="collections"></a></p>
<h3 id="_13">コレクション<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h3>
<p>これまで見てきたように、Eloquentの<code>all</code>や<code>get</code>などのメソッドは、データベースから複数のレコードを取得します。ただし、これらのメソッドはプレーンなPHP配列を返すのではなく、<code>Illuminate\Database\Eloquent\Collection</code>のインスタンスを返します。</p>
<p>Eloquentの<code>Collection</code>クラスは、Laravelの基本<code>Illuminate\Support\Collection</code>クラスを拡張しており、データコレクションと対話するための<a href="collections.html#available-methods">さまざまな便利なメソッド</a>を提供します。たとえば、<code>reject</code>メソッドを使用して、呼び出されたクロージャの結果に基づいてコレクションからモデルを削除できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="nv">$flights</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;destination&#39;</span><span class="p">,</span> <span class="s1">&#39;Paris&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="nv">$flights</span> <span class="o">=</span> <span class="nv">$flights</span><span class="o">-&gt;</span><span class="na">reject</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Flight</span> <span class="nv">$flight</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    <span class="k">return</span> <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">cancelled</span><span class="p">;</span>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="p">});</span>
</code></pre></div>
<p>Laravelの基本コレクションクラスが提供するメソッドに加えて、Eloquentコレクションクラスは、Eloquentモデルのコレクションと対話するために特に意図された<a href="eloquent-collections.html#available-methods">いくつかの追加メソッド</a>を提供します。</p>
<p>LaravelのすべてのコレクションはPHPの反復可能なインターフェースを実装しているため、コレクションを配列のようにループすることができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$flights</span> <span class="k">as</span> <span class="nv">$flight</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a>    <span class="k">echo</span> <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="p">}</span>
</code></pre></div>
<p><a name="chunking-results"></a></p>
<h3 id="_14">結果のチャンキング<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h3>
<p><code>all</code>または<code>get</code>メソッドを使用して数万のEloquentレコードを読み込もうとすると、アプリケーションのメモリが不足する可能性があります。これらのメソッドの代わりに、<code>chunk</code>メソッドを使用して大量のモデルをより効率的に処理できます。</p>
<p><code>chunk</code>メソッドは、Eloquentモデルのサブセットを取得し、それらをクロージャに渡して処理します。現在のチャンクのEloquentモデルのみが一度に取得されるため、<code>chunk</code>メソッドは大量のモデルを扱う際に大幅にメモリ使用量を削減します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Collection</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="nx">Flight</span><span class="o">::</span><span class="na">chunk</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Collection</span> <span class="nv">$flights</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    <span class="k">foreach</span> <span class="p">(</span><span class="nv">$flights</span> <span class="k">as</span> <span class="nv">$flight</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>        <span class="c1">// ...</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>    <span class="p">}</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="p">});</span>
</code></pre></div>
<p><code>chunk</code>メソッドに渡される最初の引数は、各「チャンク」で受け取りたいレコードの数です。クロージャとして渡される2番目の引数は、データベースから取得された各チャンクに対して呼び出されます。データベースクエリは、クロージャに渡される各チャンクのレコードを取得するために実行されます。</p>
<p><code>chunk</code>メソッドの結果をフィルタリングする際に、イテレーション中に更新するカラムに基づいてフィルタリングする場合は、<code>chunkById</code>メソッドを使用するべきです。このようなシナリオで<code>chunk</code>メソッドを使用すると、予期しない結果や一貫性のない結果を招く可能性があります。内部的には、<code>chunkById</code>メソッドは常に前のチャンクの最後のモデルよりも<code>id</code>カラムが大きいモデルを取得します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;departed&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>    <span class="o">-&gt;</span><span class="na">chunkById</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Collection</span> <span class="nv">$flights</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>        <span class="nv">$flights</span><span class="o">-&gt;</span><span class="na">each</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;departed&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]);</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="p">},</span> <span class="nv">$column</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a name="chunking-using-lazy-collections"></a></p>
<h3 id="_15">遅延コレクションを使用したチャンク処理<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p><code>lazy</code>メソッドは、<a href="#chunking-results"><code>chunk</code>メソッド</a>と同様に、内部的にはクエリをチャンクで実行します。ただし、各チャンクを直接コールバックに渡すのではなく、<code>lazy</code>メソッドはEloquentモデルのフラット化された<a href="collections.html#lazy-collections"><code>LazyCollection</code></a>を返します。これにより、結果を単一のストリームとして操作できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="k">foreach</span> <span class="p">(</span><span class="nx">Flight</span><span class="o">::</span><span class="na">lazy</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$flight</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>    <span class="c1">// ...</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="p">}</span>
</code></pre></div>
<p><code>lazy</code>メソッドの結果をフィルタリングする際に、イテレーション中に更新するカラムに基づいてフィルタリングする場合は、<code>lazyById</code>メソッドを使用するべきです。内部的には、<code>lazyById</code>メソッドは常に前のチャンクの最後のモデルよりも<code>id</code>カラムが大きいモデルを取得します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;departed&#39;</span><span class="p">,</span> <span class="k">true</span><span class="p">)</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>    <span class="o">-&gt;</span><span class="na">lazyById</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="nv">$column</span> <span class="o">=</span> <span class="s1">&#39;id&#39;</span><span class="p">)</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>    <span class="o">-&gt;</span><span class="na">each</span><span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;departed&#39;</span> <span class="o">=&gt;</span> <span class="k">false</span><span class="p">]);</span>
</code></pre></div>
<p><code>lazyByIdDesc</code>メソッドを使用して、<code>id</code>の降順で結果をフィルタリングすることもできます。</p>
<p><a name="cursors"></a></p>
<h3 id="_16">カーソル<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p><code>lazy</code>メソッドと同様に、<code>cursor</code>メソッドは、何万ものEloquentモデルレコードを反復処理する際に、アプリケーションのメモリ消費を大幅に削減するために使用できます。</p>
<p><code>cursor</code>メソッドは、単一のデータベースクエリのみを実行します。ただし、個々のEloquentモデルは、実際に反復処理されるまでハイドレートされません。したがって、反復処理中には常に1つのEloquentモデルのみがメモリに保持されます。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>cursor</code>メソッドは常に1つのEloquentモデルのみをメモリに保持するため、リレーションを積極的にロードすることはできません。リレーションを積極的にロードする必要がある場合は、代わりに<a href="#chunking-using-lazy-collections"><code>lazy</code>メソッド</a>を使用することを検討してください。</p>
</div>
<p>内部的には、<code>cursor</code>メソッドはPHPの<a href="https://www.php.net/manual/en/language.generators.overview.php">ジェネレータ</a>を使用してこの機能を実装しています。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="k">foreach</span> <span class="p">(</span><span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;destination&#39;</span><span class="p">,</span> <span class="s1">&#39;Zurich&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">cursor</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$flight</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a>    <span class="c1">// ...</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="p">}</span>
</code></pre></div>
<p><code>cursor</code>は<code>Illuminate\Support\LazyCollection</code>インスタンスを返します。<a href="collections.html#lazy-collections">遅延コレクション</a>を使用すると、通常のLaravelコレクションで利用可能な多くのコレクションメソッドを使用できますが、一度に1つのモデルのみをメモリにロードします。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">cursor</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">filter</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="k">return</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span> <span class="o">&gt;</span> <span class="mi">500</span><span class="p">;</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a><span class="p">});</span>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a><span class="k">foreach</span> <span class="p">(</span><span class="nv">$users</span> <span class="k">as</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>    <span class="k">echo</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">id</span><span class="p">;</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a><span class="p">}</span>
</code></pre></div>
<p><code>cursor</code>メソッドは通常のクエリよりもはるかに少ないメモリを使用します（一度に1つのEloquentモデルのみをメモリに保持するため）が、最終的にはメモリ不足になる可能性があります。これは、<a href="https://www.php.net/manual/en/mysqlinfo.concepts.buffering.php">PHPのPDOドライバが内部的にすべての生のクエリ結果をバッファにキャッシュするため</a>です。非常に多数のEloquentレコードを扱う場合は、代わりに<a href="#chunking-using-lazy-collections"><code>lazy</code>メソッド</a>を使用することを検討してください。</p>
<p><a name="advanced-subqueries"></a></p>
<h3 id="_17">高度なサブクエリ<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p><a name="subquery-selects"></a></p>
<h4 id="_18">サブクエリの選択<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h4>
<p>Eloquentは、高度なサブクエリサポートも提供しています。これにより、単一のクエリで関連テーブルから情報を引き出すことができます。例えば、フライトの<code>destinations</code>テーブルと<code>flights</code>テーブルがあるとします。<code>flights</code>テーブルには、目的地に到着した時間を示す<code>arrived_at</code>カラムがあります。</p>
<p>クエリビルダの<code>select</code>および<code>addSelect</code>メソッドで利用可能なサブクエリ機能を使用すると、単一のクエリですべての<code>destinations</code>と、その目的地に最後に到着したフライトの名前を選択できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="k">use</span> <span class="nx">App\Models\Destination</span><span class="p">;</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="k">return</span> <span class="nx">Destination</span><span class="o">::</span><span class="na">addSelect</span><span class="p">([</span><span class="s1">&#39;last_flight&#39;</span> <span class="o">=&gt;</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
<a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a>    <span class="o">-&gt;</span><span class="na">whereColumn</span><span class="p">(</span><span class="s1">&#39;destination_id&#39;</span><span class="p">,</span> <span class="s1">&#39;destinations.id&#39;</span><span class="p">)</span>
<a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a>    <span class="o">-&gt;</span><span class="na">orderByDesc</span><span class="p">(</span><span class="s1">&#39;arrived_at&#39;</span><span class="p">)</span>
<a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a>    <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="p">])</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p><a name="subquery-ordering"></a></p>
<h4 id="_19">サブクエリによる順序付け<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h4>
<p>さらに、クエリビルダの<code>orderBy</code>関数はサブクエリをサポートしています。フライトの例を続けると、この機能を使用して、最後のフライトが到着した時間に基づいてすべての目的地を並べ替えることができます。これも、単一のデータベースクエリで実行できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">return</span> <span class="nx">Destination</span><span class="o">::</span><span class="na">orderByDesc</span><span class="p">(</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>    <span class="nx">Flight</span><span class="o">::</span><span class="na">select</span><span class="p">(</span><span class="s1">&#39;arrived_at&#39;</span><span class="p">)</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a>        <span class="o">-&gt;</span><span class="na">whereColumn</span><span class="p">(</span><span class="s1">&#39;destination_id&#39;</span><span class="p">,</span> <span class="s1">&#39;destinations.id&#39;</span><span class="p">)</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>        <span class="o">-&gt;</span><span class="na">orderByDesc</span><span class="p">(</span><span class="s1">&#39;arrived_at&#39;</span><span class="p">)</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>        <span class="o">-&gt;</span><span class="na">limit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p><a name="retrieving-single-models"></a></p>
<h2 id="_20">単一モデル / 集計の取得<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h2>
<p>特定のクエリに一致するすべてのレコードを取得するだけでなく、<code>find</code>、<code>first</code>、または<code>firstWhere</code>メソッドを使用して単一のレコードを取得することもできます。これらのメソッドは、モデルのコレクションではなく、単一のモデルインスタンスを返します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="c1">// 主キーでモデルを取得...</span>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="c1">// クエリ制約に一致する最初のモデルを取得...</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="c1">// クエリ制約に一致する最初のモデルを取得する代替方法...</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">firstWhere</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div>
<p>結果が見つからない場合に何らかのアクションを実行したい場合があります。<code>findOr</code>および<code>firstOr</code>メソッドは、単一のモデルインスタンスを返すか、結果が見つからない場合に指定されたクロージャを実行します。クロージャが返す値は、メソッドの結果と見なされます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">findOr</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>    <span class="c1">// ...</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="p">});</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;legs&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">firstOr</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a>    <span class="c1">// ...</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="p">});</span>
</code></pre></div>
<p><a name="not-found-exceptions"></a></p>
<h4 id="_21">見つからない例外<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<p>モデルが見つからない場合に例外をスローしたい場合があります。これは、特にルートやコントローラで役立ちます。<code>findOrFail</code>および<code>firstOrFail</code>メソッドは、クエリの最初の結果を取得しますが、結果が見つからない場合は<code>Illuminate\Database\Eloquent\ModelNotFoundException</code>がスローされます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;legs&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">firstOrFail</span><span class="p">();</span>
</code></pre></div>
<p><code>ModelNotFoundException</code>がキャッチされない場合、404 HTTPレスポンスが自動的にクライアントに返されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/api/flights/{id}&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">string</span> <span class="nv">$id</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a>    <span class="k">return</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>
<a id="__codelineno-30-5" name="__codelineno-30-5" href="#__codelineno-30-5"></a><span class="p">});</span>
</code></pre></div>
<p><a name="retrieving-or-creating-models"></a></p>
<h3 id="_22">モデルの取得または作成<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h3>
<p><code>firstOrCreate</code>メソッドは、指定されたカラム/値のペアを使用してデータベースレコードを検索しようとします。モデルがデータベースに見つからない場合、最初の配列引数とオプションの2番目の配列引数をマージした属性を持つレコードが挿入されます。</p>
<p><code>firstOrNew</code>メソッドは、<code>firstOrCreate</code>と同様に、指定された属性に一致するレコードをデータベースで検索しようとします。ただし、モデルが見つからない場合、新しいモデルインスタンスが返されます。<code>firstOrNew</code>によって返されるモデルは、まだデータベースに保存されていません。保存するには、手動で<code>save</code>メソッドを呼び出す必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="c1">// 名前でフライトを取得するか、存在しない場合は作成...</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">firstOrCreate</span><span class="p">([</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;London to Paris&#39;</span>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="p">]);</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="c1">// 名前でフライトを取得するか、名前、遅延、到着時間の属性で作成...</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">firstOrCreate</span><span class="p">(</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;London to Paris&#39;</span><span class="p">],</span>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a>    <span class="p">[</span><span class="s1">&#39;delayed&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;arrival_time&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;11:30&#39;</span><span class="p">]</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="p">);</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="c1">// 名前でフライトを取得するか、新しいFlightインスタンスをインスタンス化...</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">firstOrNew</span><span class="p">([</span>
<a id="__codelineno-31-16" name="__codelineno-31-16" href="#__codelineno-31-16"></a>    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;London to Paris&#39;</span>
<a id="__codelineno-31-17" name="__codelineno-31-17" href="#__codelineno-31-17"></a><span class="p">]);</span>
<a id="__codelineno-31-18" name="__codelineno-31-18" href="#__codelineno-31-18"></a>
<a id="__codelineno-31-19" name="__codelineno-31-19" href="#__codelineno-31-19"></a><span class="c1">// 名前でフライトを取得するか、名前、遅延、到着時間の属性でインスタンス化...</span>
<a id="__codelineno-31-20" name="__codelineno-31-20" href="#__codelineno-31-20"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">firstOrNew</span><span class="p">(</span>
<a id="__codelineno-31-21" name="__codelineno-31-21" href="#__codelineno-31-21"></a>    <span class="p">[</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Tokyo to Sydney&#39;</span><span class="p">],</span>
<a id="__codelineno-31-22" name="__codelineno-31-22" href="#__codelineno-31-22"></a>    <span class="p">[</span><span class="s1">&#39;delayed&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;arrival_time&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;11:30&#39;</span><span class="p">]</span>
<a id="__codelineno-31-23" name="__codelineno-31-23" href="#__codelineno-31-23"></a><span class="p">);</span>
</code></pre></div>
<p><a name="retrieving-aggregates"></a></p>
<h3 id="_23">集計の取得<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h3>
<p>Eloquentモデルを操作する際に、Laravelの<a href="queries.html">クエリビルダ</a>が提供する<code>count</code>、<code>sum</code>、<code>max</code>、その他の<a href="queries.html#aggregates">集計メソッド</a>を使用することもできます。これらのメソッドは、Eloquentモデルインスタンスではなく、スカラー値を返すことが期待されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="nv">$count</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">count</span><span class="p">();</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="nv">$max</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">max</span><span class="p">(</span><span class="s1">&#39;price&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a name="inserting-and-updating-models"></a></p>
<h2 id="_24">モデルの挿入と更新<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h2>
<p><a name="inserts"></a></p>
<h3 id="_25">挿入<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<p>もちろん、Eloquentを使用する場合、データベースからモデルを取得するだけでなく、新しいレコードを挿入する必要もあります。幸いなことに、Eloquentはこれを簡単にしてくれます。データベースに新しいレコードを挿入するには、新しいモデルインスタンスをインスタンス化し、モデルに属性を設定します。そして、モデルインスタンスの<code>save</code>メソッドを呼び出します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="k">namespace</span> <span class="nx">App\Http\Controllers</span><span class="p">;</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a><span class="k">use</span> <span class="nx">App\Http\Controllers\Controller</span><span class="p">;</span>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a><span class="k">use</span> <span class="nx">Illuminate\Http\RedirectResponse</span><span class="p">;</span>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a><span class="k">class</span> <span class="nc">FlightController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="p">{</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a>    <span class="sd">/**</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="sd">     * データベースに新しいフライトを保存します。</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="sd">     */</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">store</span><span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span><span class="o">:</span> <span class="nx">RedirectResponse</span>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a>    <span class="p">{</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a>        <span class="c1">// リクエストの検証...</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a>        <span class="nv">$flight</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Flight</span><span class="p">;</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a>        <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a>        <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a>
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a>        <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/flights&#39;</span><span class="p">);</span>
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a>    <span class="p">}</span>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a><span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/flights&#39;</span><span class="p">);</span>
</code></pre></div>
<p>この例では、受信したHTTPリクエストからの<code>name</code>フィールドを<code>App\Models\Flight</code>モデルインスタンスの<code>name</code>属性に代入しています。<code>save</code>メソッドを呼び出すと、データベースにレコードが挿入されます。モデルの<code>created_at</code>と<code>updated_at</code>タイムスタンプは、<code>save</code>メソッドが呼び出されたときに自動的に設定されるため、手動で設定する必要はありません。</p>
<p>あるいは、<code>create</code>メソッドを使用して、1つのPHPステートメントで新しいモデルを「保存」することもできます。<code>create</code>メソッドによって挿入されたモデルインスタンスは、<code>create</code>メソッドによって返されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;London to Paris&#39;</span><span class="p">,</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="p">]);</span>
</code></pre></div>
<p>ただし、<code>create</code>メソッドを使用する前に、モデルクラスに<code>fillable</code>または<code>guarded</code>プロパティを指定する必要があります。これらのプロパティは、すべてのEloquentモデルがデフォルトでマスアサインメントの脆弱性から保護されているために必要です。マスアサインメントについて詳しく知りたい場合は、<a href="#mass-assignment">マスアサインメントのドキュメント</a>を参照してください。</p>
<p><a name="updates"></a></p>
<h3 id="_26">更新<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p><code>save</code>メソッドは、データベースに既に存在するモデルを更新するためにも使用できます。モデルを更新するには、それを取得し、更新したい属性を設定します。その後、モデルの<code>save</code>メソッドを呼び出します。ここでも、<code>updated_at</code>タイムスタンプは自動的に更新されるため、手動で設定する必要はありません。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;Paris to London&#39;</span><span class="p">;</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
</code></pre></div>
<p>時には、既存のモデルを更新するか、一致するモデルが存在しない場合に新しいモデルを作成する必要があるかもしれません。<code>firstOrCreate</code>メソッドと同様に、<code>updateOrCreate</code>メソッドはモデルを永続化するため、手動で<code>save</code>メソッドを呼び出す必要はありません。</p>
<p>以下の例では、<code>departure</code>が<code>Oakland</code>で<code>destination</code>が<code>San Diego</code>のフライトが存在する場合、その<code>price</code>と<code>discounted</code>カラムが更新されます。そのようなフライトが存在しない場合、最初の引数の配列と2番目の引数の配列をマージした属性を持つ新しいフライトが作成されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">updateOrCreate</span><span class="p">(</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a>    <span class="p">[</span><span class="s1">&#39;departure&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Oakland&#39;</span><span class="p">,</span> <span class="s1">&#39;destination&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;San Diego&#39;</span><span class="p">],</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>    <span class="p">[</span><span class="s1">&#39;price&#39;</span> <span class="o">=&gt;</span> <span class="mi">99</span><span class="p">,</span> <span class="s1">&#39;discounted&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="p">);</span>
</code></pre></div>
<p><a name="mass-updates"></a></p>
<h4 id="_27">マス更新<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h4>
<p>特定のクエリに一致するモデルに対しても更新を実行できます。この例では、<code>active</code>で<code>destination</code>が<code>San Diego</code>のすべてのフライトが遅延としてマークされます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a>      <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;destination&#39;</span><span class="p">,</span> <span class="s1">&#39;San Diego&#39;</span><span class="p">)</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>      <span class="o">-&gt;</span><span class="na">update</span><span class="p">([</span><span class="s1">&#39;delayed&#39;</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">]);</span>
</code></pre></div>
<p><code>update</code>メソッドは、更新するカラムと値のペアの配列を期待します。<code>update</code>メソッドは、影響を受けた行数を返します。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Eloquentを介してマス更新を発行する場合、更新されたモデルに対して<code>saving</code>、<code>saved</code>、<code>updating</code>、<code>updated</code>モデルイベントは発生しません。これは、マス更新を発行する際にモデルが実際に取得されることがないためです。</p>
</div>
<p><a name="examining-attribute-changes"></a></p>
<h4 id="_28">属性の変更を調べる<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h4>
<p>Eloquentは、モデルの内部状態を調べ、その属性が最初に取得されてからどのように変化したかを判断するための<code>isDirty</code>、<code>isClean</code>、<code>wasChanged</code>メソッドを提供します。</p>
<p><code>isDirty</code>メソッドは、モデルが取得されてからモデルの属性のいずれかが変更されたかどうかを判断します。特定の属性名または属性の配列を<code>isDirty</code>メソッドに渡して、それらの属性のいずれかが「ダーティ」であるかどうかを判断できます。<code>isClean</code>メソッドは、モデルが取得されてから属性が変更されていないかどうかを判断します。このメソッドもオプションの属性引数を受け入れます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>    <span class="s1">&#39;first_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>    <span class="s1">&#39;last_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Otwell&#39;</span><span class="p">,</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>    <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Developer&#39;</span><span class="p">,</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="p">]);</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;Painter&#39;</span><span class="p">;</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isDirty</span><span class="p">();</span> <span class="c1">// true</span>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isDirty</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span> <span class="c1">// true</span>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isDirty</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span> <span class="c1">// false</span>
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isDirty</span><span class="p">([</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]);</span> <span class="c1">// true</span>
<a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a>
<a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isClean</span><span class="p">();</span> <span class="c1">// false</span>
<a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isClean</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span> <span class="c1">// false</span>
<a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isClean</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span> <span class="c1">// true</span>
<a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isClean</span><span class="p">([</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]);</span> <span class="c1">// false</span>
<a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>
<a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a>
<a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isDirty</span><span class="p">();</span> <span class="c1">// false</span>
<a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">isClean</span><span class="p">();</span> <span class="c1">// true</span>
</code></pre></div>
<p><code>wasChanged</code>メソッドは、現在のリクエストサイクル内でモデルが最後に保存されたときに属性が変更されたかどうかを判断します。必要に応じて、特定の属性が変更されたかどうかを確認するために属性名を渡すことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a>    <span class="s1">&#39;first_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Taylor&#39;</span><span class="p">,</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>    <span class="s1">&#39;last_name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Otwell&#39;</span><span class="p">,</span>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a>    <span class="s1">&#39;title&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Developer&#39;</span><span class="p">,</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="p">]);</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">title</span> <span class="o">=</span> <span class="s1">&#39;Painter&#39;</span><span class="p">;</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">save</span><span class="p">();</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">wasChanged</span><span class="p">();</span> <span class="c1">// true</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">wasChanged</span><span class="p">(</span><span class="s1">&#39;title&#39;</span><span class="p">);</span> <span class="c1">// true</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">wasChanged</span><span class="p">([</span><span class="s1">&#39;title&#39;</span><span class="p">,</span> <span class="s1">&#39;slug&#39;</span><span class="p">]);</span> <span class="c1">// true</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">wasChanged</span><span class="p">(</span><span class="s1">&#39;first_name&#39;</span><span class="p">);</span> <span class="c1">// false</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">wasChanged</span><span class="p">([</span><span class="s1">&#39;first_name&#39;</span><span class="p">,</span> <span class="s1">&#39;title&#39;</span><span class="p">]);</span> <span class="c1">// true</span>
</code></pre></div>
<p><code>getOriginal</code>メソッドは、モデルが取得されてからの変更に関係なく、モデルの元の属性を含む配列を返します。必要に応じて、特定の属性の元の値を取得するために属性名を渡すことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span> <span class="c1">// John</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">email</span><span class="p">;</span> <span class="c1">// john@example.com</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s2">&quot;Jack&quot;</span><span class="p">;</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span><span class="p">;</span> <span class="c1">// Jack</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getOriginal</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">);</span> <span class="c1">// John</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">getOriginal</span><span class="p">();</span> <span class="c1">// 元の属性の配列...</span>
</code></pre></div>
<p><a name="mass-assignment"></a></p>
<h3 id="_29">マスアサインメント<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<p><code>create</code>メソッドを使用して、1つのPHPステートメントで新しいモデルを「保存」することができます。挿入されたモデルインスタンスは、メソッドによって返されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;London to Paris&#39;</span><span class="p">,</span>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="p">]);</span>
</code></pre></div>
<p>ただし、<code>create</code>メソッドを使用する前に、モデルクラスに<code>fillable</code>または<code>guarded</code>プロパティを指定する必要があります。これらのプロパティは、すべてのEloquentモデルがデフォルトでマスアサインメントの脆弱性から保護されているために必要です。</p>
<p>マスアサインメントの脆弱性は、ユーザーが意図しないHTTPリクエストフィールドを送信し、そのフィールドによって予期せぬデータベースカラムが変更される場合に発生します。例えば、悪意のあるユーザーがHTTPリクエストを介して<code>is_admin</code>パラメータを送信し、それがモデルの<code>create</code>メソッドに渡されると、ユーザーは自分自身を管理者に昇格させることができます。</p>
<p>そのため、始めるには、どのモデル属性をマスアサイン可能にするかを定義する必要があります。これは、モデルの<code>$fillable</code>プロパティを使用して行うことができます。例えば、<code>Flight</code>モデルの<code>name</code>属性をマスアサイン可能にしましょう。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a><span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="p">{</span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>    <span class="sd">/**</span>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="sd">     * マスアサイン可能な属性。</span>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="sd">     *</span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a><span class="sd">     * @var array</span>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="sd">     */</span>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">];</span>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="p">}</span>
</code></pre></div>
<p>マスアサイン可能な属性を指定したら、<code>create</code>メソッドを使用してデータベースに新しいレコードを挿入できます。<code>create</code>メソッドは、新しく作成されたモデルインスタンスを返します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">create</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;London to Paris&#39;</span><span class="p">]);</span>
</code></pre></div>
<p>既にモデルインスタンスがある場合は、<code>fill</code>メソッドを使用して属性の配列でそれを埋めることができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">fill</span><span class="p">([</span><span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Amsterdam to Frankfurt&#39;</span><span class="p">]);</span>
</code></pre></div>
<p><a name="mass-assignment-json-columns"></a></p>
<h4 id="json">マスアサインメントとJSONカラム<a class="headerlink" href="#json" title="Permanent link">&para;</a></h4>
<p>JSONカラムを割り当てる場合、各カラムのマスアサイン可能なキーをモデルの<code>$fillable</code>配列に指定する必要があります。セキュリティ上の理由から、Laravelは<code>guarded</code>プロパティを使用する場合にネストされたJSON属性の更新をサポートしていません。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="sd">/**</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="sd"> * マスアサイン可能な属性。</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a><span class="sd"> *</span>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="sd"> * @var array</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a><span class="sd"> */</span>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>    <span class="s1">&#39;options-&gt;enabled&#39;</span><span class="p">,</span>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="p">];</span>
</code></pre></div>
<p><a name="allowing-mass-assignment"></a></p>
<h4 id="_30">マスアサインメントの許可<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h4>
<p>すべての属性をマスアサイン可能にする場合は、モデルの<code>$guarded</code>プロパティを空の配列として定義できます。モデルをアンガードすることを選択した場合、Eloquentの<code>fill</code>、<code>create</code>、<code>update</code>メソッドに渡される配列を常に手動で作成するように特別な注意を払う必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="sd">/**</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="sd"> * マスアサイン不可能な属性。</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="sd"> *</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="sd"> * @var array</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="sd"> */</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="k">protected</span> <span class="nv">$guarded</span> <span class="o">=</span> <span class="p">[];</span>
</code></pre></div>
<p><a name="mass-assignment-exceptions"></a></p>
<h4 id="_31">マスアサインメントの例外<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h4>
<p>デフォルトでは、<code>$fillable</code>配列に含まれていない属性は、マスアサインメント操作を実行する際に静かに破棄されます。本番環境ではこれが期待される動作ですが、ローカル開発中には、モデルの変更が効果を発揮しない理由について混乱を招く可能性があります。</p>
<p>必要に応じて、Laravelに、フィル可能でない属性を試みて埋める際に例外をスローするように指示できます。これは、アプリケーションの<code>AppServiceProvider</code>クラスの<code>boot</code>メソッドで<code>preventSilentlyDiscardingAttributes</code>メソッドを呼び出すことで実行できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="sd">/**</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="sd"> * 任意のアプリケーションサービスをブートストラップします。</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="sd"> */</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="p">{</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a>    <span class="nx">Model</span><span class="o">::</span><span class="na">preventSilentlyDiscardingAttributes</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">app</span><span class="o">-&gt;</span><span class="na">isLocal</span><span class="p">());</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="p">}</span>
</code></pre></div>
<p><a name="upserts"></a></p>
<h3 id="_32">アップサート<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<p>Eloquentの<code>upsert</code>メソッドは、単一のアトミック操作でレコードを更新または作成するために使用できます。メソッドの最初の引数は、挿入または更新する値で構成され、2番目の引数は、関連するテーブル内でレコードを一意に識別するカラムのリストです。メソッドの3番目の引数は、データベース内に一致するレコードが既に存在する場合に更新する必要があるカラムの配列です。<code>upsert</code>メソッドは、モデルでタイムスタンプが有効になっている場合、自動的に<code>created_at</code>と<code>updated_at</code>タイムスタンプを設定します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="nx">Flight</span><span class="o">::</span><span class="na">upsert</span><span class="p">([</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a>    <span class="p">[</span><span class="s1">&#39;departure&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Oakland&#39;</span><span class="p">,</span> <span class="s1">&#39;destination&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;San Diego&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="o">=&gt;</span> <span class="mi">99</span><span class="p">],</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a>    <span class="p">[</span><span class="s1">&#39;departure&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Chicago&#39;</span><span class="p">,</span> <span class="s1">&#39;destination&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;New York&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="o">=&gt;</span> <span class="mi">150</span><span class="p">]</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;departure&#39;</span><span class="p">,</span> <span class="s1">&#39;destination&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]);</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="nx">Flight</span><span class="o">::</span><span class="na">upsert</span><span class="p">([</span>
    <span class="p">[</span><span class="s1">&#39;departure&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Oakland&#39;</span><span class="p">,</span> <span class="s1">&#39;destination&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;San Diego&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="o">=&gt;</span> <span class="mi">99</span><span class="p">],</span>
    <span class="p">[</span><span class="s1">&#39;departure&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Chicago&#39;</span><span class="p">,</span> <span class="s1">&#39;destination&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;New York&#39;</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span> <span class="o">=&gt;</span> <span class="mi">150</span><span class="p">]</span>
<span class="p">],</span> <span class="nx">uniqueBy</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;departure&#39;</span><span class="p">,</span> <span class="s1">&#39;destination&#39;</span><span class="p">],</span> <span class="nx">update</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;price&#39;</span><span class="p">]);</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>upsert</code>メソッドの2番目の引数にある列には、SQL Serverを除くすべてのデータベースで「主キー」または「ユニーク」インデックスが必要です。さらに、MariaDBおよびMySQLデータベースドライバは、<code>upsert</code>メソッドの2番目の引数を無視し、常にテーブルの「主キー」と「ユニーク」インデックスを使用して既存のレコードを検出します。</p>
</div>
<p><a name="deleting-models"></a></p>
<h2 id="_33">モデルの削除<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h2>
<p>モデルを削除するには、モデルインスタンスで<code>delete</code>メソッドを呼び出すことができます:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>

<span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</code></pre></div>
<p>モデルに関連するすべてのデータベースレコードを削除するには、<code>truncate</code>メソッドを呼び出すことができます。<code>truncate</code>操作は、モデルに関連するテーブルの自動インクリメントIDもリセットします:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Flight</span><span class="o">::</span><span class="na">truncate</span><span class="p">();</span>
</code></pre></div>
<p><a name="deleting-an-existing-model-by-its-primary-key"></a></p>
<h4 id="_34">主キーによる既存モデルの削除<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h4>
<p>上記の例では、<code>delete</code>メソッドを呼び出す前にデータベースからモデルを取得しています。ただし、モデルの主キーがわかっている場合は、<code>destroy</code>メソッドを呼び出すことで、モデルを明示的に取得せずにモデルを削除できます。<code>destroy</code>メソッドは、単一の主キー、複数の主キー、主キーの配列、または主キーの<a href="collections.html">コレクション</a>を受け入れます:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Flight</span><span class="o">::</span><span class="na">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nx">Flight</span><span class="o">::</span><span class="na">destroy</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>

<span class="nx">Flight</span><span class="o">::</span><span class="na">destroy</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]);</span>

<span class="nx">Flight</span><span class="o">::</span><span class="na">destroy</span><span class="p">(</span><span class="nx">collect</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]));</span>
</code></pre></div>
<p><a href="#soft-deleting">ソフトデリートモデル</a>を利用している場合、<code>forceDestroy</code>メソッドを介してモデルを完全に削除できます:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Flight</span><span class="o">::</span><span class="na">forceDestroy</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>destroy</code>メソッドは各モデルを個別にロードし、<code>delete</code>メソッドを呼び出すため、各モデルに対して<code>deleting</code>および<code>deleted</code>イベントが適切に発行されます。</p>
</div>
<p><a name="deleting-models-using-queries"></a></p>
<h4 id="_35">クエリを使用したモデルの削除<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h4>
<p>もちろん、クエリの条件に一致するすべてのモデルを削除するためにEloquentクエリを構築できます。この例では、非アクティブとマークされたすべてのフライトを削除します。マス更新と同様に、マス削除は削除されたモデルに対してモデルイベントを発行しません:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$deleted</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Eloquentを介してマス削除ステートメントを実行する場合、削除されたモデルに対して<code>deleting</code>および<code>deleted</code>モデルイベントは発行されません。これは、削除ステートメントの実行時にモデルが実際に取得されることがないためです。</p>
</div>
<p><a name="soft-deleting"></a></p>
<h3 id="_36">ソフトデリート<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h3>
<p>データベースから実際にレコードを削除するだけでなく、Eloquentはモデルを「ソフトデリート」することもできます。モデルがソフトデリートされると、実際にはデータベースから削除されません。代わりに、モデルが「削除」された日時を示す<code>deleted_at</code>属性がモデルに設定されます。モデルのソフトデリートを有効にするには、モデルに<code>Illuminate\Database\Eloquent\SoftDeletes</code>トレイトを追加します:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\SoftDeletes</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">SoftDeletes</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>SoftDeletes</code>トレイトは、<code>deleted_at</code>属性を自動的に<code>DateTime</code> / <code>Carbon</code>インスタンスにキャストします。</p>
</div>
<p>また、データベーステーブルに<code>deleted_at</code>列を追加する必要があります。Laravelの<a href="migrations.html">スキーマビルダ</a>には、この列を作成するためのヘルパーメソッドが含まれています:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schema</span><span class="p">;</span>

<span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">softDeletes</span><span class="p">();</span>
<span class="p">});</span>

<span class="nx">Schema</span><span class="o">::</span><span class="na">table</span><span class="p">(</span><span class="s1">&#39;flights&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">dropSoftDeletes</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
<p>これで、モデルで<code>delete</code>メソッドを呼び出すと、<code>deleted_at</code>列に現在の日時が設定されます。ただし、モデルのデータベースレコードはテーブルに残ります。ソフトデリートを使用するモデルをクエリする場合、ソフトデリートされたモデルは自動的にすべてのクエリ結果から除外されます。</p>
<p>特定のモデルインスタンスがソフトデリートされたかどうかを判断するには、<code>trashed</code>メソッドを使用できます:</p>
<div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="p">(</span><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">trashed</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="restoring-soft-deleted-models"></a></p>
<h4 id="_37">ソフトデリートされたモデルの復元<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h4>
<p>ソフトデリートされたモデルを「復元」したい場合があります。ソフトデリートされたモデルを復元するには、モデルインスタンスで<code>restore</code>メソッドを呼び出すことができます。<code>restore</code>メソッドは、モデルの<code>deleted_at</code>列を<code>null</code>に設定します:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">restore</span><span class="p">();</span>
</code></pre></div>
<p>クエリで<code>restore</code>メソッドを使用して複数のモデルを復元することもできます。他の「マス」操作と同様に、これにより復元されたモデルに対してモデルイベントは発行されません:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Flight</span><span class="o">::</span><span class="na">withTrashed</span><span class="p">()</span>
        <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;airline_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">-&gt;</span><span class="na">restore</span><span class="p">();</span>
</code></pre></div>
<p><a href="eloquent-relationships.html">リレーション</a>クエリを構築する際にも<code>restore</code>メソッドを使用できます:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">history</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">restore</span><span class="p">();</span>
</code></pre></div>
<p><a name="permanently-deleting-models"></a></p>
<h4 id="_38">モデルの完全削除<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h4>
<p>データベースからモデルを完全に削除する必要がある場合があります。ソフトデリートされたモデルをデータベーステーブルから完全に削除するには、<code>forceDelete</code>メソッドを使用できます:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">forceDelete</span><span class="p">();</span>
</code></pre></div>
<p>Eloquentリレーションクエリを構築する際にも<code>forceDelete</code>メソッドを使用できます:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">history</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">forceDelete</span><span class="p">();</span>
</code></pre></div>
<p><a name="querying-soft-deleted-models"></a></p>
<h3 id="_39">ソフトデリートされたモデルのクエリ<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h3>
<p><a name="including-soft-deleted-models"></a></p>
<h4 id="_40">ソフトデリートされたモデルを含める<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h4>
<p>前述のように、ソフトデリートされたモデルは自動的にクエリ結果から除外されます。ただし、クエリで<code>withTrashed</code>メソッドを呼び出すことで、ソフトデリートされたモデルをクエリ結果に含めることができます:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\Flight</span><span class="p">;</span>

<span class="nv">$flights</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">withTrashed</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;account_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p><a href="eloquent-relationships.html">リレーション</a>クエリを構築する際にも<code>withTrashed</code>メソッドを呼び出すことができます:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">history</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">withTrashed</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p><a name="retrieving-only-soft-deleted-models"></a></p>
<h4 id="_41">ソフトデリートされたモデルのみを取得<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h4>
<p><code>onlyTrashed</code>メソッドは、<strong>ソフトデリートされたモデルのみ</strong>を取得します:</p>
<div class="highlight"><pre><span></span><code><span class="nv">$flights</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">onlyTrashed</span><span class="p">()</span>
                <span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;airline_id&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p><a name="pruning-models"></a></p>
<h2 id="_42">モデルの整理<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h2>
<p>不要になったモデルを定期的に削除したい場合があります。これを実現するには、定期的に整理したいモデルに<code>Illuminate\Database\Eloquent\Prunable</code>または<code>Illuminate\Database\Eloquent\MassPrunable</code>トレイトを追加します。モデルにトレイトを追加した後、不要になったモデルを解決するEloquentクエリビルダを返す<code>prunable</code>メソッドを実装します:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Prunable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Prunable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * 整理可能なモデルクエリを取得します。</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">prunable</span><span class="p">()</span><span class="o">:</span> <span class="nx">Builder</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subMonth</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><code>Prunable</code>としてモデルをマークする場合、モデルに<code>pruning</code>メソッドを定義することもできます。このメソッドは、モデルが削除される前に呼び出されます。このメソッドは、モデルがデータベースから完全に削除される前に、モデルに関連する追加のリソース（例えば、保存されたファイル）を削除するのに役立ちます:</p>
<div class="highlight"><pre><span></span><code><span class="sd">/**</span>
<span class="sd"> * モデルの整理の準備をします。</span>
<span class="sd"> */</span>
<span class="k">protected</span> <span class="k">function</span> <span class="nf">pruning</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>整理可能なモデルを設定した後、アプリケーションの<code>routes/console.php</code>ファイルに<code>model:prune</code> Artisanコマンドをスケジュールする必要があります。このコマンドを実行する適切な間隔を自由に選択できます:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Schedule</span><span class="p">;</span>

<span class="nx">Schedule</span><span class="o">::</span><span class="na">command</span><span class="p">(</span><span class="s1">&#39;model:prune&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">daily</span><span class="p">();</span>
</code></pre></div>
<p>舞台裏では、<code>model:prune</code>コマンドは自動的にアプリケーションの<code>app/Models</code>ディレクトリ内の「Prunable」モデルを検出します。モデルが別の場所にある場合は、<code>--model</code>オプションを使用してモデルクラス名を指定できます:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Schedule</span><span class="o">::</span><span class="na">command</span><span class="p">(</span><span class="s1">&#39;model:prune&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;--model&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">Address</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">class</span><span class="p">],</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="na">daily</span><span class="p">();</span>
</code></pre></div>
<p>整理中に特定のモデルを除外したい場合は、<code>--except</code>オプションを使用できます:</p>
<div class="highlight"><pre><span></span><code><span class="nx">Schedule</span><span class="o">::</span><span class="na">command</span><span class="p">(</span><span class="s1">&#39;model:prune&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;--except&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="nx">Address</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">class</span><span class="p">],</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="na">daily</span><span class="p">();</span>
</code></pre></div>
<p><code>--pretend</code>オプションを使用して<code>model:prune</code>コマンドを実行することで、<code>prunable</code>クエリをテストできます。pretendモードでは、<code>model:prune</code>コマンドは、コマンドが実際に実行された場合に何件のレコードが整理されるかを報告するだけです:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>model:prune<span class="w"> </span>--pretend
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>ソフトデリートされたモデルは、整理可能なクエリに一致する場合、完全に削除（<code>forceDelete</code>）されます。</p>
</div>
<p><a name="mass-pruning"></a></p>
<h4 id="_43">マス整理<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h4>
<p><code>Illuminate\Database\Eloquent\MassPrunable</code>トレイトでモデルがマークされている場合、モデルはマス削除クエリを使用してデータベースから削除されます。したがって、<code>pruning</code>メソッドは呼び出されず、<code>deleting</code>および<code>deleted</code>モデルイベントも発行されません。これは、モデルが削除前に実際に取得されないため、整理プロセスがより効率的になるためです:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\MassPrunable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Flight</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">MassPrunable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * 整理可能なモデルクエリを取得します。</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">prunable</span><span class="p">()</span><span class="o">:</span> <span class="nx">Builder</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="k">static</span><span class="o">::</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;=&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subMonth</span><span class="p">());</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>```

<a name="replicating-models"></a></p>
<h2 id="_44">モデルの複製<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h2>
<p>既存のモデルインスタンスの未保存のコピーを作成するには、<code>replicate</code>メソッドを使用できます。このメソッドは、多くの同じ属性を共有するモデルインスタンスがある場合に特に便利です。

<code>php
use App\Models\Address;

$shipping = Address::create([
    'type' =&gt; 'shipping',
    'line_1' =&gt; '123 Example Street',
    'city' =&gt; 'Victorville',
    'state' =&gt; 'CA',
    'postcode' =&gt; '90001',
]);

$billing = $shipping-&gt;replicate()-&gt;fill([
    'type' =&gt; 'billing'
]);

$billing-&gt;save();</code></p>
<p>新しいモデルに複製されないようにする属性を1つ以上除外するには、<code>replicate</code>メソッドに配列を渡すことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nx">Flight</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a>    <span class="s1">&#39;destination&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LAX&#39;</span><span class="p">,</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a>    <span class="s1">&#39;origin&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;LHR&#39;</span><span class="p">,</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a>    <span class="s1">&#39;last_flown&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;2020-03-04 11:00:00&#39;</span><span class="p">,</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>    <span class="s1">&#39;last_pilot_id&#39;</span> <span class="o">=&gt;</span> <span class="mi">747</span><span class="p">,</span>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="p">]);</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="nv">$flight</span> <span class="o">=</span> <span class="nv">$flight</span><span class="o">-&gt;</span><span class="na">replicate</span><span class="p">([</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>    <span class="s1">&#39;last_flown&#39;</span><span class="p">,</span>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a>    <span class="s1">&#39;last_pilot_id&#39;</span>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="p">]);</span>
</code></pre></div>
<p><a name="query-scopes"></a></p>
<h2 id="_45">クエリスコープ<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h2>
<p><a name="global-scopes"></a></p>
<h3 id="_46">グローバルスコープ<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h3>
<p>グローバルスコープを使用すると、特定のモデルのすべてのクエリに制約を追加できます。Laravelの<a href="#soft-deleting">ソフトデリート</a>機能は、グローバルスコープを使用して、データベースから「削除されていない」モデルのみを取得します。独自のグローバルスコープを記述することで、特定のモデルのすべてのクエリが特定の制約を受けるようにする簡単な方法を提供できます。</p>
<p><a name="generating-scopes"></a></p>
<h4 id="_47">スコープの生成<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h4>
<p>新しいグローバルスコープを生成するには、<code>make:scope</code> Artisanコマンドを呼び出すことができます。これにより、生成されたスコープがアプリケーションの<code>app/Models/Scopes</code>ディレクトリに配置されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:scope<span class="w"> </span>AncientScope
</code></pre></div>
<p><a name="writing-global-scopes"></a></p>
<h4 id="_48">グローバルスコープの記述<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h4>
<p>グローバルスコープの記述は簡単です。まず、<code>make:scope</code>コマンドを使用して、<code>Illuminate\Database\Eloquent\Scope</code>インターフェースを実装するクラスを生成します。<code>Scope</code>インターフェースでは、<code>apply</code>メソッドを実装する必要があります。<code>apply</code>メソッドは、必要に応じて<code>where</code>制約や他の種類の句をクエリに追加できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="k">namespace</span> <span class="nx">App\Models\Scopes</span><span class="p">;</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Scope</span><span class="p">;</span>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="k">class</span> <span class="nc">AncientScope</span> <span class="k">implements</span> <span class="nx">Scope</span>
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a><span class="p">{</span>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a>    <span class="sd">/**</span>
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="sd">     * Apply the scope to a given Eloquent query builder.</span>
<a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="sd">     */</span>
<a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">apply</span><span class="p">(</span><span class="nx">Builder</span> <span class="nv">$builder</span><span class="p">,</span> <span class="nx">Model</span> <span class="nv">$model</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-54-15" name="__codelineno-54-15" href="#__codelineno-54-15"></a>    <span class="p">{</span>
<a id="__codelineno-54-16" name="__codelineno-54-16" href="#__codelineno-54-16"></a>        <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subYears</span><span class="p">(</span><span class="mi">2000</span><span class="p">));</span>
<a id="__codelineno-54-17" name="__codelineno-54-17" href="#__codelineno-54-17"></a>    <span class="p">}</span>
<a id="__codelineno-54-18" name="__codelineno-54-18" href="#__codelineno-54-18"></a><span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>グローバルスコープがクエリのselect句に列を追加する場合、<code>select</code>の代わりに<code>addSelect</code>メソッドを使用する必要があります。これにより、クエリの既存のselect句が意図せずに置き換えられるのを防ぐことができます。</p>
</div>
<p><a name="applying-global-scopes"></a></p>
<h4 id="_49">グローバルスコープの適用<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h4>
<p>モデルにグローバルスコープを割り当てるには、モデルに<code>ScopedBy</code>属性を配置するだけです。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="k">use</span> <span class="nx">App\Models\Scopes\AncientScope</span><span class="p">;</span>
<a id="__codelineno-55-6" name="__codelineno-55-6" href="#__codelineno-55-6"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Attributes\ScopedBy</span><span class="p">;</span>
<a id="__codelineno-55-7" name="__codelineno-55-7" href="#__codelineno-55-7"></a>
<a id="__codelineno-55-8" name="__codelineno-55-8" href="#__codelineno-55-8"></a><span class="p">#[</span><span class="nd">ScopedBy</span><span class="p">([</span><span class="nx">AncientScope</span><span class="o">::</span><span class="na">class</span><span class="p">])]</span>
<a id="__codelineno-55-9" name="__codelineno-55-9" href="#__codelineno-55-9"></a><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-55-10" name="__codelineno-55-10" href="#__codelineno-55-10"></a><span class="p">{</span>
<a id="__codelineno-55-11" name="__codelineno-55-11" href="#__codelineno-55-11"></a>    <span class="c1">//</span>
<a id="__codelineno-55-12" name="__codelineno-55-12" href="#__codelineno-55-12"></a><span class="p">}</span>
</code></pre></div>
<p>または、モデルの<code>booted</code>メソッドをオーバーライドして、モデルの<code>addGlobalScope</code>メソッドを呼び出すことで、グローバルスコープを手動で登録することもできます。<code>addGlobalScope</code>メソッドは、スコープのインスタンスを唯一の引数として受け取ります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="k">use</span> <span class="nx">App\Models\Scopes\AncientScope</span><span class="p">;</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="p">{</span>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a>    <span class="sd">/**</span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="sd">     * The &quot;booted&quot; method of the model.</span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="sd">     */</span>
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a>    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">booted</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>    <span class="p">{</span>
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a>        <span class="k">static</span><span class="o">::</span><span class="na">addGlobalScope</span><span class="p">(</span><span class="k">new</span> <span class="nx">AncientScope</span><span class="p">);</span>
<a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a>    <span class="p">}</span>
<a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a><span class="p">}</span>
</code></pre></div>
<p>上記の例で<code>App\Models\User</code>モデルにスコープを追加した後、<code>User::all()</code>メソッドを呼び出すと、次のSQLクエリが実行されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">select</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="o">`</span><span class="n">users</span><span class="o">`</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="o">`</span><span class="n">created_at</span><span class="o">`</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0021</span><span class="o">-</span><span class="mi">02</span><span class="o">-</span><span class="mi">18</span><span class="w"> </span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span><span class="p">:</span><span class="mi">00</span>
</code></pre></div>
<p><a name="anonymous-global-scopes"></a></p>
<h4 id="_50">匿名グローバルスコープ<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h4>
<p>Eloquentでは、クロージャを使用してグローバルスコープを定義することもできます。これは、独自のクラスを必要としない単純なスコープに特に便利です。クロージャを使用してグローバルスコープを定義する場合、<code>addGlobalScope</code>メソッドの最初の引数として、独自に選択したスコープ名を指定する必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="p">{</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a>    <span class="sd">/**</span>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="sd">     * The &quot;booted&quot; method of the model.</span>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="sd">     */</span>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a>    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">booted</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>    <span class="p">{</span>
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a>        <span class="k">static</span><span class="o">::</span><span class="na">addGlobalScope</span><span class="p">(</span><span class="s1">&#39;ancient&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nv">$builder</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a>            <span class="nv">$builder</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">,</span> <span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">subYears</span><span class="p">(</span><span class="mi">2000</span><span class="p">));</span>
<a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a>        <span class="p">});</span>
<a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a>    <span class="p">}</span>
<a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a><span class="p">}</span>
</code></pre></div>
<p><a name="removing-global-scopes"></a></p>
<h4 id="_51">グローバルスコープの削除<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h4>
<p>特定のクエリのグローバルスコープを削除したい場合は、<code>withoutGlobalScope</code>メソッドを使用できます。このメソッドは、グローバルスコープのクラス名を唯一の引数として受け取ります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="nx">User</span><span class="o">::</span><span class="na">withoutGlobalScope</span><span class="p">(</span><span class="nx">AncientScope</span><span class="o">::</span><span class="na">class</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p>または、クロージャを使用してグローバルスコープを定義した場合は、グローバルスコープに割り当てた文字列名を渡す必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="nx">User</span><span class="o">::</span><span class="na">withoutGlobalScope</span><span class="p">(</span><span class="s1">&#39;ancient&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p>クエリのグローバルスコープのいくつかまたはすべてを削除したい場合は、<code>withoutGlobalScopes</code>メソッドを使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="c1">// Remove all of the global scopes...</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="nx">User</span><span class="o">::</span><span class="na">withoutGlobalScopes</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="c1">// Remove some of the global scopes...</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="nx">User</span><span class="o">::</span><span class="na">withoutGlobalScopes</span><span class="p">([</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a>    <span class="nx">FirstScope</span><span class="o">::</span><span class="na">class</span><span class="p">,</span> <span class="nx">SecondScope</span><span class="o">::</span><span class="na">class</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="p">])</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p><a name="local-scopes"></a></p>
<h3 id="_52">ローカルスコープ<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h3>
<p>ローカルスコープを使用すると、アプリケーション全体で簡単に再利用できる共通のクエリ制約のセットを定義できます。たとえば、「人気がある」と見なされるすべてのユーザーを頻繁に取得する必要がある場合があります。スコープを定義するには、Eloquentモデルメソッドに<code>scope</code>プレフィックスを付けます。</p>
<p>スコープは常に同じクエリビルダインスタンスを返すか、<code>void</code>を返す必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-62-9" name="__codelineno-62-9" href="#__codelineno-62-9"></a><span class="p">{</span>
<a id="__codelineno-62-10" name="__codelineno-62-10" href="#__codelineno-62-10"></a>    <span class="sd">/**</span>
<a id="__codelineno-62-11" name="__codelineno-62-11" href="#__codelineno-62-11"></a><span class="sd">     * Scope a query to only include popular users.</span>
<a id="__codelineno-62-12" name="__codelineno-62-12" href="#__codelineno-62-12"></a><span class="sd">     */</span>
<a id="__codelineno-62-13" name="__codelineno-62-13" href="#__codelineno-62-13"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">scopePopular</span><span class="p">(</span><span class="nx">Builder</span> <span class="nv">$query</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-62-14" name="__codelineno-62-14" href="#__codelineno-62-14"></a>    <span class="p">{</span>
<a id="__codelineno-62-15" name="__codelineno-62-15" href="#__codelineno-62-15"></a>        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;votes&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<a id="__codelineno-62-16" name="__codelineno-62-16" href="#__codelineno-62-16"></a>    <span class="p">}</span>
<a id="__codelineno-62-17" name="__codelineno-62-17" href="#__codelineno-62-17"></a>
<a id="__codelineno-62-18" name="__codelineno-62-18" href="#__codelineno-62-18"></a>    <span class="sd">/**</span>
<a id="__codelineno-62-19" name="__codelineno-62-19" href="#__codelineno-62-19"></a><span class="sd">     * Scope a query to only include active users.</span>
<a id="__codelineno-62-20" name="__codelineno-62-20" href="#__codelineno-62-20"></a><span class="sd">     */</span>
<a id="__codelineno-62-21" name="__codelineno-62-21" href="#__codelineno-62-21"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">scopeActive</span><span class="p">(</span><span class="nx">Builder</span> <span class="nv">$query</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-62-22" name="__codelineno-62-22" href="#__codelineno-62-22"></a>    <span class="p">{</span>
<a id="__codelineno-62-23" name="__codelineno-62-23" href="#__codelineno-62-23"></a>        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;active&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-62-24" name="__codelineno-62-24" href="#__codelineno-62-24"></a>    <span class="p">}</span>
<a id="__codelineno-62-25" name="__codelineno-62-25" href="#__codelineno-62-25"></a><span class="p">}</span>
</code></pre></div>
<p><a name="utilizing-a-local-scope"></a></p>
<h4 id="_53">ローカルスコープの利用<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h4>
<p>スコープが定義されたら、モデルをクエリするときにスコープメソッドを呼び出すことができます。ただし、メソッドを呼び出すときに<code>scope</code>プレフィックスを含めるべきではありません。さまざまなスコープへの呼び出しを連鎖させることもできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a><span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">popular</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">active</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">orderBy</span><span class="p">(</span><span class="s1">&#39;created_at&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p>複数のEloquentモデルスコープを<code>or</code>クエリ演算子で組み合わせるには、正しい<a href="queries.html#logical-grouping">論理グループ化</a>を実現するためにクロージャを使用する必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">popular</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">orWhere</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Builder</span> <span class="nv">$query</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a>    <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">active</span><span class="p">();</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p>ただし、これは面倒な場合があるため、Laravelはクロージャを使用せずにスコープを流暢に連鎖させることができる「高次」の<code>orWhere</code>メソッドを提供します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">popular</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">orWhere</span><span class="o">-&gt;</span><span class="na">active</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p><a name="dynamic-scopes"></a></p>
<h4 id="_54">動的スコープ<a class="headerlink" href="#_54" title="Permanent link">&para;</a></h4>
<p>パラメータを受け取るスコープを定義したい場合があります。まず、スコープメソッドのシグネチャに追加のパラメータを追加します。スコープパラメータは、<code>$query</code>パラメータの後に定義する必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Builder</span><span class="p">;</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<a id="__codelineno-66-9" name="__codelineno-66-9" href="#__codelineno-66-9"></a><span class="p">{</span>
<a id="__codelineno-66-10" name="__codelineno-66-10" href="#__codelineno-66-10"></a>    <span class="sd">/**</span>
<a id="__codelineno-66-11" name="__codelineno-66-11" href="#__codelineno-66-11"></a><span class="sd">     * Scope a query to only include users of a given type.</span>
<a id="__codelineno-66-12" name="__codelineno-66-12" href="#__codelineno-66-12"></a><span class="sd">     */</span>
<a id="__codelineno-66-13" name="__codelineno-66-13" href="#__codelineno-66-13"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">scopeOfType</span><span class="p">(</span><span class="nx">Builder</span> <span class="nv">$query</span><span class="p">,</span> <span class="nx">string</span> <span class="nv">$type</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-66-14" name="__codelineno-66-14" href="#__codelineno-66-14"></a>    <span class="p">{</span>
<a id="__codelineno-66-15" name="__codelineno-66-15" href="#__codelineno-66-15"></a>        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;type&#39;</span><span class="p">,</span> <span class="nv">$type</span><span class="p">);</span>
<a id="__codelineno-66-16" name="__codelineno-66-16" href="#__codelineno-66-16"></a>    <span class="p">}</span>
<a id="__codelineno-66-17" name="__codelineno-66-17" href="#__codelineno-66-17"></a><span class="p">}</span>
</code></pre></div>
<p>スコープメソッドのシグネチャに期待される引数を追加したら、スコープを呼び出すときに引数を渡すことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="nv">$users</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">ofType</span><span class="p">(</span><span class="s1">&#39;admin&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">();</span>
</code></pre></div>
<p><a name="comparing-models"></a></p>
<h2 id="_55">モデルの比較<a class="headerlink" href="#_55" title="Permanent link">&para;</a></h2>
<p>時には、2つのモデルが「同じ」かどうかを判断する必要があるかもしれません。<code>is</code>メソッドと<code>isNot</code>メソッドを使用して、2つのモデルが同じ主キー、テーブル、およびデータベース接続を持っているかどうかを迅速に確認できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="nv">$anotherPost</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a>    <span class="c1">// ...</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a><span class="p">}</span>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">isNot</span><span class="p">(</span><span class="nv">$anotherPost</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a>    <span class="c1">// ...</span>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="p">}</span>
</code></pre></div>
<p><code>is</code>メソッドと<code>isNot</code>メソッドは、<code>belongsTo</code>、<code>hasOne</code>、<code>morphTo</code>、および<code>morphOne</code><a href="eloquent-relationships.html">リレーション</a>を使用する場合にも利用できます。このメソッドは、関連モデルを取得するクエリを発行せずに関連モデルを比較する場合に特に便利です。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="k">if</span> <span class="p">(</span><span class="nv">$post</span><span class="o">-&gt;</span><span class="na">author</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">is</span><span class="p">(</span><span class="nv">$user</span><span class="p">))</span> <span class="p">{</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a>    <span class="c1">// ...</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a><span class="p">}</span>
</code></pre></div>
<p><a name="events"></a></p>
<h2 id="_56">イベント<a class="headerlink" href="#_56" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Eloquentイベントをクライアントサイドアプリケーションに直接ブロードキャストしたいですか？Laravelの<a href="broadcasting.html#model-broadcasting">モデルイベントブロードキャスト</a>をチェックしてください。</p>
</div>
<p>Eloquentモデルは、いくつかのイベントをディスパッチします。これにより、モデルのライフサイクルの次のポイントにフックすることができます：<code>retrieved</code>、<code>creating</code>、<code>created</code>、<code>updating</code>、<code>updated</code>、<code>saving</code>、<code>saved</code>、<code>deleting</code>、<code>deleted</code>、<code>trashed</code>、<code>forceDeleting</code>、<code>forceDeleted</code>、<code>restoring</code>、<code>restored</code>、および<code>replicating</code>。</p>
<p><code>retrieved</code> イベントは、既存のモデルがデータベースから取得されたときにディスパッチされます。新しいモデルが初めて保存されるときは、<code>creating</code> と <code>created</code> イベントがディスパッチされます。既存のモデルが変更され、<code>save</code> メソッドが呼び出されると、<code>updating</code> / <code>updated</code> イベントがディスパッチされます。モデルが作成または更新されるときには <code>saving</code> / <code>saved</code> イベントがディスパッチされます - モデルの属性が変更されていない場合でも同様です。<code>-ing</code> で終わるイベント名は、モデルへの変更が永続化される前にディスパッチされ、<code>-ed</code> で終わるイベント名は、モデルへの変更が永続化された後にディスパッチされます。</p>
<p>モデルイベントのリスニングを開始するには、Eloquentモデルに <code>$dispatchesEvents</code> プロパティを定義します。このプロパティは、Eloquentモデルのライフサイクルの様々なポイントを独自の <a href="events.html">イベントクラス</a> にマッピングします。各モデルイベントクラスは、コンストラクタを介して影響を受けるモデルのインスタンスを受け取ることが期待されます。</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Events\UserDeleted</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Events\UserSaved</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">Notifiable</span><span class="p">;</span>

    <span class="sd">/**</span>
<span class="sd">     * モデルのイベントマップ</span>
<span class="sd">     *</span>
<span class="sd">     * @var array&lt;string, string&gt;</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="nv">$dispatchesEvents</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;saved&#39;</span> <span class="o">=&gt;</span> <span class="nx">UserSaved</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;deleted&#39;</span> <span class="o">=&gt;</span> <span class="nx">UserDeleted</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<p>Eloquentイベントを定義してマッピングした後、<a href="events.html#defining-listeners">イベントリスナー</a> を使用してイベントを処理できます。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Eloquentを介してマスアップデートまたはマス削除クエリを発行する場合、影響を受けるモデルに対して <code>saved</code>、<code>updated</code>、<code>deleting</code>、<code>deleted</code> モデルイベントはディスパッチされません。これは、マスアップデートまたはマス削除を実行する際にモデルが実際に取得されないためです。</p>
</div>
<p><a name="events-using-closures"></a></p>
<h3 id="_57">クロージャの使用<a class="headerlink" href="#_57" title="Permanent link">&para;</a></h3>
<p>カスタムイベントクラスを使用する代わりに、様々なモデルイベントがディスパッチされたときに実行されるクロージャを登録できます。通常、これらのクロージャはモデルの <code>booted</code> メソッドに登録する必要があります。</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * モデルの &quot;booted&quot; メソッド</span>
<span class="sd">     */</span>
    <span class="k">protected</span> <span class="k">static</span> <span class="k">function</span> <span class="nf">booted</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="k">static</span><span class="o">::</span><span class="na">created</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// ...</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>必要に応じて、モデルイベントを登録する際に <a href="events.html#queuable-anonymous-event-listeners">キュー可能な匿名イベントリスナー</a> を利用できます。これにより、Laravelはアプリケーションの <a href="queues.html">キュー</a> を使用してバックグラウンドでモデルイベントリスナーを実行するよう指示されます。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="k">function</span> <span class="nf">Illuminate\Events\queueable</span><span class="p">;</span>

<span class="k">static</span><span class="o">::</span><span class="na">created</span><span class="p">(</span><span class="nx">queueable</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}));</span>
</code></pre></div>
<p><a name="observers"></a></p>
<h3 id="_58">オブザーバー<a class="headerlink" href="#_58" title="Permanent link">&para;</a></h3>
<p><a name="defining-observers"></a></p>
<h4 id="_59">オブザーバーの定義<a class="headerlink" href="#_59" title="Permanent link">&para;</a></h4>
<p>特定のモデルで多くのイベントをリスニングしている場合、オブザーバーを使用してすべてのリスナーを1つのクラスにグループ化できます。オブザーバークラスのメソッド名は、リスニングしたいEloquentイベントを反映します。これらの各メソッドは、影響を受けるモデルを唯一の引数として受け取ります。<code>make:observer</code> Artisanコマンドは、新しいオブザーバークラスを作成する最も簡単な方法です。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>make:observer<span class="w"> </span>UserObserver<span class="w"> </span>--model<span class="o">=</span>User
</code></pre></div>
<p>このコマンドは、新しいオブザーバーを <code>app/Observers</code> ディレクトリに配置します。このディレクトリが存在しない場合、Artisanが自動的に作成します。新しいオブザーバーは次のようになります。</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Observers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserObserver</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * User &quot;created&quot; イベントの処理</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">created</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * User &quot;updated&quot; イベントの処理</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">updated</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * User &quot;deleted&quot; イベントの処理</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">deleted</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * User &quot;restored&quot; イベントの処理</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">restored</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * User &quot;forceDeleted&quot; イベントの処理</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">forceDeleted</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>オブザーバーを登録するには、対応するモデルに <code>ObservedBy</code> 属性を配置することができます。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Observers\UserObserver</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Attributes\ObservedBy</span><span class="p">;</span>

<span class="p">#[</span><span class="nd">ObservedBy</span><span class="p">([</span><span class="nx">UserObserver</span><span class="o">::</span><span class="na">class</span><span class="p">])]</span>
<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="c1">//</span>
<span class="p">}</span>
</code></pre></div>
<p>または、観察したいモデルで <code>observe</code> メソッドを呼び出して手動でオブザーバーを登録することもできます。アプリケーションの <code>AppServiceProvider</code> クラスの <code>boot</code> メソッドでオブザーバーを登録できます。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Observers\UserObserver</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * アプリケーションサービスのブートストラップ</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">User</span><span class="o">::</span><span class="na">observe</span><span class="p">(</span><span class="nx">UserObserver</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>オブザーバーは <code>saving</code> や <code>retrieved</code> などの追加のイベントをリスニングできます。これらのイベントは <a href="#events">イベント</a> ドキュメント内で説明されています。</p>
</div>
<p><a name="observers-and-database-transactions"></a></p>
<h4 id="_60">オブザーバーとデータベーストランザクション<a class="headerlink" href="#_60" title="Permanent link">&para;</a></h4>
<p>モデルがデータベーストランザクション内で作成されている場合、データベーストランザクションがコミットされた後にのみオブザーバーのイベントハンドラを実行するよう指示したい場合があります。これを実現するには、オブザーバーに <code>ShouldHandleEventsAfterCommit</code> インターフェースを実装します。データベーストランザクションが進行中でない場合、イベントハンドラはすぐに実行されます。</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Observers</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Contracts\Events\ShouldHandleEventsAfterCommit</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">UserObserver</span> <span class="k">implements</span> <span class="nx">ShouldHandleEventsAfterCommit</span>
<span class="p">{</span>
    <span class="sd">/**</span>
<span class="sd">     * User &quot;created&quot; イベントの処理</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">created</span><span class="p">(</span><span class="nx">User</span> <span class="nv">$user</span><span class="p">)</span><span class="o">:</span> <span class="nx">void</span>
    <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="muting-events"></a></p>
<h3 id="_61">イベントのミュート<a class="headerlink" href="#_61" title="Permanent link">&para;</a></h3>
<p>モデルによって発生するすべてのイベントを一時的に「ミュート」する必要がある場合があります。これは <code>withoutEvents</code> メソッドを使用して実現できます。<code>withoutEvents</code> メソッドは、唯一の引数としてクロージャを受け取ります。このクロージャ内で実行されるコードはモデルイベントをディスパッチせず、クロージャによって返される値は <code>withoutEvents</code> メソッドによって返されます。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>

<span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">withoutEvents</span><span class="p">(</span><span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">delete</span><span class="p">();</span>

    <span class="k">return</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p><a name="saving-a-single-model-without-events"></a></p>
<h4 id="_62">イベントなしで単一のモデルを保存<a class="headerlink" href="#_62" title="Permanent link">&para;</a></h4>
<p>イベントをディスパッチせずに特定のモデルを「保存」したい場合があります。これは <code>saveQuietly</code> メソッドを使用して実現できます。</p>
<div class="highlight"><pre><span></span><code><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">findOrFail</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">name</span> <span class="o">=</span> <span class="s1">&#39;Victoria Faith&#39;</span><span class="p">;</span>

<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">saveQuietly</span><span class="p">();</span>
</code></pre></div>
<p>また、イベントをディスパッチせずに特定のモデルを「更新」、「削除」、「ソフト削除」、「復元」、「複製」することもできます。</p>
<div class="highlight"><pre><span></span><code><span class="nv">$user</span><span class="o">-&gt;</span><span class="na">deleteQuietly</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">forceDeleteQuietly</span><span class="p">();</span>
<span class="nv">$user</span><span class="o">-&gt;</span><span class="na">restoreQuietly</span><span class="p">();</span>
</code></pre></div>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
<nav class="md-footer-nav">
    
    
</nav>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["back-to-top", "navigation.expand", "navigation.tabs", "navigation.footer", "navigation.sections", "navigation.expand", "content.code.copy", "hide_repository_button", "content.code.annotate", "content.tabs.link", "toc.none", "content.action.edit"], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>