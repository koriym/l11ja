
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://github.com/koriym/laravel11-ja/passport.html">
      
      
        <link rel="prev" href="octane.html">
      
      
        <link rel="next" href="pennant.html">
      
      
      <link rel="icon" href="assets/images/favicon_io/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.35">
    
    
      
        <title>Passport - L11JA</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.35f28582.min.css">
      
      


    
    

    

    
      <link rel="stylesheet" href="assets/css/php.css">
    
      <link rel="stylesheet" href="assets/css/mkdocs_material_extra.css">
    
      <link rel="stylesheet" href="assets/css/extra.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-G60CEHXLQ1"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-G60CEHXLQ1",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-G60CEHXLQ1",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    

  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#laravel-passport" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!-- Determine classes -->



<!-- Header -->
<header class="md-header" data-md-component="header">
  <nav
          class="md-header__inner md-grid"
          aria-label="Header"
  >

    <!-- Link to home -->
    <a
            href="."
            title="L11JA"
            class="md-header__button md-logo"
            aria-label="L11JA"
            data-md-component="logo"
    >
      
  <img src="assets/images/logo.png" alt="logo">

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            <span style="font-family: 'Noto Sans'; font-size: 20px" >
            L11JA
            </span>
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            <span style="font-family: 'Noto Sans Batak'; font-size: 20px" >
            
              Passport
            
            </span>
          </span>
        </div>
      </div>
    </div>

    <!-- Color palette toggle -->
    

    <!-- User preference: color palette -->
    
    <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
    <label class="md-header__button md-icon" for="__search">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
    </label>

    <!-- Search interface -->
    <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    

    <!-- Repository information -->
    
    <div class="md-header__source">
      

<!--
  Check whether the repository is hosted on one of the supported code hosting
  platforms (GitHub, GitLab or Bitbucket) to show icon.
-->


  


<!-- Repository containing source -->
<a href="https://github.com/koriym/l11ja" title="source.link.title"
    class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg width="24" height="24" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" fill="#000"/></svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="releases.html" class="md-tabs__link">
          
  
  プロローグ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="installation.html" class="md-tabs__link">
          
  
  はじめに

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="lifecycle.html" class="md-tabs__link">
          
  
  アーキテクチャ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="routing.html" class="md-tabs__link">
          
  
  基本

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="artisan.html" class="md-tabs__link">
          
  
  掘り下げる

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="authentication.html" class="md-tabs__link">
          
  
  セキュリティ

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="database.html" class="md-tabs__link">
          
  
  データベース

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="eloquent.html" class="md-tabs__link">
          
  
  Eloquent ORM

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="testing.html" class="md-tabs__link">
          
  
  テスト

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="starter-kits.html" class="md-tabs__link">
          
  
  パッケージ

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="L11JA" class="md-nav__button md-logo" aria-label="L11JA" data-md-component="logo">
      
  <img src="assets/images/logo.png" alt="logo">

    </a>
    L11JA
  </label>
  
    <div class="md-nav__source">
      

<!--
  Check whether the repository is hosted on one of the supported code hosting
  platforms (GitHub, GitLab or Bitbucket) to show icon.
-->


  


<!-- Repository containing source -->
<a href="https://github.com/koriym/l11ja" title="source.link.title"
    class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg width="24" height="24" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8C0 11.54 2.29 14.53 5.47 15.59C5.87 15.66 6.02 15.42 6.02 15.21C6.02 15.02 6.01 14.39 6.01 13.72C4 14.09 3.48 13.23 3.32 12.78C3.23 12.55 2.84 11.84 2.5 11.65C2.22 11.5 1.82 11.13 2.49 11.12C3.12 11.11 3.57 11.7 3.72 11.94C4.44 13.15 5.59 12.81 6.05 12.6C6.12 12.08 6.33 11.73 6.56 11.53C4.78 11.33 2.92 10.64 2.92 7.58C2.92 6.71 3.23 5.99 3.74 5.43C3.66 5.23 3.38 4.41 3.82 3.31C3.82 3.31 4.49 3.1 6.02 4.13C6.66 3.95 7.34 3.86 8.02 3.86C8.7 3.86 9.38 3.95 10.02 4.13C11.55 3.09 12.22 3.31 12.22 3.31C12.66 4.41 12.38 5.23 12.3 5.43C12.81 5.99 13.12 6.7 13.12 7.58C13.12 10.65 11.25 11.33 9.47 11.53C9.76 11.78 10.01 12.26 10.01 13.01C10.01 14.08 10 14.94 10 15.21C10 15.42 10.15 15.67 10.55 15.59C13.71 14.53 16 11.53 16 8C16 3.58 12.42 0 8 0Z" fill="#000"/></svg>
    </div>
  
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    プロローグ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            プロローグ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="releases.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リリースノート
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="upgrade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    アップグレードガイド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contributions.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    貢献ガイド
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            はじめに
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="installation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    インストール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="configuration.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    設定
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="structure.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ディレクトリ構造
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="frontend.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    フロントエンド
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="starter-kits.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    スターターキット
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="deployment.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    デプロイ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    アーキテクチャ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            アーキテクチャ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="lifecycle.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リクエストライフサイクル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="container.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    サービスコンテナ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="providers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    サービスプロバイダ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="facades.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファサード
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    基本
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            基本
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="routing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ルーティング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="middleware.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ミドルウェア
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="csrf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    CSRF保護
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="controllers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コントローラ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="requests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リクエスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="responses.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    レスポンス
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="views.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ビュー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="blade.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Bladeテンプレート
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="vite.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    アセットバンドル
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="urls.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    URL生成
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="session.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    セッション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="validation.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    バリデーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="errors.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    エラー処理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="logging.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ログ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    掘り下げる
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            掘り下げる
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="artisan.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artisanコンソール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="broadcasting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブロードキャスティング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cache.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    キャッシュ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="collections.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コレクション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="concurrency.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    並行処理
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="context.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コンテキスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="contracts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コントラクト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="events.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    イベント
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="filesystem.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファイルストレージ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="helpers.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ヘルパー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http-client.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTPクライアント
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="localization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ローカライゼーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mail.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    メール
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="notifications.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    通知
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="packages.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    パッケージ開発
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="processes.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    プロセス
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="queues.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    キュー
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="rate-limiting.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    レート制限
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="strings.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    文字列
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="scheduling.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    タスクスケジューリング
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    セキュリティ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            セキュリティ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="authentication.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認証
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="authorization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    認可
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="verification.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    メール確認
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="encryption.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    暗号化
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="hashing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ハッシュ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="passwords.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    パスワードリセット
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    データベース
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            データベース
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="database.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="queries.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    クエリビルダ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pagination.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ページネーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="migrations.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    マイグレーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="seeding.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    シーディング
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="redis.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Redis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Eloquent ORM
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Eloquent ORM
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-relationships.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    リレーションシップ
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-collections.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コレクション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-mutators.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ミューテータ / キャスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-resources.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APIリソース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-serialization.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    シリアライゼーション
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="eloquent-factories.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ファクトリ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    テスト
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            テスト
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    はじめに
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="http-tests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HTTPテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="console-tests.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    コンソールテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dusk.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブラウザテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="database-testing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    データベース
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mocking.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    モック
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_10" checked>
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="">
            
  
  <span class="md-ellipsis">
    パッケージ
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            パッケージ
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="starter-kits.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    スターターキット
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="billing.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cashier (Stripe)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="cashier-paddle.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Cashier (Paddle)
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="dusk.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ブラウザテスト
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="envoy.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Envoy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="fortify.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fortify
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="folio.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Folio
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="homestead.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Homestead
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="horizon.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Horizon
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="mix.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mix
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="octane.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Octane
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Passport
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="passport.html" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Passport
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
    <nav class="md-nav" aria-label="はじめに">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passport-sanctum" class="md-nav__link">
    <span class="md-ellipsis">
      Passport か Sanctum か？
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      インストール
    </span>
  </a>
  
    <nav class="md-nav" aria-label="インストール">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passport" class="md-nav__link">
    <span class="md-ellipsis">
      Passport のデプロイ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Passport のデプロイ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      環境からのキーのロード
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passport_1" class="md-nav__link">
    <span class="md-ellipsis">
      Passport のアップグレード
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      設定
    </span>
  </a>
  
    <nav class="md-nav" aria-label="設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントシークレットのハッシュ化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      トークンの有効期限
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      デフォルトモデルのオーバーライド
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      ルートのオーバーライド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      アクセストークンの発行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="アクセストークンの発行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントの管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クライアントの管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passportclient" class="md-nav__link">
    <span class="md-ellipsis">
      passport:clientコマンド
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-api" class="md-nav__link">
    <span class="md-ellipsis">
      JSON API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-oauthclients" class="md-nav__link">
    <span class="md-ellipsis">
      GET /oauth/clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-oauthclients" class="md-nav__link">
    <span class="md-ellipsis">
      POST /oauth/clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-oauthclientsclient-id" class="md-nav__link">
    <span class="md-ellipsis">
      PUT /oauth/clients/{client-id}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-oauthclientsclient-id" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /oauth/clients/{client-id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのリクエスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トークンのリクエスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      認証のためのリダイレクト
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      リクエストの承認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      認証コードをアクセストークンに変換
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-api_1" class="md-nav__link">
    <span class="md-ellipsis">
      JSON API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-oauthtokens" class="md-nav__link">
    <span class="md-ellipsis">
      GET /oauth/tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-oauthtokenstoken-id" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /oauth/tokens/{token-id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのリフレッシュ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      トークンの取り消し
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのパージ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pkce" class="md-nav__link">
    <span class="md-ellipsis">
      PKCE を使用した認証コード付与
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PKCE を使用した認証コード付与">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのリクエスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トークンのリクエスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      コード検証子とコードチャレンジ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      認証のためのリダイレクト
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      認証コードをアクセストークンに変換する
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      パスワード付与トークン
    </span>
  </a>
  
    <nav class="md-nav" aria-label="パスワード付与トークン">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      パスワード付与クライアントの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのリクエスト
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      すべてのスコープのリクエスト
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザープロバイダのカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザー名フィールドのカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      パスワード検証のカスタマイズ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      暗黙的グラントトークン
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントクレデンシャルグラントトークン
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クライアントクレデンシャルグラントトークン">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      トークンの取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      パーソナルアクセストークン
    </span>
  </a>
  
    <nav class="md-nav" aria-label="パーソナルアクセストークン">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      パーソナルアクセスクライアントの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      パーソナルアクセストークンの管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="パーソナルアクセストークンの管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-api_2" class="md-nav__link">
    <span class="md-ellipsis">
      JSON API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-oauthscopes" class="md-nav__link">
    <span class="md-ellipsis">
      GET /oauth/scopes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-oauthpersonal-access-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      GET /oauth/personal-access-tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-oauthpersonal-access-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      POST /oauth/personal-access-tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-oauthpersonal-access-tokenstoken-id" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /oauth/personal-access-tokens/{token-id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      ルートの保護
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ルートの保護">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      ミドルウェア経由
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ミドルウェア経由">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      複数の認証ガード
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      アクセストークンの渡し方
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      トークンスコープ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トークンスコープ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      スコープの定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      デフォルトスコープ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      トークンへのスコープの割り当て
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トークンへのスコープの割り当て">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      認証コードをリクエストする際
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      パーソナルアクセストークンを発行する際
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      スコープの確認
    </span>
  </a>
  
    <nav class="md-nav" aria-label="スコープの確認">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      すべてのスコープの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      いずれかのスコープの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      トークンインスタンスでのスコープの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      追加のスコープメソッド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#javascriptapi" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScriptでのAPIの利用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JavaScriptでのAPIの利用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      クッキー名のカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csrf" class="md-nav__link">
    <span class="md-ellipsis">
      CSRF保護
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      イベント
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      テスト
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pennant.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pennant
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pint.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pint
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="precognition.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Precognition
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="prompts.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Prompts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="pulse.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pulse
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reverb.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reverb
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sail.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sail
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="sanctum.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sanctum
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="scout.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Scout
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="socialite.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Socialite
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="telescope.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Telescope
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="valet.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Valet
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      はじめに
    </span>
  </a>
  
    <nav class="md-nav" aria-label="はじめに">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passport-sanctum" class="md-nav__link">
    <span class="md-ellipsis">
      Passport か Sanctum か？
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      インストール
    </span>
  </a>
  
    <nav class="md-nav" aria-label="インストール">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passport" class="md-nav__link">
    <span class="md-ellipsis">
      Passport のデプロイ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Passport のデプロイ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      環境からのキーのロード
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#passport_1" class="md-nav__link">
    <span class="md-ellipsis">
      Passport のアップグレード
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      設定
    </span>
  </a>
  
    <nav class="md-nav" aria-label="設定">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントシークレットのハッシュ化
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      トークンの有効期限
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    <span class="md-ellipsis">
      デフォルトモデルのオーバーライド
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    <span class="md-ellipsis">
      ルートのオーバーライド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    <span class="md-ellipsis">
      アクセストークンの発行
    </span>
  </a>
  
    <nav class="md-nav" aria-label="アクセストークンの発行">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントの管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クライアントの管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#passportclient" class="md-nav__link">
    <span class="md-ellipsis">
      passport:clientコマンド
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-api" class="md-nav__link">
    <span class="md-ellipsis">
      JSON API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-oauthclients" class="md-nav__link">
    <span class="md-ellipsis">
      GET /oauth/clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-oauthclients" class="md-nav__link">
    <span class="md-ellipsis">
      POST /oauth/clients
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#put-oauthclientsclient-id" class="md-nav__link">
    <span class="md-ellipsis">
      PUT /oauth/clients/{client-id}
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-oauthclientsclient-id" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /oauth/clients/{client-id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのリクエスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トークンのリクエスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    <span class="md-ellipsis">
      認証のためのリダイレクト
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    <span class="md-ellipsis">
      リクエストの承認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    <span class="md-ellipsis">
      認証コードをアクセストークンに変換
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#json-api_1" class="md-nav__link">
    <span class="md-ellipsis">
      JSON API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-oauthtokens" class="md-nav__link">
    <span class="md-ellipsis">
      GET /oauth/tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-oauthtokenstoken-id" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /oauth/tokens/{token-id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_15" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのリフレッシュ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_16" class="md-nav__link">
    <span class="md-ellipsis">
      トークンの取り消し
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_17" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのパージ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pkce" class="md-nav__link">
    <span class="md-ellipsis">
      PKCE を使用した認証コード付与
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PKCE を使用した認証コード付与">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_18" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_19" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのリクエスト
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トークンのリクエスト">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_20" class="md-nav__link">
    <span class="md-ellipsis">
      コード検証子とコードチャレンジ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_21" class="md-nav__link">
    <span class="md-ellipsis">
      認証のためのリダイレクト
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_22" class="md-nav__link">
    <span class="md-ellipsis">
      認証コードをアクセストークンに変換する
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_23" class="md-nav__link">
    <span class="md-ellipsis">
      パスワード付与トークン
    </span>
  </a>
  
    <nav class="md-nav" aria-label="パスワード付与トークン">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_24" class="md-nav__link">
    <span class="md-ellipsis">
      パスワード付与クライアントの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_25" class="md-nav__link">
    <span class="md-ellipsis">
      トークンのリクエスト
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_26" class="md-nav__link">
    <span class="md-ellipsis">
      すべてのスコープのリクエスト
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_27" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザープロバイダのカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_28" class="md-nav__link">
    <span class="md-ellipsis">
      ユーザー名フィールドのカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_29" class="md-nav__link">
    <span class="md-ellipsis">
      パスワード検証のカスタマイズ
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_30" class="md-nav__link">
    <span class="md-ellipsis">
      暗黙的グラントトークン
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_31" class="md-nav__link">
    <span class="md-ellipsis">
      クライアントクレデンシャルグラントトークン
    </span>
  </a>
  
    <nav class="md-nav" aria-label="クライアントクレデンシャルグラントトークン">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_32" class="md-nav__link">
    <span class="md-ellipsis">
      トークンの取得
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_33" class="md-nav__link">
    <span class="md-ellipsis">
      パーソナルアクセストークン
    </span>
  </a>
  
    <nav class="md-nav" aria-label="パーソナルアクセストークン">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_34" class="md-nav__link">
    <span class="md-ellipsis">
      パーソナルアクセスクライアントの作成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_35" class="md-nav__link">
    <span class="md-ellipsis">
      パーソナルアクセストークンの管理
    </span>
  </a>
  
    <nav class="md-nav" aria-label="パーソナルアクセストークンの管理">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#json-api_2" class="md-nav__link">
    <span class="md-ellipsis">
      JSON API
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-oauthscopes" class="md-nav__link">
    <span class="md-ellipsis">
      GET /oauth/scopes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#get-oauthpersonal-access-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      GET /oauth/personal-access-tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#post-oauthpersonal-access-tokens" class="md-nav__link">
    <span class="md-ellipsis">
      POST /oauth/personal-access-tokens
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delete-oauthpersonal-access-tokenstoken-id" class="md-nav__link">
    <span class="md-ellipsis">
      DELETE /oauth/personal-access-tokens/{token-id}
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_36" class="md-nav__link">
    <span class="md-ellipsis">
      ルートの保護
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ルートの保護">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_37" class="md-nav__link">
    <span class="md-ellipsis">
      ミドルウェア経由
    </span>
  </a>
  
    <nav class="md-nav" aria-label="ミドルウェア経由">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_38" class="md-nav__link">
    <span class="md-ellipsis">
      複数の認証ガード
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_39" class="md-nav__link">
    <span class="md-ellipsis">
      アクセストークンの渡し方
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_40" class="md-nav__link">
    <span class="md-ellipsis">
      トークンスコープ
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トークンスコープ">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_41" class="md-nav__link">
    <span class="md-ellipsis">
      スコープの定義
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_42" class="md-nav__link">
    <span class="md-ellipsis">
      デフォルトスコープ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_43" class="md-nav__link">
    <span class="md-ellipsis">
      トークンへのスコープの割り当て
    </span>
  </a>
  
    <nav class="md-nav" aria-label="トークンへのスコープの割り当て">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_44" class="md-nav__link">
    <span class="md-ellipsis">
      認証コードをリクエストする際
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_45" class="md-nav__link">
    <span class="md-ellipsis">
      パーソナルアクセストークンを発行する際
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_46" class="md-nav__link">
    <span class="md-ellipsis">
      スコープの確認
    </span>
  </a>
  
    <nav class="md-nav" aria-label="スコープの確認">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_47" class="md-nav__link">
    <span class="md-ellipsis">
      すべてのスコープの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_48" class="md-nav__link">
    <span class="md-ellipsis">
      いずれかのスコープの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_49" class="md-nav__link">
    <span class="md-ellipsis">
      トークンインスタンスでのスコープの確認
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_50" class="md-nav__link">
    <span class="md-ellipsis">
      追加のスコープメソッド
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#javascriptapi" class="md-nav__link">
    <span class="md-ellipsis">
      JavaScriptでのAPIの利用
    </span>
  </a>
  
    <nav class="md-nav" aria-label="JavaScriptでのAPIの利用">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_51" class="md-nav__link">
    <span class="md-ellipsis">
      クッキー名のカスタマイズ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csrf" class="md-nav__link">
    <span class="md-ellipsis">
      CSRF保護
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_52" class="md-nav__link">
    <span class="md-ellipsis">
      イベント
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_53" class="md-nav__link">
    <span class="md-ellipsis">
      テスト
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
    <a href="https://github.com/koriym/l11ja/edit/ja/passport.md" title="Edit this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  


<h1 id="laravel-passport">Laravel Passport<a class="headerlink" href="#laravel-passport" title="Permanent link">&para;</a></h1>
<ul>
<li><a href="#introduction">はじめに</a><ul>
<li><a href="#passport-or-sanctum">Passport か Sanctum か？</a></li>
</ul>
</li>
<li><a href="#installation">インストール</a><ul>
<li><a href="#deploying-passport">Passport のデプロイ</a></li>
<li><a href="#upgrading-passport">Passport のアップグレード</a></li>
</ul>
</li>
<li><a href="#configuration">設定</a><ul>
<li><a href="#client-secret-hashing">クライアントシークレットのハッシュ化</a></li>
<li><a href="#token-lifetimes">トークンの有効期限</a></li>
<li><a href="#overriding-default-models">デフォルトモデルのオーバーライド</a></li>
<li><a href="#overriding-routes">ルートのオーバーライド</a></li>
</ul>
</li>
<li><a href="#issuing-access-tokens">アクセストークンの発行</a><ul>
<li><a href="#managing-clients">クライアントの管理</a></li>
<li><a href="#requesting-tokens">トークンのリクエスト</a></li>
<li><a href="#refreshing-tokens">トークンのリフレッシュ</a></li>
<li><a href="#revoking-tokens">トークンの取り消し</a></li>
<li><a href="#purging-tokens">トークンのパージ</a></li>
</ul>
</li>
<li><a href="#code-grant-pkce">PKCE を使用した認証コードグラント</a><ul>
<li><a href="#creating-a-auth-pkce-grant-client">クライアントの作成</a></li>
<li><a href="#requesting-auth-pkce-grant-tokens">トークンのリクエスト</a></li>
</ul>
</li>
<li><a href="#password-grant-tokens">パスワードグラントトークン</a><ul>
<li><a href="#creating-a-password-grant-client">パスワードグラントクライアントの作成</a></li>
<li><a href="#requesting-password-grant-tokens">トークンのリクエスト</a></li>
<li><a href="#requesting-all-scopes">すべてのスコープのリクエスト</a></li>
<li><a href="#customizing-the-user-provider">ユーザープロバイダのカスタマイズ</a></li>
<li><a href="#customizing-the-username-field">ユーザー名フィールドのカスタマイズ</a></li>
<li><a href="#customizing-the-password-validation">パスワード検証のカスタマイズ</a></li>
</ul>
</li>
<li><a href="#implicit-grant-tokens">暗黙的グラントトークン</a></li>
<li><a href="#client-credentials-grant-tokens">クライアントクレデンシャルグラントトークン</a></li>
<li><a href="#personal-access-tokens">パーソナルアクセストークン</a><ul>
<li><a href="#creating-a-personal-access-client">パーソナルアクセスクライアントの作成</a></li>
<li><a href="#managing-personal-access-tokens">パーソナルアクセストークンの管理</a></li>
</ul>
</li>
<li><a href="#protecting-routes">ルートの保護</a><ul>
<li><a href="#via-middleware">ミドルウェアによる保護</a></li>
<li><a href="#passing-the-access-token">アクセストークンの渡し方</a></li>
</ul>
</li>
<li><a href="#token-scopes">トークンスコープ</a><ul>
<li><a href="#defining-scopes">スコープの定義</a></li>
<li><a href="#default-scope">デフォルトスコープ</a></li>
<li><a href="#assigning-scopes-to-tokens">トークンへのスコープの割り当て</a></li>
<li><a href="#checking-scopes">スコープのチェック</a></li>
</ul>
</li>
<li><a href="#consuming-your-api-with-javascript">JavaScript での API の利用</a></li>
<li><a href="#events">イベント</a></li>
<li><a href="#testing">テスト</a></li>
</ul>
<p><a name="introduction"></a></p>
<h2 id="_1">はじめに<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/laravel/passport">Laravel Passport</a> は、Laravel アプリケーションに対して数分で完全な OAuth2 サーバー実装を提供します。Passport は、Andy Millington と Simon Hamp によってメンテナンスされている <a href="https://github.com/thephpleague/oauth2-server">League OAuth2 サーバー</a> の上に構築されています。</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>このドキュメントは、あなたがすでに OAuth2 に精通していることを前提としています。OAuth2 について何も知らない場合は、続行する前に OAuth2 の一般的な <a href="https://oauth2.thephpleague.com/terminology/">用語</a> と機能について理解を深めることを検討してください。</p>
</div>
<p><a name="passport-or-sanctum"></a></p>
<h3 id="passport-sanctum">Passport か Sanctum か？<a class="headerlink" href="#passport-sanctum" title="Permanent link">&para;</a></h3>
<p>始める前に、アプリケーションが Laravel Passport と <a href="sanctum.html">Laravel Sanctum</a> のどちらでよりよくサービスを受けられるかを判断することをお勧めします。アプリケーションが絶対に OAuth2 をサポートする必要がある場合は、Laravel Passport を使用する必要があります。</p>
<p>ただし、シングルページアプリケーション、モバイルアプリケーションを認証したり、API トークンを発行したりする場合は、<a href="sanctum.html">Laravel Sanctum</a> を使用する必要があります。Laravel Sanctum は OAuth2 をサポートしていませんが、はるかにシンプルな API 認証開発体験を提供します。</p>
<p><a name="installation"></a></p>
<h2 id="_2">インストール<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Laravel Passport は、<code>install:api</code> Artisan コマンドを介してインストールできます:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>install:api<span class="w"> </span>--passport
</code></pre></div>
<p>このコマンドは、アプリケーションが OAuth2 クライアントとアクセストークンを保存するために必要なテーブルを作成するために必要なデータベースマイグレーションを公開し、実行します。また、セキュアなアクセストークンを生成するために必要な暗号化キーも作成します。</p>
<p>さらに、このコマンドは、Passport の <code>Client</code> モデルの主キー値として UUID を使用するか、自動インクリメント整数を使用するかを尋ねます。</p>
<p><code>install:api</code> コマンドを実行した後、<code>App\Models\User</code> モデルに <code>Laravel\Passport\HasApiTokens</code> トレイトを追加します。このトレイトは、認証済みユーザーのトークンとスコープを検査するためのいくつかのヘルパーメソッドをモデルに提供します:</p>
<div class="highlight"><pre><span></span><code><span class="o">&lt;?</span><span class="nx">php</span>

<span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Factories\HasFactory</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Passport\HasApiTokens</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<span class="p">{</span>
    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">HasFactory</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<p>最後に、アプリケーションの <code>config/auth.php</code> 設定ファイルで、<code>api</code> 認証ガードを定義し、<code>driver</code> オプションを <code>passport</code> に設定する必要があります。これにより、アプリケーションは受信 API リクエストを認証する際に Passport の <code>TokenGuard</code> を使用するように指示されます:</p>
<div class="highlight"><pre><span></span><code><span class="s1">&#39;guards&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;web&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;session&#39;</span><span class="p">,</span>
        <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
    <span class="p">],</span>

    <span class="s1">&#39;api&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
        <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;passport&#39;</span><span class="p">,</span>
        <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
    <span class="p">],</span>
<span class="p">],</span>
</code></pre></div>
<p><a name="deploying-passport"></a></p>
<h3 id="passport">Passport のデプロイ<a class="headerlink" href="#passport" title="Permanent link">&para;</a></h3>
<p>Passport をアプリケーションのサーバーに初めてデプロイする際には、<code>passport:keys</code> コマンドを実行する必要があります。このコマンドは、Passport がアクセストークンを生成するために必要な暗号化キーを生成します。生成されたキーは通常、ソース管理には含まれません:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:keys
</code></pre></div>
<p>必要に応じて、Passport のキーをロードするパスを定義できます。これを行うには、<code>Passport::loadKeysFrom</code> メソッドを使用します。通常、このメソッドはアプリケーションの <code>App\Providers\AppServiceProvider</code> クラスの <code>boot</code> メソッドから呼び出す必要があります:</p>
<div class="highlight"><pre><span></span><code><span class="sd">/**</span>
<span class="sd"> * Bootstrap any application services.</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">loadKeysFrom</span><span class="p">(</span><span class="no">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../secrets/oauth&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="loading-keys-from-the-environment"></a></p>
<h4 id="_3">環境からのキーのロード<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h4>
<p>あるいは、<code>vendor:publish</code> Artisan コマンドを使用して Passport の設定ファイルを公開することもできます:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>vendor:publish<span class="w"> </span>--tag<span class="o">=</span>passport-config
</code></pre></div>
<p>設定ファイルが公開された後、環境変数としてアプリケーションの暗号化キーをロードできます:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="na">PASSPORT_PRIVATE_KEY</span><span class="o">=</span><span class="s">&quot;-----BEGIN RSA PRIVATE KEY-----</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="na">&lt;private key here&gt;</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="na">-----END RSA PRIVATE KEY-----&quot;</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="na">PASSPORT_PUBLIC_KEY</span><span class="o">=</span><span class="s">&quot;-----BEGIN PUBLIC KEY-----</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="na">&lt;public key here&gt;</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="na">-----END PUBLIC KEY-----&quot;</span>
</code></pre></div>
<p><a name="upgrading-passport"></a></p>
<h3 id="passport_1">Passport のアップグレード<a class="headerlink" href="#passport_1" title="Permanent link">&para;</a></h3>
<p>新しいメジャーバージョンの Passport にアップグレードする際には、<a href="https://github.com/laravel/passport/blob/master/UPGRADE.md">アップグレードガイド</a> を注意深く確認することが重要です。</p>
<p><a name="configuration"></a></p>
<h2 id="_4">設定<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p><a name="client-secret-hashing"></a></p>
<h3 id="_5">クライアントシークレットのハッシュ化<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h3>
<p>データベースに保存する際にクライアントのシークレットをハッシュ化したい場合は、<code>App\Providers\AppServiceProvider</code> クラスの <code>boot</code> メソッドで <code>Passport::hashClientSecrets</code> メソッドを呼び出す必要があります:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>

<span class="nx">Passport</span><span class="o">::</span><span class="na">hashClientSecrets</span><span class="p">();</span>
</code></pre></div>
<p>有効にすると、すべてのクライアントシークレットは、作成直後にのみユーザーに表示されるようになります。プレーンテキストのクライアントシークレット値はデータベースに保存されないため、シークレットの値が失われた場合、その値を回復することはできません。</p>
<p><a name="token-lifetimes"></a></p>
<h3 id="_6">トークンの有効期限<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>デフォルトでは、Passport は1年間有効な長期間有効なアクセストークンを発行します。トークンの有効期限を長くまたは短く設定したい場合は、<code>tokensExpireIn</code>、<code>refreshTokensExpireIn</code>、<code>personalAccessTokensExpireIn</code> メソッドを使用できます。これらのメソッドは、アプリケーションの <code>App\Providers\AppServiceProvider</code> クラスの <code>boot</code> メソッドから呼び出す必要があります:</p>
<div class="highlight"><pre><span></span><code><span class="sd">/**</span>
<span class="sd"> * Bootstrap any application services.</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">tokensExpireIn</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addDays</span><span class="p">(</span><span class="mi">15</span><span class="p">));</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">refreshTokensExpireIn</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addDays</span><span class="p">(</span><span class="mi">30</span><span class="p">));</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">personalAccessTokensExpireIn</span><span class="p">(</span><span class="nx">now</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">addMonths</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Passport のデータベーステーブルの <code>expires_at</code> カラムは読み取り専用で、表示目的のみで使用されます。トークンを発行する際、Passport は署名され暗号化されたトークン内に有効期限情報を保存します。トークンを無効にする必要がある場合は、<a href="#revoking-tokens">取り消し</a> を行う必要があります。</p>
</div>
<p><a name="overriding-default-models"></a></p>
<h3 id="_7">デフォルトモデルのオーバーライド<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>Passport が内部で使用するモデルを自由に拡張できます。独自のモデルを定義し、対応する Passport モデルを拡張することで行えます:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Passport\Client</span> <span class="k">as</span> <span class="nx">PassportClient</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Client</span> <span class="k">extends</span> <span class="nx">PassportClient</span>
<span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>モデルを定義した後、<code>Laravel\Passport\Passport</code> クラスを介して Passport にカスタムモデルを使用するように指示できます。通常、これはアプリケーションの <code>App\Providers\AppServiceProvider</code> クラスの <code>boot</code> メソッドで行います:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">App\Models\Passport\AuthCode</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Passport\Client</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Passport\PersonalAccessClient</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Passport\RefreshToken</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">App\Models\Passport\Token</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * Bootstrap any application services.</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">useTokenModel</span><span class="p">(</span><span class="nx">Token</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">useRefreshTokenModel</span><span class="p">(</span><span class="nx">RefreshToken</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">useAuthCodeModel</span><span class="p">(</span><span class="nx">AuthCode</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">useClientModel</span><span class="p">(</span><span class="nx">Client</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">usePersonalAccessClientModel</span><span class="p">(</span><span class="nx">PersonalAccessClient</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="overriding-routes"></a></p>
<h3 id="_8">ルートのオーバーライド<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h3>
<p>Passport によって定義されたルートをカスタマイズしたい場合は、まずアプリケーションの <code>AppServiceProvider</code> の <code>register</code> メソッドに <code>Passport::ignoreRoutes</code> を追加して、Passport によって登録されたルートを無視する必要があります:</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>

<span class="sd">/**</span>
<span class="sd"> * アプリケーションサービスの登録</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">register</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">ignoreRoutes</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>その後、Passportが<a href="https://github.com/laravel/passport/blob/11.x/routes/web.php">そのルートファイル</a>で定義したルートを、アプリケーションの<code>routes/web.php</code>ファイルにコピーし、好みに合わせて修正することができます。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Route</span><span class="o">::</span><span class="na">group</span><span class="p">([</span>
    <span class="s1">&#39;as&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;passport.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;prefix&#39;</span> <span class="o">=&gt;</span> <span class="nx">config</span><span class="p">(</span><span class="s1">&#39;passport.path&#39;</span><span class="p">,</span> <span class="s1">&#39;oauth&#39;</span><span class="p">),</span>
    <span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;\Laravel\Passport\Http\Controllers&#39;</span><span class="p">,</span>
<span class="p">],</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Passportのルート...</span>
<span class="p">});</span>
</code></pre></div>
<p><a name="issuing-access-tokens"></a></p>
<h2 id="_9">アクセストークンの発行<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h2>
<p>OAuth2を介した認証コードの使用は、ほとんどの開発者がOAuth2に精通している方法です。認証コードを使用する場合、クライアントアプリケーションはユーザーをサーバーにリダイレクトし、ユーザーはクライアントにアクセストークンを発行するリクエストを承認または拒否します。</p>
<p><a name="managing-clients"></a></p>
<h3 id="_10">クライアントの管理<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>まず、アプリケーションのAPIと対話する必要があるアプリケーションを構築する開発者は、アプリケーションに登録する必要があります。これには通常、アプリケーションの名前と、ユーザーが認証リクエストを承認した後にリダイレクトされるURLを提供することが含まれます。</p>
<p><a name="the-passportclient-command"></a></p>
<h4 id="passportclient"><code>passport:client</code>コマンド<a class="headerlink" href="#passportclient" title="Permanent link">&para;</a></h4>
<p>クライアントを作成する最も簡単な方法は、<code>passport:client</code> Artisanコマンドを使用することです。このコマンドは、OAuth2機能をテストするために独自のクライアントを作成するために使用できます。<code>client</code>コマンドを実行すると、Passportはクライアントに関する詳細情報を求め、クライアントIDとシークレットを提供します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:client
</code></pre></div>
<p><strong>リダイレクトURL</strong></p>
<p>クライアントに複数のリダイレクトURLを許可したい場合は、<code>passport:client</code>コマンドでURLを求められたときにカンマ区切りのリストを指定できます。カンマを含むURLはURLエンコードする必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>http://example.com/callback,http://examplefoo.com/callback
</code></pre></div>
<p><a name="clients-json-api"></a></p>
<h4 id="json-api">JSON API<a class="headerlink" href="#json-api" title="Permanent link">&para;</a></h4>
<p>アプリケーションのユーザーは<code>client</code>コマンドを利用できないため、Passportはクライアントを作成するためのJSON APIを提供します。これにより、クライアントの作成、更新、削除のためのコントローラを手動でコーディングする手間が省けます。</p>
<p>ただし、PassportのJSON APIを独自のフロントエンドと組み合わせて、ユーザーがクライアントを管理できるダッシュボードを提供する必要があります。以下では、クライアントを管理するためのすべてのAPIエンドポイントを確認します。便宜上、エンドポイントへのHTTPリクエストを作成するために<a href="https://github.com/axios/axios">Axios</a>を使用します。</p>
<p>JSON APIは<code>web</code>と<code>auth</code>ミドルウェアによって保護されています。したがって、独自のアプリケーションからのみ呼び出すことができます。外部ソースから呼び出すことはできません。</p>
<p><a name="get-oauthclients"></a></p>
<h4 id="get-oauthclients"><code>GET /oauth/clients</code><a class="headerlink" href="#get-oauthclients" title="Permanent link">&para;</a></h4>
<p>このルートは、認証されたユーザーのすべてのクライアントを返します。これは主に、ユーザーがクライアントを編集または削除できるように、ユーザーのすべてのクライアントをリストアップするために役立ちます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/oauth/clients&#39;</span><span class="p">)</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="post-oauthclients"></a></p>
<h4 id="post-oauthclients"><code>POST /oauth/clients</code><a class="headerlink" href="#post-oauthclients" title="Permanent link">&para;</a></h4>
<p>このルートは新しいクライアントを作成するために使用されます。これには、クライアントの<code>name</code>と<code>redirect</code> URLの2つのデータが必要です。<code>redirect</code> URLは、ユーザーが認証リクエストを承認または拒否した後にリダイレクトされる場所です。</p>
<p>クライアントが作成されると、クライアントIDとクライアントシークレットが発行されます。これらの値は、アプリケーションからアクセストークンをリクエストする際に使用されます。クライアント作成ルートは、新しいクライアントインスタンスを返します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Client Name&#39;</span><span class="p">,</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="nx">redirect</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;http://example.com/callback&#39;</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="p">};</span>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/oauth/clients&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a><span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">        </span><span class="c1">// レスポンスのエラーをリストアップ...</span>
<a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="put-oauthclientsclient-id"></a></p>
<h4 id="put-oauthclientsclient-id"><code>PUT /oauth/clients/{client-id}</code><a class="headerlink" href="#put-oauthclientsclient-id" title="Permanent link">&para;</a></h4>
<p>このルートはクライアントを更新するために使用されます。これには、クライアントの<code>name</code>と<code>redirect</code> URLの2つのデータが必要です。<code>redirect</code> URLは、ユーザーが認証リクエストを承認または拒否した後にリダイレクトされる場所です。ルートは更新されたクライアントインスタンスを返します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;New Client Name&#39;</span><span class="p">,</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="nx">redirect</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;http://example.com/callback&#39;</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="p">};</span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="nx">axios</span><span class="p">.</span><span class="nx">put</span><span class="p">(</span><span class="s1">&#39;/oauth/clients/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">clientId</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">        </span><span class="c1">// レスポンスのエラーをリストアップ...</span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="delete-oauthclientsclient-id"></a></p>
<h4 id="delete-oauthclientsclient-id"><code>DELETE /oauth/clients/{client-id}</code><a class="headerlink" href="#delete-oauthclientsclient-id" title="Permanent link">&para;</a></h4>
<p>このルートはクライアントを削除するために使用されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nx">axios</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/oauth/clients/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">clientId</span><span class="p">)</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">        </span><span class="c1">// ...</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="requesting-tokens"></a></p>
<h3 id="_11">トークンのリクエスト<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h3>
<p><a name="requesting-tokens-redirecting-for-authorization"></a></p>
<h4 id="_12">認証のためのリダイレクト<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>クライアントが作成されると、開発者はクライアントIDとシークレットを使用して、アプリケーションから認証コードとアクセストークンをリクエストできます。まず、消費アプリケーションは次のようにアプリケーションの<code>/oauth/authorize</code>ルートにリダイレクトリクエストを行う必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="k">use</span> <span class="nx">Illuminate\Support\Str</span><span class="p">;</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>
<a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nv">$state</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">40</span><span class="p">));</span>
<a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a>
<a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a>    <span class="nv">$query</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">([</span>
<a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a>        <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
<a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a>        <span class="s1">&#39;redirect_uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://third-party-app.com/callback&#39;</span><span class="p">,</span>
<a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a>        <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
<a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a>        <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a>        <span class="s1">&#39;state&#39;</span> <span class="o">=&gt;</span> <span class="nv">$state</span><span class="p">,</span>
<a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>        <span class="c1">// &#39;prompt&#39; =&gt; &#39;&#39;, // &quot;none&quot;, &quot;consent&quot;, or &quot;login&quot;</span>
<a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a>    <span class="p">]);</span>
<a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a>
<a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/authorize?&#39;</span><span class="o">.</span><span class="nv">$query</span><span class="p">);</span>
<a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="p">});</span>
</code></pre></div>
<p><code>prompt</code>パラメータは、Passportアプリケーションの認証動作を指定するために使用できます。</p>
<p><code>prompt</code>の値が<code>none</code>の場合、PassportはユーザーがPassportアプリケーションでまだ認証されていない場合、常に認証エラーをスローします。値が<code>consent</code>の場合、Passportは、すべてのスコープが以前に消費アプリケーションに付与されていたとしても、常に認証承認画面を表示します。値が<code>login</code>の場合、Passportアプリケーションは、ユーザーが既にセッションを持っている場合でも、常にユーザーにアプリケーションへの再ログインを促します。</p>
<p><code>prompt</code>の値が提供されていない場合、ユーザーは、以前に消費アプリケーションへのアクセスを要求されたスコープに対して承認されていない場合にのみ、承認を求められます。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>/oauth/authorize</code>ルートはPassportによって既に定義されていることに注意してください。このルートを手動で定義する必要はありません。</p>
</div>
<p><a name="approving-the-request"></a></p>
<h4 id="_13">リクエストの承認<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h4>
<p>認証リクエストを受け取ると、Passportは<code>prompt</code>パラメータの値（存在する場合）に基づいて自動的に応答し、ユーザーが認証リクエストを承認または拒否できるテンプレートを表示する場合があります。リクエストが承認された場合、ユーザーは消費アプリケーションによって指定された<code>redirect_uri</code>にリダイレクトされます。<code>redirect_uri</code>は、クライアントが作成されたときに指定された<code>redirect</code> URLと一致する必要があります。</p>
<p>認証承認画面をカスタマイズしたい場合は、<code>vendor:publish</code> Artisanコマンドを使用してPassportのビューを公開できます。公開されたビューは<code>resources/views/vendor/passport</code>ディレクトリに配置されます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>vendor:publish<span class="w"> </span>--tag<span class="o">=</span>passport-views
</code></pre></div>
<p>認証プロンプトをスキップしたい場合があります。たとえば、ファーストパーティクライアントを承認する場合です。これは、<a href="#overriding-default-models"><code>Client</code>モデルを拡張</a>し、<code>skipsAuthorization</code>メソッドを定義することで実現できます。<code>skipsAuthorization</code>が<code>true</code>を返す場合、クライアントは承認され、ユーザーは<code>redirect_uri</code>に即座にリダイレクトされます。ただし、消費アプリケーションが認証リダイレクト時に<code>prompt</code>パラメータを明示的に設定していない場合に限ります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="k">namespace</span> <span class="nx">App\Models\Passport</span><span class="p">;</span>
<a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>
<a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="k">use</span> <span class="nx">Laravel\Passport\Client</span> <span class="k">as</span> <span class="nx">BaseClient</span><span class="p">;</span>
<a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a>
<a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="k">class</span> <span class="nc">Client</span> <span class="k">extends</span> <span class="nx">BaseClient</span>
<a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="p">{</span>
<a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a>    <span class="sd">/**</span>
<a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="sd">     * クライアントが認証プロンプトをスキップするかどうかを判断します。</span>
<a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="sd">     */</span>
<a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">skipsAuthorization</span><span class="p">()</span><span class="o">:</span> <span class="nx">bool</span>
<a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>    <span class="p">{</span>
<a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">firstParty</span><span class="p">();</span>
<a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a>    <span class="p">}</span>
<a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="p">}</span>
</code></pre></div>
<p><a name="requesting-tokens-converting-authorization-codes-to-access-tokens"></a></p>
<h4 id="_14">認証コードをアクセストークンに変換<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h4>
<p>ユーザーが認証リクエストを承認した場合、ユーザーは消費アプリケーションにリダイレクトされます。消費者は最初に<code>state</code>パラメータをリダイレクト前に保存した値と照合する必要があります。<code>state</code>パラメータが一致する場合、消費者はアプリケーションに<code>POST</code>リクエストを発行してアクセストークンをリクエストする必要があります。リクエストには、ユーザーが認証リクエストを承認したときにアプリケーションによって発行された認証コードを含める必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Http</span><span class="p">;</span>
<a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
<a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/callback&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>    <span class="nv">$state</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pull</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">);</span>
<a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a>
<a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a>    <span class="nx">throw_unless</span><span class="p">(</span>
<a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a>        <span class="nb">strlen</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$state</span> <span class="o">===</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">state</span><span class="p">,</span>
<a id="__codelineno-13-9" name="__codelineno-13-9" href="#__codelineno-13-9"></a>        <span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
<a id="__codelineno-13-10" name="__codelineno-13-10" href="#__codelineno-13-10"></a>        <span class="s1">&#39;Invalid state value.&#39;</span>
<a id="__codelineno-13-11" name="__codelineno-13-11" href="#__codelineno-13-11"></a>    <span class="p">);</span>
<a id="__codelineno-13-12" name="__codelineno-13-12" href="#__codelineno-13-12"></a>
<a id="__codelineno-13-13" name="__codelineno-13-13" href="#__codelineno-13-13"></a>    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="na">asForm</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
<a id="__codelineno-13-14" name="__codelineno-13-14" href="#__codelineno-13-14"></a>        <span class="s1">&#39;grant_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;authorization_code&#39;</span><span class="p">,</span>
<a id="__codelineno-13-15" name="__codelineno-13-15" href="#__codelineno-13-15"></a>        <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
<a id="__codelineno-13-16" name="__codelineno-13-16" href="#__codelineno-13-16"></a>        <span class="s1">&#39;client_secret&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
<a id="__codelineno-13-17" name="__codelineno-13-17" href="#__codelineno-13-17"></a>        <span class="s1">&#39;redirect_uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://third-party-app.com/callback&#39;</span><span class="p">,</span>
<a id="__codelineno-13-18" name="__codelineno-13-18" href="#__codelineno-13-18"></a>        <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">,</span>
<a id="__codelineno-13-19" name="__codelineno-13-19" href="#__codelineno-13-19"></a>    <span class="p">]);</span>
<a id="__codelineno-13-20" name="__codelineno-13-20" href="#__codelineno-13-20"></a>
<a id="__codelineno-13-21" name="__codelineno-13-21" href="#__codelineno-13-21"></a>    <span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">();</span>
<a id="__codelineno-13-22" name="__codelineno-13-22" href="#__codelineno-13-22"></a><span class="p">});</span>
</code></pre></div>
<p>この <code>/oauth/token</code> ルートは、<code>access_token</code>、<code>refresh_token</code>、および <code>expires_in</code> 属性を含む JSON レスポンスを返します。<code>expires_in</code> 属性には、アクセストークンの有効期限が切れるまでの秒数が含まれています。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>/oauth/authorize</code> ルートと同様に、<code>/oauth/token</code> ルートは Passport によって定義されています。このルートを手動で定義する必要はありません。</p>
</div>
<p><a name="tokens-json-api"></a></p>
<h4 id="json-api_1">JSON API<a class="headerlink" href="#json-api_1" title="Permanent link">&para;</a></h4>
<p>Passport には、認可されたアクセストークンを管理するための JSON API も含まれています。これを独自のフロントエンドと組み合わせて、ユーザーにアクセストークンを管理するためのダッシュボードを提供することができます。便宜上、エンドポイントへの HTTP リクエストを行うために <a href="https://github.com/mzabriskie/axios">Axios</a> を使用します。JSON API は <code>web</code> および <code>auth</code> ミドルウェアによって保護されています。したがって、自分のアプリケーションからのみ呼び出すことができます。</p>
<p><a name="get-oauthtokens"></a></p>
<h4 id="get-oauthtokens"><code>GET /oauth/tokens</code><a class="headerlink" href="#get-oauthtokens" title="Permanent link">&para;</a></h4>
<p>このルートは、認証されたユーザーが作成したすべての認可されたアクセストークンを返します。これは主に、ユーザーのすべてのトークンをリストアップして、それらを取り消すことができるようにするために便利です：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/oauth/tokens&#39;</span><span class="p">)</span>
<a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="delete-oauthtokenstoken-id"></a></p>
<h4 id="delete-oauthtokenstoken-id"><code>DELETE /oauth/tokens/{token-id}</code><a class="headerlink" href="#delete-oauthtokenstoken-id" title="Permanent link">&para;</a></h4>
<p>このルートは、認可されたアクセストークンとそれに関連するリフレッシュトークンを取り消すために使用できます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="nx">axios</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/oauth/tokens/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tokenId</span><span class="p">);</span>
</code></pre></div>
<p><a name="refreshing-tokens"></a></p>
<h3 id="_15">トークンのリフレッシュ<a class="headerlink" href="#_15" title="Permanent link">&para;</a></h3>
<p>アプリケーションが短期間のアクセストークンを発行する場合、ユーザーはアクセストークンが発行されたときに提供されたリフレッシュトークンを介してアクセストークンをリフレッシュする必要があります：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Http</span><span class="p">;</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="na">asForm</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
    <span class="s1">&#39;grant_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;refresh_token&#39;</span><span class="p">,</span>
    <span class="s1">&#39;refresh_token&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;the-refresh-token&#39;</span><span class="p">,</span>
    <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
    <span class="s1">&#39;client_secret&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
    <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">();</span>
</code></pre></div>
<p>この <code>/oauth/token</code> ルートは、<code>access_token</code>、<code>refresh_token</code>、および <code>expires_in</code> 属性を含む JSON レスポンスを返します。<code>expires_in</code> 属性には、アクセストークンの有効期限が切れるまでの秒数が含まれています。</p>
<p><a name="revoking-tokens"></a></p>
<h3 id="_16">トークンの取り消し<a class="headerlink" href="#_16" title="Permanent link">&para;</a></h3>
<p><code>Laravel\Passport\TokenRepository</code> の <code>revokeAccessToken</code> メソッドを使用してトークンを取り消すことができます。トークンのリフレッシュトークンは、<code>Laravel\Passport\RefreshTokenRepository</code> の <code>revokeRefreshTokensByAccessTokenId</code> メソッドを使用して取り消すことができます。これらのクラスは、Laravel の <a href="container.html">サービスコンテナ</a> を使用して解決できます：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Passport\TokenRepository</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Passport\RefreshTokenRepository</span><span class="p">;</span>

<span class="nv">$tokenRepository</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="nx">TokenRepository</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
<span class="nv">$refreshTokenRepository</span> <span class="o">=</span> <span class="nx">app</span><span class="p">(</span><span class="nx">RefreshTokenRepository</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

<span class="c1">// アクセストークンを取り消す...</span>
<span class="nv">$tokenRepository</span><span class="o">-&gt;</span><span class="na">revokeAccessToken</span><span class="p">(</span><span class="nv">$tokenId</span><span class="p">);</span>

<span class="c1">// トークンのすべてのリフレッシュトークンを取り消す...</span>
<span class="nv">$refreshTokenRepository</span><span class="o">-&gt;</span><span class="na">revokeRefreshTokensByAccessTokenId</span><span class="p">(</span><span class="nv">$tokenId</span><span class="p">);</span>
</code></pre></div>
<p><a name="purging-tokens"></a></p>
<h3 id="_17">トークンのパージ<a class="headerlink" href="#_17" title="Permanent link">&para;</a></h3>
<p>トークンが取り消されたり期限切れになったりした場合、データベースからそれらをパージしたい場合があります。Passport に含まれる <code>passport:purge</code> Artisan コマンドは、これを行うことができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1"># 取り消されたトークンと期限切れのトークン、および認証コードをパージする...</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:purge
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="c1"># 6時間以上経過した期限切れのトークンのみをパージする...</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:purge<span class="w"> </span>--hours<span class="o">=</span><span class="m">6</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="c1"># 取り消されたトークンと認証コードのみをパージする...</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:purge<span class="w"> </span>--revoked
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="c1"># 期限切れのトークンと認証コードのみをパージする...</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:purge<span class="w"> </span>--expired
</code></pre></div>
<p>また、アプリケーションの <code>routes/console.php</code> ファイルに <a href="scheduling.html">スケジュールされたジョブ</a> を設定して、トークンを自動的にパージすることもできます：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Support\Facades\Schedule</span><span class="p">;</span>

<span class="nx">Schedule</span><span class="o">::</span><span class="na">command</span><span class="p">(</span><span class="s1">&#39;passport:purge&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">hourly</span><span class="p">();</span>
</code></pre></div>
<p><a name="code-grant-pkce"></a></p>
<h2 id="pkce">PKCE を使用した認証コード付与<a class="headerlink" href="#pkce" title="Permanent link">&para;</a></h2>
<p>"Proof Key for Code Exchange" (PKCE) を使用した認証コード付与は、シングルページアプリケーションやネイティブアプリケーションが API にアクセスするために認証するための安全な方法です。この付与は、クライアントシークレットが機密に保存されることを保証できない場合や、認証コードが攻撃者によって傍受される脅威を軽減するために使用する必要があります。"code verifier" と "code challenge" の組み合わせが、アクセストークンと交換する際のクライアントシークレットを置き換えます。</p>
<p><a name="creating-a-auth-pkce-grant-client"></a></p>
<h3 id="_18">クライアントの作成<a class="headerlink" href="#_18" title="Permanent link">&para;</a></h3>
<p>アプリケーションが PKCE を使用した認証コード付与を介してトークンを発行する前に、PKCE 対応のクライアントを作成する必要があります。これは、<code>passport:client</code> Artisan コマンドに <code>--public</code> オプションを付けて行うことができます：</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:client<span class="w"> </span>--public
</code></pre></div>
<p><a name="requesting-auth-pkce-grant-tokens"></a></p>
<h3 id="_19">トークンのリクエスト<a class="headerlink" href="#_19" title="Permanent link">&para;</a></h3>
<p><a name="code-verifier-code-challenge"></a></p>
<h4 id="_20">コード検証子とコードチャレンジ<a class="headerlink" href="#_20" title="Permanent link">&para;</a></h4>
<p>この認証付与はクライアントシークレットを提供しないため、開発者はトークンをリクエストするためにコード検証子とコードチャレンジの組み合わせを生成する必要があります。</p>
<p>コード検証子は、43 文字から 128 文字の間のランダムな文字列で、文字、数字、および <code>"-"</code>, <code>"."</code>, <code>"_"</code>, <code>"~"</code> 文字を含む必要があります。これは <a href="https://tools.ietf.org/html/rfc7636">RFC 7636 仕様</a> で定義されています。</p>
<p>コードチャレンジは、URL とファイル名に安全な文字を含む Base64 エンコードされた文字列である必要があります。末尾の <code>'='</code> 文字は削除され、改行、空白、またはその他の追加文字は含まれてはなりません。</p>
<div class="highlight"><pre><span></span><code><span class="nv">$encoded</span> <span class="o">=</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$code_verifier</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>

<span class="nv">$codeChallenge</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nb">rtrim</span><span class="p">(</span><span class="nv">$encoded</span><span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span> <span class="s1">&#39;+/&#39;</span><span class="p">,</span> <span class="s1">&#39;-_&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a name="code-grant-pkce-redirecting-for-authorization"></a></p>
<h4 id="_21">認証のためのリダイレクト<a class="headerlink" href="#_21" title="Permanent link">&para;</a></h4>
<p>クライアントが作成されたら、クライアント ID と生成されたコード検証子およびコードチャレンジを使用して、アプリケーションから認証コードとアクセストークンをリクエストできます。まず、消費アプリケーションはアプリケーションの <code>/oauth/authorize</code> ルートにリダイレクトリクエストを行う必要があります：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Str</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nv">$state</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">40</span><span class="p">));</span>

    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span>
        <span class="s1">&#39;code_verifier&#39;</span><span class="p">,</span> <span class="nv">$code_verifier</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span>
    <span class="p">);</span>

    <span class="nv">$codeChallenge</span> <span class="o">=</span> <span class="nb">strtr</span><span class="p">(</span><span class="nb">rtrim</span><span class="p">(</span>
        <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha256&#39;</span><span class="p">,</span> <span class="nv">$code_verifier</span><span class="p">,</span> <span class="k">true</span><span class="p">))</span>
    <span class="p">,</span> <span class="s1">&#39;=&#39;</span><span class="p">),</span> <span class="s1">&#39;+/&#39;</span><span class="p">,</span> <span class="s1">&#39;-_&#39;</span><span class="p">);</span>

    <span class="nv">$query</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">([</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect_uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://third-party-app.com/callback&#39;</span><span class="p">,</span>
        <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="s1">&#39;state&#39;</span> <span class="o">=&gt;</span> <span class="nv">$state</span><span class="p">,</span>
        <span class="s1">&#39;code_challenge&#39;</span> <span class="o">=&gt;</span> <span class="nv">$codeChallenge</span><span class="p">,</span>
        <span class="s1">&#39;code_challenge_method&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;S256&#39;</span><span class="p">,</span>
        <span class="c1">// &#39;prompt&#39; =&gt; &#39;&#39;, // &quot;none&quot;, &quot;consent&quot;, or &quot;login&quot;</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/authorize?&#39;</span><span class="o">.</span><span class="nv">$query</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p><a name="code-grant-pkce-converting-authorization-codes-to-access-tokens"></a></p>
<h4 id="_22">認証コードをアクセストークンに変換する<a class="headerlink" href="#_22" title="Permanent link">&para;</a></h4>
<p>ユーザーが認証リクエストを承認した場合、消費アプリケーションにリダイレクトされます。コンシューマは、リダイレクト前に保存された値に対して <code>state</code> パラメータを検証する必要があります。これは、標準の認証コード付与と同様です。</p>
<p><code>state</code> パラメータが一致する場合、コンシューマはアプリケーションに <code>POST</code> リクエストを発行してアクセストークンをリクエストする必要があります。リクエストには、ユーザーが認証リクエストを承認したときにアプリケーションによって発行された認証コードと、最初に生成されたコード検証子を含める必要があります：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Http</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/callback&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$state</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pull</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">);</span>

    <span class="nv">$codeVerifier</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">pull</span><span class="p">(</span><span class="s1">&#39;code_verifier&#39;</span><span class="p">);</span>

    <span class="nx">throw_unless</span><span class="p">(</span>
        <span class="nb">strlen</span><span class="p">(</span><span class="nv">$state</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nv">$state</span> <span class="o">===</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">state</span><span class="p">,</span>
        <span class="nx">InvalidArgumentException</span><span class="o">::</span><span class="na">class</span>
    <span class="p">);</span>

    <span class="nv">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="na">asForm</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
        <span class="s1">&#39;grant_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;authorization_code&#39;</span><span class="p">,</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect_uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://third-party-app.com/callback&#39;</span><span class="p">,</span>
        <span class="s1">&#39;code_verifier&#39;</span> <span class="o">=&gt;</span> <span class="nv">$codeVerifier</span><span class="p">,</span>
        <span class="s1">&#39;code&#39;</span> <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">code</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>
<p><a name="password-grant-tokens"></a></p>
<h2 id="_23">パスワード付与トークン<a class="headerlink" href="#_23" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>パスワード付与トークンの使用は推奨されなくなりました。代わりに、OAuth2 サーバーが現在推奨している <a href="https://oauth2.thephpleague.com/authorization-server/which-grant/">付与タイプ</a> を選択する必要があります。</p>
</div>
<p>OAuth2 パスワード付与により、モバイルアプリケーションなどの他のファーストパーティクライアントは、メールアドレス / ユーザー名とパスワードを使用してアクセストークンを取得できます。これにより、ユーザーが OAuth2 認証コードリダイレクトフロー全体を経ることなく、ファーストパーティクライアントにアクセストークンを安全に発行できます。</p>
<p>パスワード付与を有効にするには、アプリケーションの <code>App\Providers\AppServiceProvider</code> クラスの <code>boot</code> メソッドで <code>enablePasswordGrant</code> メソッドを呼び出します：</p>
<div class="highlight"><pre><span></span><code><span class="sd">/**</span>
<span class="sd"> * 任意のアプリケーションサービスのブートストラップ</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">enablePasswordGrant</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="creating-a-password-grant-client"></a></p>
<h3 id="_24">パスワード付与クライアントの作成<a class="headerlink" href="#_24" title="Permanent link">&para;</a></h3>
<p>アプリケーションがパスワード付与を介してトークンを発行する前に、パスワード付与クライアントを作成する必要があります。これは、<code>passport:client</code> Artisan コマンドに <code>--password</code> オプションを付けて行うことができます。<strong>すでに <code>passport:install</code> コマンドを実行している場合は、このコマンドを実行する必要はありません：</strong></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:client<span class="w"> </span>--password
</code></pre></div>
<p><a name="requesting-password-grant-tokens"></a></p>
<h3 id="_25">トークンのリクエスト<a class="headerlink" href="#_25" title="Permanent link">&para;</a></h3>
<p>パスワードグラントクライアントを作成したら、ユーザーのメールアドレスとパスワードを指定して、<code>/oauth/token</code> ルートに <code>POST</code> リクエストを発行することでアクセストークンをリクエストできます。このルートは Passport によってすでに登録されているため、手動で定義する必要はありません。リクエストが成功すると、サーバーからの JSON レスポンスに <code>access_token</code> と <code>refresh_token</code> が含まれます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Http</span><span class="p">;</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="nv">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="na">asForm</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a>    <span class="s1">&#39;grant_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a>    <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a>    <span class="s1">&#39;client_secret&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a>    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;taylor@laravel.com&#39;</span><span class="p">,</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a>    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my-password&#39;</span><span class="p">,</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a>    <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="p">]);</span>
<a id="__codelineno-19-11" name="__codelineno-19-11" href="#__codelineno-19-11"></a>
<a id="__codelineno-19-12" name="__codelineno-19-12" href="#__codelineno-19-12"></a><span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">();</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>アクセストークンはデフォルトで長期間有効です。ただし、必要に応じて<a href="#configuration">アクセストークンの最大有効期間を設定</a>することができます。</p>
</div>
<p><a name="requesting-all-scopes"></a></p>
<h3 id="_26">すべてのスコープのリクエスト<a class="headerlink" href="#_26" title="Permanent link">&para;</a></h3>
<p>パスワードグラントまたはクライアントクレデンシャルグラントを使用する場合、アプリケーションがサポートするすべてのスコープに対してトークンを承認したい場合があります。これを行うには、<code>*</code> スコープをリクエストします。<code>*</code> スコープをリクエストすると、トークンインスタンスの <code>can</code> メソッドは常に <code>true</code> を返します。このスコープは、<code>password</code> または <code>client_credentials</code> グラントを使用して発行されたトークンにのみ割り当てることができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Http</span><span class="p">;</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="nv">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="na">asForm</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a>    <span class="s1">&#39;grant_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;password&#39;</span><span class="p">,</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a>    <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a>    <span class="s1">&#39;client_secret&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a>    <span class="s1">&#39;username&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;taylor@laravel.com&#39;</span><span class="p">,</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a>    <span class="s1">&#39;password&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;my-password&#39;</span><span class="p">,</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a>    <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span>
<a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="p">]);</span>
</code></pre></div>
<p><a name="customizing-the-user-provider"></a></p>
<h3 id="_27">ユーザープロバイダのカスタマイズ<a class="headerlink" href="#_27" title="Permanent link">&para;</a></h3>
<p>アプリケーションが複数の<a href="authentication.html#introduction">認証ユーザープロバイダ</a>を使用している場合、パスワードグラントクライアントが使用するユーザープロバイダを <code>--provider</code> オプションを指定して <code>artisan passport:client --password</code> コマンドで作成することができます。指定されたプロバイダ名は、アプリケーションの <code>config/auth.php</code> 設定ファイルで定義された有効なプロバイダと一致する必要があります。その後、<a href="#via-middleware">ミドルウェアを使用してルートを保護</a>し、ガードで指定されたプロバイダのユーザーのみが認証されるようにすることができます。</p>
<p><a name="customizing-the-username-field"></a></p>
<h3 id="_28">ユーザー名フィールドのカスタマイズ<a class="headerlink" href="#_28" title="Permanent link">&para;</a></h3>
<p>パスワードグラントを使用して認証する場合、Passport は認証可能なモデルの <code>email</code> 属性を「ユーザー名」として使用します。ただし、この動作をカスタマイズするには、モデルに <code>findForPassport</code> メソッドを定義します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="k">use</span> <span class="nx">Laravel\Passport\HasApiTokens</span><span class="p">;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="p">{</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a>    <span class="sd">/**</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="sd">     * 指定されたユーザー名に対するユーザーインスタンスを検索します。</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="sd">     */</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">findForPassport</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$username</span><span class="p">)</span><span class="o">:</span> <span class="nx">User</span>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a>    <span class="p">{</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a>        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">where</span><span class="p">(</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="nv">$username</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">first</span><span class="p">();</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a>    <span class="p">}</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="p">}</span>
</code></pre></div>
<p><a name="customizing-the-password-validation"></a></p>
<h3 id="_29">パスワード検証のカスタマイズ<a class="headerlink" href="#_29" title="Permanent link">&para;</a></h3>
<p>パスワードグラントを使用して認証する場合、Passport はモデルの <code>password</code> 属性を使用して指定されたパスワードを検証します。モデルに <code>password</code> 属性がない場合や、パスワード検証ロジックをカスタマイズしたい場合は、モデルに <code>validateForPassportPasswordGrant</code> メソッドを定義できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="o">&lt;?</span><span class="nx">php</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="k">namespace</span> <span class="nx">App\Models</span><span class="p">;</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="k">use</span> <span class="nx">Illuminate\Foundation\Auth\User</span> <span class="k">as</span> <span class="nx">Authenticatable</span><span class="p">;</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="k">use</span> <span class="nx">Illuminate\Notifications\Notifiable</span><span class="p">;</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Hash</span><span class="p">;</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="k">use</span> <span class="nx">Laravel\Passport\HasApiTokens</span><span class="p">;</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a>
<a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="k">class</span> <span class="nc">User</span> <span class="k">extends</span> <span class="nx">Authenticatable</span>
<a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="p">{</span>
<a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a>    <span class="k">use</span> <span class="nx">HasApiTokens</span><span class="p">,</span> <span class="nx">Notifiable</span><span class="p">;</span>
<a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a>
<a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a>    <span class="sd">/**</span>
<a id="__codelineno-22-15" name="__codelineno-22-15" href="#__codelineno-22-15"></a><span class="sd">     * Passport パスワードグラントのユーザーのパスワードを検証します。</span>
<a id="__codelineno-22-16" name="__codelineno-22-16" href="#__codelineno-22-16"></a><span class="sd">     */</span>
<a id="__codelineno-22-17" name="__codelineno-22-17" href="#__codelineno-22-17"></a>    <span class="k">public</span> <span class="k">function</span> <span class="nf">validateForPassportPasswordGrant</span><span class="p">(</span><span class="nx">string</span> <span class="nv">$password</span><span class="p">)</span><span class="o">:</span> <span class="nx">bool</span>
<a id="__codelineno-22-18" name="__codelineno-22-18" href="#__codelineno-22-18"></a>    <span class="p">{</span>
<a id="__codelineno-22-19" name="__codelineno-22-19" href="#__codelineno-22-19"></a>        <span class="k">return</span> <span class="nx">Hash</span><span class="o">::</span><span class="na">check</span><span class="p">(</span><span class="nv">$password</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">password</span><span class="p">);</span>
<a id="__codelineno-22-20" name="__codelineno-22-20" href="#__codelineno-22-20"></a>    <span class="p">}</span>
<a id="__codelineno-22-21" name="__codelineno-22-21" href="#__codelineno-22-21"></a><span class="p">}</span>
</code></pre></div>
<p><a name="implicit-grant-tokens"></a></p>
<h2 id="_30">暗黙的グラントトークン<a class="headerlink" href="#_30" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>暗黙的グラントトークンの使用は推奨されなくなりました。代わりに、OAuth2 Server が現在推奨している<a href="https://oauth2.thephpleague.com/authorization-server/which-grant/">グラントタイプ</a>を選択してください。</p>
</div>
<p>暗黙的グラントは認証コードグラントに似ていますが、トークンは認証コードを交換することなくクライアントに返されます。このグラントは、クライアントクレデンシャルを安全に保存できない JavaScript またはモバイルアプリケーションで最も一般的に使用されます。グラントを有効にするには、アプリケーションの <code>App\Providers\AppServiceProvider</code> クラスの <code>boot</code> メソッドで <code>enableImplicitGrant</code> メソッドを呼び出します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="sd">/**</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="sd"> * 任意のアプリケーションサービスをブートストラップします。</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="sd"> */</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="p">{</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a>    <span class="nx">Passport</span><span class="o">::</span><span class="na">enableImplicitGrant</span><span class="p">();</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="p">}</span>
</code></pre></div>
<p>グラントが有効になったら、開発者はクライアント ID を使用してアプリケーションからアクセストークンをリクエストできます。消費アプリケーションは、次のようにアプリケーションの <code>/oauth/authorize</code> ルートにリダイレクトリクエストを行う必要があります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>
<a id="__codelineno-24-2" name="__codelineno-24-2" href="#__codelineno-24-2"></a>
<a id="__codelineno-24-3" name="__codelineno-24-3" href="#__codelineno-24-3"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-24-4" name="__codelineno-24-4" href="#__codelineno-24-4"></a>    <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">session</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">put</span><span class="p">(</span><span class="s1">&#39;state&#39;</span><span class="p">,</span> <span class="nv">$state</span> <span class="o">=</span> <span class="nx">Str</span><span class="o">::</span><span class="na">random</span><span class="p">(</span><span class="mi">40</span><span class="p">));</span>
<a id="__codelineno-24-5" name="__codelineno-24-5" href="#__codelineno-24-5"></a>
<a id="__codelineno-24-6" name="__codelineno-24-6" href="#__codelineno-24-6"></a>    <span class="nv">$query</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">([</span>
<a id="__codelineno-24-7" name="__codelineno-24-7" href="#__codelineno-24-7"></a>        <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
<a id="__codelineno-24-8" name="__codelineno-24-8" href="#__codelineno-24-8"></a>        <span class="s1">&#39;redirect_uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://third-party-app.com/callback&#39;</span><span class="p">,</span>
<a id="__codelineno-24-9" name="__codelineno-24-9" href="#__codelineno-24-9"></a>        <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;token&#39;</span><span class="p">,</span>
<a id="__codelineno-24-10" name="__codelineno-24-10" href="#__codelineno-24-10"></a>        <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
<a id="__codelineno-24-11" name="__codelineno-24-11" href="#__codelineno-24-11"></a>        <span class="s1">&#39;state&#39;</span> <span class="o">=&gt;</span> <span class="nv">$state</span><span class="p">,</span>
<a id="__codelineno-24-12" name="__codelineno-24-12" href="#__codelineno-24-12"></a>        <span class="c1">// &#39;prompt&#39; =&gt; &#39;&#39;, // &quot;none&quot;, &quot;consent&quot;, or &quot;login&quot;</span>
<a id="__codelineno-24-13" name="__codelineno-24-13" href="#__codelineno-24-13"></a>    <span class="p">]);</span>
<a id="__codelineno-24-14" name="__codelineno-24-14" href="#__codelineno-24-14"></a>
<a id="__codelineno-24-15" name="__codelineno-24-15" href="#__codelineno-24-15"></a>    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/authorize?&#39;</span><span class="o">.</span><span class="nv">$query</span><span class="p">);</span>
<a id="__codelineno-24-16" name="__codelineno-24-16" href="#__codelineno-24-16"></a><span class="p">});</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>/oauth/authorize</code> ルートは Passport によってすでに定義されているため、手動でこのルートを定義する必要はありません。</p>
</div>
<p><a name="client-credentials-grant-tokens"></a></p>
<h2 id="_31">クライアントクレデンシャルグラントトークン<a class="headerlink" href="#_31" title="Permanent link">&para;</a></h2>
<p>クライアントクレデンシャルグラントは、マシン間認証に適しています。たとえば、API を介してメンテナンスタスクを実行するスケジュールされたジョブでこのグラントを使用する場合があります。</p>
<p>アプリケーションがクライアントクレデンシャルグラントを介してトークンを発行する前に、クライアントクレデンシャルグラントクライアントを作成する必要があります。これは、<code>passport:client</code> Artisan コマンドの <code>--client</code> オプションを使用して行うことができます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:client<span class="w"> </span>--client
</code></pre></div>
<p>次に、このグラントタイプを使用するために、<code>CheckClientCredentials</code> ミドルウェアのミドルウェアエイリアスを登録します。ミドルウェアエイリアスは、アプリケーションの <code>bootstrap/app.php</code> ファイルで定義できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">use</span> <span class="nx">Laravel\Passport\Http\Middleware\CheckClientCredentials</span><span class="p">;</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="o">-&gt;</span><span class="na">withMiddleware</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Middleware</span> <span class="nv">$middleware</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a>    <span class="nv">$middleware</span><span class="o">-&gt;</span><span class="na">alias</span><span class="p">([</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a>        <span class="s1">&#39;client&#39;</span> <span class="o">=&gt;</span> <span class="nx">CheckClientCredentials</span><span class="o">::</span><span class="na">class</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>    <span class="p">]);</span>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="p">})</span>
</code></pre></div>
<p>その後、ミドルウェアをルートにアタッチします。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a>    <span class="o">...</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;client&#39;</span><span class="p">);</span>
</code></pre></div>
<p>ルートへのアクセスを特定のスコープに制限するには、<code>client</code> ミドルウェアをルートにアタッチする際に、必要なスコープのカンマ区切りリストを指定できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a>    <span class="o">...</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="p">})</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;client:check-status,your-scope&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a name="retrieving-tokens"></a></p>
<h3 id="_32">トークンの取得<a class="headerlink" href="#_32" title="Permanent link">&para;</a></h3>
<p>このグラントタイプを使用してトークンを取得するには、<code>oauth/token</code> エンドポイントにリクエストを行います。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Http</span><span class="p">;</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="nv">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="na">asForm</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/token&#39;</span><span class="p">,</span> <span class="p">[</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a>    <span class="s1">&#39;grant_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client_credentials&#39;</span><span class="p">,</span>
<a id="__codelineno-29-5" name="__codelineno-29-5" href="#__codelineno-29-5"></a>    <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
<a id="__codelineno-29-6" name="__codelineno-29-6" href="#__codelineno-29-6"></a>    <span class="s1">&#39;client_secret&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-secret&#39;</span><span class="p">,</span>
<a id="__codelineno-29-7" name="__codelineno-29-7" href="#__codelineno-29-7"></a>    <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;your-scope&#39;</span><span class="p">,</span>
<a id="__codelineno-29-8" name="__codelineno-29-8" href="#__codelineno-29-8"></a><span class="p">]);</span>
<a id="__codelineno-29-9" name="__codelineno-29-9" href="#__codelineno-29-9"></a>
<a id="__codelineno-29-10" name="__codelineno-29-10" href="#__codelineno-29-10"></a><span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">()[</span><span class="s1">&#39;access_token&#39;</span><span class="p">];</span>
</code></pre></div>
<p><a name="personal-access-tokens"></a></p>
<h2 id="_33">パーソナルアクセストークン<a class="headerlink" href="#_33" title="Permanent link">&para;</a></h2>
<p>場合によっては、ユーザーが通常の認証コードリダイレクトフローを経ずに自分自身にアクセストークンを発行したい場合があります。ユーザーがアプリケーションの UI を介して自分自身にトークンを発行できるようにすることは、ユーザーが API を試すために便利であったり、一般的なアクセストークン発行のより簡単なアプローチとなる場合があります。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>アプリケーションが主に Passport を使用してパーソナルアクセストークンを発行する場合、<a href="sanctum.html">Laravel Sanctum</a> の使用を検討してください。Laravel の軽量な API アクセストークン発行ライブラリです。</p>
</div>
<p><a name="creating-a-personal-access-client"></a></p>
<h3 id="_34">パーソナルアクセスクライアントの作成<a class="headerlink" href="#_34" title="Permanent link">&para;</a></h3>
<p>アプリケーションがパーソナルアクセストークンを発行する前に、パーソナルアクセスクライアントを作成する必要があります。これは、<code>passport:client</code> Artisan コマンドに <code>--personal</code> オプションを指定して実行することで行うことができます。<code>passport:install</code> コマンドを既に実行している場合は、このコマンドを実行する必要はありません。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a>php<span class="w"> </span>artisan<span class="w"> </span>passport:client<span class="w"> </span>--personal
</code></pre></div>
<p>パーソナルアクセスクライアントを作成した後、クライアントの ID とプレーンテキストのシークレット値をアプリケーションの <code>.env</code> ファイルに配置します。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="na">PASSPORT_PERSONAL_ACCESS_CLIENT_ID</span><span class="o">=</span><span class="s">&quot;client-id-value&quot;</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="na">PASSPORT_PERSONAL_ACCESS_CLIENT_SECRET</span><span class="o">=</span><span class="s">&quot;unhashed-client-secret-value&quot;</span>
</code></pre></div>
<p><a name="managing-personal-access-tokens"></a></p>
<h3 id="_35">パーソナルアクセストークンの管理<a class="headerlink" href="#_35" title="Permanent link">&para;</a></h3>
<p>パーソナルアクセスクライアントを作成したら、<code>App\Models\User</code> モデルインスタンスの <code>createToken</code> メソッドを使用して、指定されたユーザーのトークンを発行できます。<code>createToken</code> メソッドは、トークンの名前を最初の引数として受け取り、オプションの<a href="#token-scopes">スコープ</a>の配列を2番目の引数として受け取ります。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="nv">$user</span> <span class="o">=</span> <span class="nx">User</span><span class="o">::</span><span class="na">find</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="c1">// スコープなしでトークンを作成する...</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="nv">$token</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createToken</span><span class="p">(</span><span class="s1">&#39;Token Name&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">accessToken</span><span class="p">;</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a><span class="c1">// スコープ付きでトークンを作成する...</span>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="nv">$token</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createToken</span><span class="p">(</span><span class="s1">&#39;My Token&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;place-orders&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">accessToken</span><span class="p">;</span>
</code></pre></div>
<p><a name="personal-access-tokens-json-api"></a></p>
<h4 id="json-api_2">JSON API<a class="headerlink" href="#json-api_2" title="Permanent link">&para;</a></h4>
<p>Passport には、パーソナルアクセストークンを管理するための JSON API も含まれています。これにより、パーソナルアクセストークンを管理するためのフロントエンドを構築するための API を使用して、ユーザーと対話することができます。簡単にするために、Passport の JSON API を呼び出すための Vue コンポーネントを提供します。</p>
<p>この Vue コンポーネントを使用するには、<code>resources/js/app.js</code> ファイルに Passport コンポーネントを登録する必要があります。</p>
<p><a name="get-oauthscopes"></a></p>
<h4 id="get-oauthscopes"><code>GET /oauth/scopes</code><a class="headerlink" href="#get-oauthscopes" title="Permanent link">&para;</a></h4>
<p>このルートは、アプリケーションに定義されたすべての<a href="#token-scopes">スコープ</a>を返します。このルートを使用して、ユーザーがパーソナルアクセストークンに割り当てることができるスコープをリストアップできます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/oauth/scopes&#39;</span><span class="p">)</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="get-oauthpersonal-access-tokens"></a></p>
<h4 id="get-oauthpersonal-access-tokens"><code>GET /oauth/personal-access-tokens</code><a class="headerlink" href="#get-oauthpersonal-access-tokens" title="Permanent link">&para;</a></h4>
<p>このルートは、認証されたユーザーが作成したすべてのパーソナルアクセストークンを返します。これは主に、ユーザーのすべてのトークンをリストアップして、編集または取り消しができるようにするために便利です。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="nx">axios</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/oauth/personal-access-tokens&#39;</span><span class="p">)</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="post-oauthpersonal-access-tokens"></a></p>
<h4 id="post-oauthpersonal-access-tokens"><code>POST /oauth/personal-access-tokens</code><a class="headerlink" href="#post-oauthpersonal-access-tokens" title="Permanent link">&para;</a></h4>
<p>このルートは新しいパーソナルアクセストークンを作成します。トークンの<code>name</code>とトークンに割り当てるべき<code>scopes</code>の2つのデータが必要です。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="w">    </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s1">&#39;Token Name&#39;</span><span class="p">,</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="w">    </span><span class="nx">scopes</span><span class="o">:</span><span class="w"> </span><span class="p">[]</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a><span class="p">};</span>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="nx">axios</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/oauth/personal-access-tokens&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">data</span><span class="p">)</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a><span class="w">    </span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">        </span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">response</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">accessToken</span><span class="p">);</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">    </span><span class="p">})</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a><span class="w">    </span><span class="p">.</span><span class="k">catch</span><span class="w"> </span><span class="p">(</span><span class="nx">response</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">        </span><span class="c1">// エラーをリストアップ...</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">    </span><span class="p">});</span>
</code></pre></div>
<p><a name="delete-oauthpersonal-access-tokenstoken-id"></a></p>
<h4 id="delete-oauthpersonal-access-tokenstoken-id"><code>DELETE /oauth/personal-access-tokens/{token-id}</code><a class="headerlink" href="#delete-oauthpersonal-access-tokenstoken-id" title="Permanent link">&para;</a></h4>
<p>このルートは、パーソナルアクセストークンを取り消すために使用できます。</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="nx">axios</span><span class="p">.</span><span class="ow">delete</span><span class="p">(</span><span class="s1">&#39;/oauth/personal-access-tokens/&#39;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nx">tokenId</span><span class="p">);</span>
</code></pre></div>
<p><a name="protecting-routes"></a></p>
<h2 id="_36">ルートの保護<a class="headerlink" href="#_36" title="Permanent link">&para;</a></h2>
<p><a name="via-middleware"></a></p>
<h3 id="_37">ミドルウェア経由<a class="headerlink" href="#_37" title="Permanent link">&para;</a></h3>
<p>Passportには、受信リクエストのアクセストークンを検証する<a href="authentication.html#adding-custom-guards">認証ガード</a>が含まれています。<code>api</code>ガードを<code>passport</code>ドライバーを使用するように設定したら、有効なアクセストークンを必要とするルートに<code>auth:api</code>ミドルウェアを指定するだけです。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/user&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;auth:api&#39;</span><span class="p">);</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><a href="#client-credentials-grant-tokens">クライアント認証情報付与</a>を使用している場合は、<code>auth:api</code>ミドルウェアの代わりに<a href="#client-credentials-grant-tokens"><code>client</code>ミドルウェア</a>を使用してルートを保護する必要があります。</p>
</div>
<p><a name="multiple-authentication-guards"></a></p>
<h4 id="_38">複数の認証ガード<a class="headerlink" href="#_38" title="Permanent link">&para;</a></h4>
<p>アプリケーションが完全に異なるEloquentモデルを使用する異なるタイプのユーザーを認証する場合、アプリケーション内の各ユーザープロバイダータイプに対してガード設定を定義する必要があるかもしれません。これにより、特定のユーザープロバイダーを対象とするリクエストを保護できます。例えば、以下のガード設定が<code>config/auth.php</code>設定ファイルにある場合：</p>
<div class="highlight"><pre><span></span><code><span class="s1">&#39;api&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;passport&#39;</span><span class="p">,</span>
    <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;users&#39;</span><span class="p">,</span>
<span class="p">],</span>

<span class="s1">&#39;api-customers&#39;</span> <span class="o">=&gt;</span> <span class="p">[</span>
    <span class="s1">&#39;driver&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;passport&#39;</span><span class="p">,</span>
    <span class="s1">&#39;provider&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;customers&#39;</span><span class="p">,</span>
<span class="p">],</span>
</code></pre></div>
<p>以下のルートは、<code>customers</code>ユーザープロバイダーを使用する<code>api-customers</code>ガードを使用して、受信リクエストを認証します。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/customer&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// ...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">(</span><span class="s1">&#39;auth:api-customers&#39;</span><span class="p">);</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Passportで複数のユーザープロバイダーを使用する方法の詳細については、<a href="#customizing-the-user-provider">パスワード付与ドキュメント</a>を参照してください。</p>
</div>
<p><a name="passing-the-access-token"></a></p>
<h3 id="_39">アクセストークンの渡し方<a class="headerlink" href="#_39" title="Permanent link">&para;</a></h3>
<p>Passportによって保護されたルートを呼び出す際、アプリケーションのAPI消費者は、リクエストの<code>Authorization</code>ヘッダーに<code>Bearer</code>トークンとしてアクセストークンを指定する必要があります。例えば、Guzzle HTTPライブラリを使用する場合：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Support\Facades\Http</span><span class="p">;</span>

<span class="nv">$response</span> <span class="o">=</span> <span class="nx">Http</span><span class="o">::</span><span class="na">withHeaders</span><span class="p">([</span>
    <span class="s1">&#39;Accept&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;application/json&#39;</span><span class="p">,</span>
    <span class="s1">&#39;Authorization&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Bearer &#39;</span><span class="o">.</span><span class="nv">$accessToken</span><span class="p">,</span>
<span class="p">])</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;https://passport-app.test/api/user&#39;</span><span class="p">);</span>

<span class="k">return</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">json</span><span class="p">();</span>
</code></pre></div>
<p><a name="token-scopes"></a></p>
<h2 id="_40">トークンスコープ<a class="headerlink" href="#_40" title="Permanent link">&para;</a></h2>
<p>スコープにより、APIクライアントはアカウントへのアクセスをリクエストする際に、特定の権限のセットをリクエストできます。例えば、eコマースアプリケーションを構築している場合、すべてのAPIクライアントが注文を行う権限を必要とするわけではありません。代わりに、クライアントが注文の配送状況にアクセスする権限のみをリクエストできるようにすることができます。言い換えれば、スコープにより、アプリケーションのユーザーは、第三者アプリケーションが自分に代わって実行できるアクションを制限できます。</p>
<p><a name="defining-scopes"></a></p>
<h3 id="_41">スコープの定義<a class="headerlink" href="#_41" title="Permanent link">&para;</a></h3>
<p>アプリケーションの<code>App\Providers\AppServiceProvider</code>クラスの<code>boot</code>メソッドで<code>Passport::tokensCan</code>メソッドを使用して、APIのスコープを定義できます。<code>tokensCan</code>メソッドは、スコープ名とスコープ説明の配列を受け取ります。スコープ説明は、承認承認画面にユーザーに表示されるもので、好きなものを指定できます。</p>
<div class="highlight"><pre><span></span><code><span class="sd">/**</span>
<span class="sd"> * Bootstrap any application services.</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">tokensCan</span><span class="p">([</span>
        <span class="s1">&#39;place-orders&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Place orders&#39;</span><span class="p">,</span>
        <span class="s1">&#39;check-status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Check order status&#39;</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="default-scope"></a></p>
<h3 id="_42">デフォルトスコープ<a class="headerlink" href="#_42" title="Permanent link">&para;</a></h3>
<p>クライアントが特定のスコープをリクエストしない場合、Passportサーバーを設定して、<code>setDefaultScope</code>メソッドを使用してトークンにデフォルトスコープを添付するようにできます。通常、アプリケーションの<code>App\Providers\AppServiceProvider</code>クラスの<code>boot</code>メソッドからこのメソッドを呼び出す必要があります。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>

<span class="nx">Passport</span><span class="o">::</span><span class="na">tokensCan</span><span class="p">([</span>
    <span class="s1">&#39;place-orders&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Place orders&#39;</span><span class="p">,</span>
    <span class="s1">&#39;check-status&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Check order status&#39;</span><span class="p">,</span>
<span class="p">]);</span>

<span class="nx">Passport</span><span class="o">::</span><span class="na">setDefaultScope</span><span class="p">([</span>
    <span class="s1">&#39;check-status&#39;</span><span class="p">,</span>
    <span class="s1">&#39;place-orders&#39;</span><span class="p">,</span>
<span class="p">]);</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Passportのデフォルトスコープは、ユーザーが生成したパーソナルアクセストークンには適用されません。</p>
</div>
<p><a name="assigning-scopes-to-tokens"></a></p>
<h3 id="_43">トークンへのスコープの割り当て<a class="headerlink" href="#_43" title="Permanent link">&para;</a></h3>
<p><a name="when-requesting-authorization-codes"></a></p>
<h4 id="_44">認証コードをリクエストする際<a class="headerlink" href="#_44" title="Permanent link">&para;</a></h4>
<p>認証コード付与を使用してアクセストークンをリクエストする際、クライアントは<code>scope</code>クエリ文字列パラメーターとして希望するスコープを指定する必要があります。<code>scope</code>パラメーターは、スペースで区切られたスコープのリストである必要があります。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/redirect&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nv">$query</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">([</span>
        <span class="s1">&#39;client_id&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;client-id&#39;</span><span class="p">,</span>
        <span class="s1">&#39;redirect_uri&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;http://example.com/callback&#39;</span><span class="p">,</span>
        <span class="s1">&#39;response_type&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;code&#39;</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;place-orders check-status&#39;</span><span class="p">,</span>
    <span class="p">]);</span>

    <span class="k">return</span> <span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;http://passport-app.test/oauth/authorize?&#39;</span><span class="o">.</span><span class="nv">$query</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>
<p><a name="when-issuing-personal-access-tokens"></a></p>
<h4 id="_45">パーソナルアクセストークンを発行する際<a class="headerlink" href="#_45" title="Permanent link">&para;</a></h4>
<p><code>App\Models\User</code>モデルの<code>createToken</code>メソッドを使用してパーソナルアクセストークンを発行する場合、希望するスコープの配列をメソッドの第2引数として渡すことができます。</p>
<div class="highlight"><pre><span></span><code><span class="nv">$token</span> <span class="o">=</span> <span class="nv">$user</span><span class="o">-&gt;</span><span class="na">createToken</span><span class="p">(</span><span class="s1">&#39;My Token&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;place-orders&#39;</span><span class="p">])</span><span class="o">-&gt;</span><span class="na">accessToken</span><span class="p">;</span>
</code></pre></div>
<p><a name="checking-scopes"></a></p>
<h3 id="_46">スコープの確認<a class="headerlink" href="#_46" title="Permanent link">&para;</a></h3>
<p>Passportには、指定されたスコープが付与されたトークンで受信リクエストが認証されているかどうかを確認するための2つのミドルウェアが含まれています。開始するには、アプリケーションの<code>bootstrap/app.php</code>ファイルに以下のミドルウェアエイリアスを定義します。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Passport\Http\Middleware\CheckForAnyScope</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Laravel\Passport\Http\Middleware\CheckScopes</span><span class="p">;</span>

<span class="o">-&gt;</span><span class="na">withMiddleware</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Middleware</span> <span class="nv">$middleware</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$middleware</span><span class="o">-&gt;</span><span class="na">alias</span><span class="p">([</span>
        <span class="s1">&#39;scopes&#39;</span> <span class="o">=&gt;</span> <span class="nx">CheckScopes</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
        <span class="s1">&#39;scope&#39;</span> <span class="o">=&gt;</span> <span class="nx">CheckForAnyScope</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">})</span>
</code></pre></div>
<p><a name="check-for-all-scopes"></a></p>
<h4 id="_47">すべてのスコープの確認<a class="headerlink" href="#_47" title="Permanent link">&para;</a></h4>
<p><code>scopes</code>ミドルウェアは、受信リクエストのアクセストークンにリストされたすべてのスコープがあるかどうかを確認するためにルートに割り当てることができます。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// アクセストークンに &quot;check-status&quot; と &quot;place-orders&quot; の両方のスコープがある...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">([</span><span class="s1">&#39;auth:api&#39;</span><span class="p">,</span> <span class="s1">&#39;scopes:check-status,place-orders&#39;</span><span class="p">]);</span>
</code></pre></div>
<p><a name="check-for-any-scopes"></a></p>
<h4 id="_48">いずれかのスコープの確認<a class="headerlink" href="#_48" title="Permanent link">&para;</a></h4>
<p><code>scope</code>ミドルウェアは、受信リクエストのアクセストークンにリストされたスコープの<em>少なくとも1つ</em>があるかどうかを確認するためにルートに割り当てることができます。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="c1">// アクセストークンに &quot;check-status&quot; または &quot;place-orders&quot; のいずれかのスコープがある...</span>
<span class="p">})</span><span class="o">-&gt;</span><span class="na">middleware</span><span class="p">([</span><span class="s1">&#39;auth:api&#39;</span><span class="p">,</span> <span class="s1">&#39;scope:check-status,place-orders&#39;</span><span class="p">]);</span>
</code></pre></div>
<p><a name="checking-scopes-on-a-token-instance"></a></p>
<h4 id="_49">トークンインスタンスでのスコープの確認<a class="headerlink" href="#_49" title="Permanent link">&para;</a></h4>
<p>アクセストークンで認証されたリクエストがアプリケーションに入った後、認証された<code>App\Models\User</code>インスタンスの<code>tokenCan</code>メソッドを使用して、トークンに特定のスコープがあるかどうかを確認できます。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Illuminate\Http\Request</span><span class="p">;</span>

<span class="nx">Route</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/orders&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Request</span> <span class="nv">$request</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$request</span><span class="o">-&gt;</span><span class="na">user</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">tokenCan</span><span class="p">(</span><span class="s1">&#39;place-orders&#39;</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">});</span>
</code></pre></div>
<p><a name="additional-scope-methods"></a></p>
<h4 id="_50">追加のスコープメソッド<a class="headerlink" href="#_50" title="Permanent link">&para;</a></h4>
<p><code>scopeIds</code>メソッドは、すべての定義されたID / 名前の配列を返します。</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>

<span class="nx">Passport</span><span class="o">::</span><span class="na">scopeIds</span><span class="p">();</span>
</code></pre></div>
<p><code>scopes</code>メソッドは、すべての定義されたスコープを<code>Laravel\Passport\Scope</code>インスタンスの配列として返します。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Passport</span><span class="o">::</span><span class="na">scopes</span><span class="p">();</span>
</code></pre></div>
<p><code>scopesFor</code>メソッドは、指定されたID / 名前に一致する<code>Laravel\Passport\Scope</code>インスタンスの配列を返します。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Passport</span><span class="o">::</span><span class="na">scopesFor</span><span class="p">([</span><span class="s1">&#39;place-orders&#39;</span><span class="p">,</span> <span class="s1">&#39;check-status&#39;</span><span class="p">]);</span>
</code></pre></div>
<p><code>hasScope</code>メソッドを使用して、指定されたスコープが定義されているかどうかを確認できます。</p>
<div class="highlight"><pre><span></span><code><span class="nx">Passport</span><span class="o">::</span><span class="na">hasScope</span><span class="p">(</span><span class="s1">&#39;place-orders&#39;</span><span class="p">);</span>
</code></pre></div>
<p><a name="consuming-your-api-with-javascript"></a></p>
<h2 id="javascriptapi">JavaScriptでのAPIの利用<a class="headerlink" href="#javascriptapi" title="Permanent link">&para;</a></h2>
<p>APIを構築する際、自分のJavaScriptアプリケーションから自分のAPIを利用できることは非常に便利です。このAPI開発のアプローチにより、自分のアプリケーションが世界と共有しているのと同じAPIを利用できます。同じAPIは、Webアプリケーション、モバイルアプリケーション、サードパーティアプリケーション、およびさまざまなパッケージマネージャーに公開するSDKから利用される可能性があります。</p>
<p>通常、JavaScriptアプリケーションから自分のAPIを利用したい場合、アクセストークンを手動でアプリケーションに送信し、各リクエストとともに渡す必要があります。しかし、Passportにはこれを処理するミドルウェアが含まれています。必要なのは、アプリケーションの<code>bootstrap/app.php</code>ファイル内の<code>web</code>ミドルウェアグループに<code>CreateFreshApiToken</code>ミドルウェアを追加することだけです：</p>
<div class="highlight"><pre><span></span><code><span class="k">use</span> <span class="nx">Laravel\Passport\Http\Middleware\CreateFreshApiToken</span><span class="p">;</span>

<span class="o">-&gt;</span><span class="na">withMiddleware</span><span class="p">(</span><span class="k">function</span> <span class="p">(</span><span class="nx">Middleware</span> <span class="nv">$middleware</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$middleware</span><span class="o">-&gt;</span><span class="na">web</span><span class="p">(</span><span class="nx">append</span><span class="o">:</span> <span class="p">[</span>
        <span class="nx">CreateFreshApiToken</span><span class="o">::</span><span class="na">class</span><span class="p">,</span>
    <span class="p">]);</span>
<span class="p">})</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p><code>CreateFreshApiToken</code>ミドルウェアがミドルウェアスタックの最後にリストされていることを確認する必要があります。</p>
</div>
<p>このミドルウェアは、送信するレスポンスに<code>laravel_token</code>クッキーを添付します。このクッキーには、PassportがJavaScriptアプリケーションからのAPIリクエストを認証するために使用する暗号化されたJWTが含まれています。JWTの有効期間は、<code>session.lifetime</code>設定値と同じです。現在、ブラウザは自動的にすべての後続リクエストとともにクッキーを送信するため、明示的にアクセストークンを渡すことなく、アプリケーションのAPIにリクエストを行うことができます：</p>
<div class="highlight"><pre><span></span><code><span class="nx">axios</span><span class="o">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/api/user&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">response</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="nx">console</span><span class="o">.</span><span class="nb">log</span><span class="p">(</span><span class="nx">response</span><span class="o">.</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">});</span>
</code></pre></div>
<p><a name="customizing-the-cookie-name"></a></p>
<h4 id="_51">クッキー名のカスタマイズ<a class="headerlink" href="#_51" title="Permanent link">&para;</a></h4>
<p>必要に応じて、<code>Passport::cookie</code>メソッドを使用して<code>laravel_token</code>クッキーの名前をカスタマイズできます。通常、このメソッドはアプリケーションの<code>App\Providers\AppServiceProvider</code>クラスの<code>boot</code>メソッドから呼び出す必要があります：</p>
<div class="highlight"><pre><span></span><code><span class="sd">/**</span>
<span class="sd"> * 任意のアプリケーションサービスのブートストラップ。</span>
<span class="sd"> */</span>
<span class="k">public</span> <span class="k">function</span> <span class="nf">boot</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<span class="p">{</span>
    <span class="nx">Passport</span><span class="o">::</span><span class="na">cookie</span><span class="p">(</span><span class="s1">&#39;custom_name&#39;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p><a name="csrf-protection"></a></p>
<h4 id="csrf">CSRF保護<a class="headerlink" href="#csrf" title="Permanent link">&para;</a></h4>
<p>この認証方法を使用する場合、有効なCSRFトークンヘッダーがリクエストに含まれていることを確認する必要があります。デフォルトのLaravel JavaScriptスキャフォールディングにはAxiosインスタンスが含まれており、暗号化された<code>XSRF-TOKEN</code>クッキー値を使用して同一生成元リクエストに<code>X-XSRF-TOKEN</code>ヘッダーを自動的に送信します。</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code>X-XSRF-TOKEN</code>の代わりに<code>X-CSRF-TOKEN</code>ヘッダーを送信する場合は、<code>csrf_token()</code>によって提供される暗号化されていないトークンを使用する必要があります。</p>
</div>
<p><a name="events"></a></p>
<h2 id="_52">イベント<a class="headerlink" href="#_52" title="Permanent link">&para;</a></h2>
<p>Passportは、アクセストークンとリフレッシュトークンを発行する際にイベントを発生させます。データベース内の他のアクセストークンを整理または取り消すために、<a href="events.html">これらのイベントをリッスン</a>できます：</p>
<div class="overflow-auto">
<table>
<thead>
<tr>
<th>イベント名</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Laravel\Passport\Events\AccessTokenCreated</code></td>
</tr>
<tr>
<td><code>Laravel\Passport\Events\RefreshTokenCreated</code></td>
</tr>
</tbody>
</table>
</div>
<p><a name="testing"></a></p>
<h2 id="_53">テスト<a class="headerlink" href="#_53" title="Permanent link">&para;</a></h2>
<p>Passportの<code>actingAs</code>メソッドは、現在認証されているユーザーとそのスコープを指定するために使用できます。<code>actingAs</code>メソッドに渡される最初の引数はユーザーインスタンスで、2番目の引数はユーザーのトークンに付与されるスコープの配列です：</p>
<div class="tabbed-set tabbed-alternate" data-tabs="1:1"><input checked="checked" id="__tabbed_1_1" name="__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="__tabbed_1_1">Pest</label></div>
<div class="tabbed-content">
<div class="tabbed-block"></div>
</div>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;サーバーを作成できる&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a>    <span class="nx">Passport</span><span class="o">::</span><span class="na">actingAs</span><span class="p">(</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a>        <span class="nx">User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(),</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a>        <span class="p">[</span><span class="s1">&#39;create-servers&#39;</span><span class="p">]</span>
<a id="__codelineno-37-8" name="__codelineno-37-8" href="#__codelineno-37-8"></a>    <span class="p">);</span>
<a id="__codelineno-37-9" name="__codelineno-37-9" href="#__codelineno-37-9"></a>
<a id="__codelineno-37-10" name="__codelineno-37-10" href="#__codelineno-37-10"></a>    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/api/create-server&#39;</span><span class="p">);</span>
<a id="__codelineno-37-11" name="__codelineno-37-11" href="#__codelineno-37-11"></a>
<a id="__codelineno-37-12" name="__codelineno-37-12" href="#__codelineno-37-12"></a>    <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>
<a id="__codelineno-37-13" name="__codelineno-37-13" href="#__codelineno-37-13"></a><span class="p">});</span>
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="2:1"><input checked="checked" id="__tabbed_2_1" name="__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="__tabbed_2_1">PHPUnit</label></div>
<div class="tabbed-content">
<div class="tabbed-block"></div>
</div>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="k">use</span> <span class="nx">App\Models\User</span><span class="p">;</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">test_サーバーを作成できる</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a><span class="p">{</span>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a>    <span class="nx">Passport</span><span class="o">::</span><span class="na">actingAs</span><span class="p">(</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a>        <span class="nx">User</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(),</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a>        <span class="p">[</span><span class="s1">&#39;create-servers&#39;</span><span class="p">]</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a>    <span class="p">);</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a>
<a id="__codelineno-38-11" name="__codelineno-38-11" href="#__codelineno-38-11"></a>    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">post</span><span class="p">(</span><span class="s1">&#39;/api/create-server&#39;</span><span class="p">);</span>
<a id="__codelineno-38-12" name="__codelineno-38-12" href="#__codelineno-38-12"></a>
<a id="__codelineno-38-13" name="__codelineno-38-13" href="#__codelineno-38-13"></a>    <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">201</span><span class="p">);</span>
<a id="__codelineno-38-14" name="__codelineno-38-14" href="#__codelineno-38-14"></a><span class="p">}</span>
</code></pre></div>
<p>Passportの<code>actingAsClient</code>メソッドは、現在認証されているクライアントとそのスコープを指定するために使用できます。<code>actingAsClient</code>メソッドに渡される最初の引数はクライアントインスタンスで、2番目の引数はクライアントのトークンに付与されるスコープの配列です：</p>
<div class="tabbed-set tabbed-alternate" data-tabs="3:1"><input checked="checked" id="__tabbed_3_1" name="__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="__tabbed_3_1">Pest</label></div>
<div class="tabbed-content">
<div class="tabbed-block"></div>
</div>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="k">use</span> <span class="nx">Laravel\Passport\Client</span><span class="p">;</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a><span class="nx">test</span><span class="p">(</span><span class="s1">&#39;注文を取得できる&#39;</span><span class="p">,</span> <span class="k">function</span> <span class="p">()</span> <span class="p">{</span>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a>    <span class="nx">Passport</span><span class="o">::</span><span class="na">actingAsClient</span><span class="p">(</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a>        <span class="nx">Client</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(),</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a>        <span class="p">[</span><span class="s1">&#39;check-status&#39;</span><span class="p">]</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>    <span class="p">);</span>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/api/orders&#39;</span><span class="p">);</span>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>    <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="p">});</span>
</code></pre></div>
<div class="tabbed-set tabbed-alternate" data-tabs="4:1"><input checked="checked" id="__tabbed_4_1" name="__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="__tabbed_4_1">PHPUnit</label></div>
<div class="tabbed-content">
<div class="tabbed-block"></div>
</div>
</div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="k">use</span> <span class="nx">Laravel\Passport\Client</span><span class="p">;</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="k">use</span> <span class="nx">Laravel\Passport\Passport</span><span class="p">;</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="k">public</span> <span class="k">function</span> <span class="nf">test_注文を取得できる</span><span class="p">()</span><span class="o">:</span> <span class="nx">void</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="p">{</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a>    <span class="nx">Passport</span><span class="o">::</span><span class="na">actingAsClient</span><span class="p">(</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>        <span class="nx">Client</span><span class="o">::</span><span class="na">factory</span><span class="p">()</span><span class="o">-&gt;</span><span class="na">create</span><span class="p">(),</span>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a>        <span class="p">[</span><span class="s1">&#39;check-status&#39;</span><span class="p">]</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>    <span class="p">);</span>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;/api/orders&#39;</span><span class="p">);</span>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a>    <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">assertStatus</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="p">}</span>
</code></pre></div>









  




                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
<nav class="md-footer-nav">
    
    
</nav>

    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": ".", "features": ["back-to-top", "navigation.expand", "navigation.tabs", "navigation.footer", "navigation.sections", "navigation.expand", "content.code.copy", "hide_repository_button", "content.code.annotate", "content.tabs.link", "toc.none", "content.action.edit"], "search": "assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.56dfad97.min.js"></script>
      
    
  </body>
</html>